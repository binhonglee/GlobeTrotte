var B=Object.defineProperty;var N=(e,o,t)=>o in e?B(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t;var m=(e,o,t)=>N(e,typeof o!="symbol"?o+"":o,t);import{d as $,B as y,N as L,s as P,H as v,j as U,G as w,R as C,e as I,c as T,a as s,b as n,i as V,q as b,r as a,f as c,o as _,h as p,_ as H}from"./index-CVwEz7sZ.js";import{C as R,E as r}from"./CEditItem-CkORRj5K.js";import{C as G}from"./CLink-BZ5D-za9.js";import{U as S}from"./UserObj-C4SvK9zP.js";import{N as u}from"./NaiveUtils-CaBEIltk.js";import{C as q}from"./CHead-DB__Oa_T.js";import"./Input-B0b2FwEY.js";import"./TripObj-B2zgwhZc.js";class A{constructor(o){m(this,"email","");m(this,"password","");o&&(this.email=o.email!==void 0&&o.email!==null?o.email:"",this.password=o.password!==void 0&&o.password!==null?o.password:"")}toJsonKey(o){switch(o){case"email":return"email";case"password":return"password";default:return o}}}const M=$({components:{CEditItem:R,CLink:G,NAlert:L,NButton:y,CHead:q},data(){return{loading:!1,showError:!1,resetLink:I.password_Reset,loadingBar:w.loadingBar()}},beforeMount(){C.hasNext()&&(this.$data.showError=!0),u.init()},mounted(){r.get(r.get(this,"email"),"input").focus()},methods:{async confirm(){var i,l,d;this.$data.loading=!0,(i=this.$data.loadingBar)==null||i.start();const e=new A({email:r.getVal(this,"email"),password:r.getVal(this,"password")}),o=await v.genPOST("login",U.WingsStructUtil.stringify(e));if(new S(o).ID===-1){(l=this.$data.loadingBar)==null||l.error(),this.$data.loading=!1,u.messageError("Wrong email or password. Please try again.");return}await w.genCurrentUser(),(d=this.$data.loadingBar)==null||d.finish(),this.$data.loading=!1,u.messageSuccess("You are now logged in."),await C.paramToNext(new Map,!0)},cancel(){P.back()}}}),O={class:"login narrow_content"},W={class:"narrow_display_window"},x={class:"forgotPassword"};function D(e,o,t,i,l,d){const h=a("CHead"),E=a("n-alert"),g=a("CEditItem"),f=a("n-button"),k=a("CLink");return _(),T("div",O,[s(h,{title:"Login",description:"Login to your GlobeTrotte account."}),o[4]||(o[4]=n("h1",{class:"title"},"Login",-1)),e.showError?(_(),V(E,{key:0,class:"tripPrivateAlertBar",title:"Please login to continue.",type:"error"})):b("",!0),n("form",W,[s(g,{class:"loginUsernameItem",label:"Email",ref:"email",className:"loginUsername",onEnter:e.confirm},null,8,["onEnter"]),s(g,{label:"Password",ref:"password",className:"loginPassword",type:"password",onEnter:e.confirm},null,8,["onEnter"]),o[2]||(o[2]=n("br",null,null,-1)),s(f,{class:"loginConfirm left_col",type:"info",onClick:e.confirm,loading:e.loading},{default:c(()=>o[0]||(o[0]=[p("Confirm")])),_:1},8,["onClick","loading"]),s(f,{class:"loginCancel right_col",type:"default",onClick:e.cancel},{default:c(()=>o[1]||(o[1]=[p("Cancel")])),_:1},8,["onClick"])]),n("p",x,[s(k,{url:e.resetLink},{default:c(()=>o[3]||(o[3]=[p("Forgot Password?")])),_:1},8,["url"])])])}const oo=H(M,[["render",D],["__scopeId","data-v-2195b5d3"]]);export{oo as default};
