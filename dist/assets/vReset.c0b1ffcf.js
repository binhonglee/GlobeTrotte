import{resolveComponent as p,openBlock as f,createElementBlock as u,createVNode as o,withKeys as E,withCtx as i,createElementVNode as d,pushScopeId as v,popScopeId as y,createTextVNode as l,defineComponent as P}from"vue";import{C as k,E as t}from"./E.7cace6b2.js";import{C as R}from"./CLink.ec785f29.js";import{_ as N,N as S,b as w,R as c,a as g,ao as h}from"./index.18ba2282.js";import{N as a}from"./NaiveUtils.2ea9fd11.js";import"./Input.6596a750.js";import"workbox-window";class V{constructor(s){this.email="",this.code="",this.password="",s&&(this.email=s.email!==void 0&&s.email!==null?s.email:"",this.code=s.code!==void 0&&s.code!==null?s.code:"",this.password=s.password!==void 0&&s.password!==null?s.password:"")}toJsonKey(s){switch(s){case"email":return"email";case"code":return"code";case"password":return"password";default:return s}}}const _=e=>(v("data-v-3b65931e"),e=e(),y(),e),I={class:"password_reset narrow_content"},L=_(()=>d("h1",{class:"title"},"Reset Password",-1)),T={key:0,class:"resetPasswordStart narrow_display_window"},$=_(()=>d("br",null,null,-1)),b=l("Confirm"),K=l("Cancel"),B={class:"backToLogin"},M=l("Back to Login"),O={key:1,class:"resetPasswordInput narrow_display_window"},U=_(()=>d("br",null,null,-1)),q=l("Confirm"),A=l("Cancel");function F(e,s,m,J,W,z){const n=p("CEditItem"),r=p("n-button"),C=p("CLink");return f(),u("div",I,[L,e.step<2?(f(),u("form",T,[o(n,{className:"emailInput",label:"Email",ref:"email",val:e.email,onKeydown:E(e.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),$,o(r,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmEmail,loading:e.loading},{default:i(()=>[b]),_:1},8,["onClick","loading"]),o(r,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:i(()=>[K]),_:1},8,["onClick"]),d("p",B,[o(C,{url:e.loginLink},{default:i(()=>[M]),_:1},8,["url"])])])):(f(),u("form",O,[o(n,{className:"resetEmail",label:"Email",ref:"email",val:e.email,onEnter:e.confirmReset},null,8,["val","onEnter"]),o(n,{className:"resetCode",label:"Code",ref:"code",onEnter:e.confirmReset},null,8,["onEnter"]),o(n,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),o(n,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),U,o(r,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmReset,loading:e.loading},{default:i(()=>[q]),_:1},8,["onClick","loading"]),o(r,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:i(()=>[A]),_:1},8,["onClick"])]))])}const H=P({components:{CEditItem:k,CLink:R,NButton:S},data:()=>({email:"",step:0,loginLink:w.Login,loading:!1}),async mounted(){this.$data.step<2?t.get(t.get(this,"email"),"input").focus():t.get(t.get(this,"code"),"input").focus()},async beforeMount(){var s,m;const e=c.getParamMap();this.$data.email=(s=e.get("email"))!=null?s:"",this.$data.step=+((m=e.get("step"))!=null?m:""),a.init()},methods:{async confirmEmail(){await g.genPOST("reset/send_email",h.stringify(t.getVal(this,"email")))?(a.messageSuccess("Password reset code sent!"),await c.genRefreshRedirect(w.password_Reset,new Map(Object.entries({email:t.getVal(this,"email"),step:"2"})))):a.messageError("Account not found with email.")},async confirmReset(){if(t.getVal(this,"password").localeCompare(t.getVal(this,"confPassword"))){a.dialogError({title:"Fail",content:"Password does not match.",positiveText:"OK"}),this.$data.loading=!1;return}const e=new V;e.email=t.getVal(this,"email"),e.code=t.getVal(this,"code"),e.password=t.getVal(this,"password"),await g.genPOST("reset/password",h.stringify(e))?(a.messageSuccess("Password reset is successful."),await c.genRedirectTo(w.Login)):a.messageError("Password reset attempt failed.")},async cancel(){await c.paramToNext()}}});var j=N(H,[["render",F],["__scopeId","data-v-3b65931e"]]);export{j as default};
