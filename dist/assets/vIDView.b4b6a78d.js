import{resolveComponent as o,openBlock as a,createElementBlock as r,createElementVNode as i,createVNode as e,Fragment as b,renderList as k,withCtx as c,pushScopeId as N,popScopeId as S,defineComponent as w,createBlock as _,createCommentVNode as v,toDisplayString as l,createTextVNode as u}from"vue";import{C as A}from"./CHead.51847178.js";import{c as M,d as H,_ as g,at as R,N as j,T as h,a as O,b as E,G as C,ao as q,R as L}from"./index.18ba2282.js";import{N as x,C as G}from"./CPlaces.1137877f.js";import{C as F,T as K}from"./CEditTrip.1d9482ed.js";import{C as W}from"./CLink.ec785f29.js";import{C as z}from"./CShare.2bfa6647.js";import{N as J,C as Q,D as X}from"./DataProps.0be84455.js";import{N as y,a as Y}from"./NaiveUtils.2ea9fd11.js";import{s as Z}from"./TripUtil.b5af45f0.js";import"workbox-window";import"./Input.6596a750.js";import"./E.7cace6b2.js";import"./CacheStorage.97a6bb6c.js";import"./Select.1f9bf9a6.js";const U=t=>(N("data-v-19df97e0"),t=t(),S(),t),tt={class:"loading_trip_info narrow_display_window"},et={class:"narrow_content"},it={class:"row"},at=U(()=>i("p",{class:"tripCreatorInfo"},"Author:",-1)),st={class:"row"},ot=U(()=>i("p",{class:"tripUpdatedDate"},"Last Updated:",-1)),nt={class:"row"},rt=U(()=>i("p",{class:"tripCreatedDate"},"Created on:",-1)),dt={class:"loadingDays"};function pt(t,n,d,T,D,I){const s=o("n-skeleton"),p=o("n-divider"),f=o("n-card");return a(),r("div",tt,[i("div",et,[e(s,{height:"40px"}),e(s,{text:""}),i("div",it,[at,e(s,{class:"inline_text",text:"",width:"30%"})]),i("div",st,[ot,e(s,{class:"inline_text",text:"",width:"30%"})]),i("div",nt,[rt,e(s,{class:"inline_text",text:"",width:"30%"})]),e(s,{class:"cities",height:"28px",width:"200px"}),e(s,{class:"share",height:"35px",width:"75px"})]),i("div",dt,[(a(),r(b,null,k(3,m=>e(f,{class:"loadingDayCard",key:m,"content-style":"padding: 0"},{default:c(()=>[e(s,{class:"loadingDayTitle",height:"20px"}),e(p),e(s,{class:"loadingDayText",text:"",row:2}),e(p),e(s,{class:"loadingDayText lastLoadingDayText",text:"",row:2})]),_:2},1024)),64))])])}const lt=w({name:"CLoadingTripInfo",components:{NCard:M,NDivider:H,NSkeleton:x}});var ct=g(lt,[["render",pt],["__scopeId","data-v-19df97e0"]]);const _t={key:0,class:"view_trip"},ht={class:"narrow_content"},ut=u("Only you can see this trip."),ft={class:"tripName left_col"},mt={key:1,class:"tripDescription"},$t={class:"tripCreatorInfo"},vt=u("Author: "),Ct={class:"tripUpdatedDate"},yt={class:"tripCreatedDate"},wt={class:"tripCities"},gt={class:"viewDays"},Tt={class:"viewDayCardContent"},Dt={class:"dayTitle"},It={class:"narrow_content enableTripEdit"},bt=u("Edit");function kt(t,n,d,T,D,I){const s=o("n-alert"),p=o("CLink"),f=o("n-tag"),m=o("CShare"),V=o("CPlaces"),P=o("n-card"),B=o("n-button");return t.trip!==void 0?(a(),r("div",_t,[i("div",ht,[t.trip.details.private?(a(),_(s,{key:0,class:"tripPrivateAlertBar",title:"Trip is private",type:"info"},{default:c(()=>[ut]),_:1})):v("",!0),i("h2",ft,l(t.trip.details.name),1),t.trip.details.description!==""?(a(),r("p",mt,l(t.trip.details.description),1)):v("",!0),i("p",$t,[vt,e(p,{url:"/user/"+t.trip.user.username},{default:c(()=>[u(l(t.trip.user.name),1)]),_:1},8,["url"])]),i("p",Ct,"Last Updated: "+l(t.lastUpdated),1),i("p",yt,"Created on: "+l(t.created),1),i("div",wt,[(a(!0),r(b,null,k(t.cities,$=>(a(),_(f,{class:"tripCity",type:"info"},{default:c(()=>[u(l($),1)]),_:2},1024))),256))]),e(m,{shareURL:t.shareURL},null,8,["shareURL"])]),i("div",gt,[(a(!0),r(b,null,k(t.days,$=>(a(),_(P,{class:"viewDayCard",key:$.ID.valueOf(),"content-style":"padding: 0"},{default:c(()=>[i("div",Tt,[i("h3",Dt,"Day "+l($.dayOf),1),e(V,{propPlaces:$.propPlaces},null,8,["propPlaces"])])]),_:2},1024))),128))]),i("div",It,[t.editable?(a(),_(B,{key:0,class:"editTripButton right_col",onClick:t.enableEditMode},{default:c(()=>[bt]),_:1},8,["onClick"])):v("",!0)])])):v("",!0)}const Et=w({name:"CViewTrip",components:{CLink:W,CPlaces:G,CShare:z,NAlert:R,NButton:j,NCard:M,NTag:J},props:{trip:{type:h,required:!0},editable:{type:Boolean}},emits:{enableEditMode(){return!0}},data:()=>({days:[],cities:[],shareURL:"",created:"",lastUpdated:""}),beforeMount(){this.$data.cities=[];for(let t of this.$props.trip.details.cities)this.$data.cities.push(Q.toString(t));this.$data.days=this.$props.trip.details.days.slice(0).map(t=>new X(t)),this.$data.shareURL=O.getAbsoluteURL(E.trip_View,this.$props.trip.ID.toString()),this.$data.created=C.getDisplayDate(this.$props.trip.timeCreated),this.$data.lastUpdated=C.getDisplayDate(this.$props.trip.lastUpdated)},methods:{enableEditMode(){this.$emit("enableEditMode")}}});var Ut=g(Et,[["render",kt],["__scopeId","data-v-68bcdfd2"]]);const Lt={class:"trip_info narrow_display_window"},Nt={key:0,class:"view_trip_info"},St={key:1,class:"edit_trip_info"};function Mt(t,n,d,T,D,I){const s=o("CViewTrip"),p=o("CEditTrip");return a(),r("div",Lt,[t.editMode?(a(),r("div",St,[e(p,{trip:t.dtrip,isNew:!1,onSave:t.save,onCancel:t.cancel},null,8,["trip","onSave","onCancel"])])):(a(),r("div",Nt,[e(s,{trip:t.dtrip,editable:t.editable,onEnableEditMode:t.enableEditMode},null,8,["trip","editable","onEnableEditMode"])]))])}const Rt=w({name:"CTripInfo",components:{CViewTrip:Ut,CEditTrip:F},props:{trip:{type:h,required:!0},editable:{type:Boolean}},data:()=>({editMode:!1,dtrip:new h}),beforeMount(){this.$data.editMode=!1,this.$data.dtrip=this.$props.trip,y.init()},methods:{async save(t){const n=this.$props.trip;n.details=t;const d=await O.genPOST("v2/trip/"+t.ID,q.stringify(n));d?(this.$data.dtrip=new h(d),this.$data.editMode=!1):y.dialogError({title:"Error",content:"Save was unsuccessful. Please try again later.",positiveText:"OK"})},cancel(){this.$data.editMode=!1},enableEditMode(){this.$data.editMode=!0}}});var Ot=g(Rt,[["render",Mt]]);const Vt=t=>(N("data-v-33332509"),t=t(),S(),t),Pt={class:"get_view_trip"},Bt={key:0,class:"narrow_content tapToUpdate"},At=u("Press here to view latest version of this profile."),Ht=Vt(()=>i("h1",{class:"title"},"Trip",-1));function jt(t,n,d,T,D,I){const s=o("CHead"),p=o("n-alert"),f=o("CLoadingTripInfo"),m=o("CTripInfo");return a(),r("div",Pt,[e(s,{title:t.trip.details.name.valueOf(),description:t.trip.details.description.valueOf(),type:"article"},null,8,["title","description"]),t.updated!==null?(a(),r("div",Bt,[e(p,{title:"There's an update!",type:"warning",onClick:t.update},{default:c(()=>[At]),_:1},8,["onClick"])])):v("",!0),Ht,t.trip.ID===-1?(a(),_(f,{key:1})):(a(),_(m,{key:2,trip:t.trip,editable:t.owner},null,8,["trip","editable"]))])}const qt=w({components:{CHead:A,CLoadingTripInfo:ct,CTripInfo:Ot,NAlert:R},data(){return{inputID:"",trip:new h,updated:null,owner:!1}},beforeMount(){y.init()},async mounted(){await this.init()},methods:{async init(){const t=C.paramID();if(t===void 0){this.$data.trip=new h,await L.genRedirectTo(E.trip_Search);return}this.$data.inputID=t;const n=await K.genObj(t);if(n.completed!==null&&(this.$data.trip=n.completed),n.promise!==null){const d=await n.promise;d!==null&&!Z(d,this.$data.trip)&&(this.$data.updated=d)}if(this.$data.trip.ID!==-1){this.$data.owner=C.getIsCurrentUser(this.$data.trip.user.ID.valueOf());return}y.notifyTrigger("Error","Trip not found.",Y.ERROR),await L.genRedirectTo(E.trip_Search)},update(){this.$data.updated!==null&&(this.$data.trip=this.$data.updated),this.$data.updated=null}}});var se=g(qt,[["render",jt],["__scopeId","data-v-33332509"]]);export{se as default};
