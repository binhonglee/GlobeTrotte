import{C as x,E as b}from"./CEditItem.1de58d5f.js";import{C as ee}from"./CHead.83321d7f.js";import{C as te}from"./CLink.cebded6b.js";import{a as H,C as se}from"./CLoadingTripPreviewCard.f0ba90fe.js";import{d as D,l as ae,m as W,r as o,o as a,c as n,a as i,e as c,F as N,i as P,p as M,b as q,_ as R,a_ as J,N as K,b8 as S,R as v,g as h,f as w,t as E,q as d,j as C,w as l,k as u,aV as B,G as T,b9 as ie}from"./index.16c9338e.js";import{N as oe,a as ne}from"./CPlaces.da596960.js";import{C as re}from"./CShare.4980cc72.js";import{a as le}from"./TripUtil.adedf1e3.js";import{N as p}from"./NaiveUtils.7c17dcc2.js";import{C as Y,a as z,P as Q,b as X,F as Z,s as de,p as ue}from"./UserUtil.4f6f95ad.js";import"./Input.e512ea71.js";import"./DataProps.e2a16a90.js";const ce=D({name:"CLoadingViewUser",components:{NCard:ae,NDivider:W,NSkeleton:oe,CLoadingTripPreviewCard:H}}),pe=e=>(M("data-v-0521177c"),e=e(),q(),e),he={class:"loading_view_user"},me={class:"narrow_content"},fe=pe(()=>c("h2",null,"Trips",-1));function ge(e,t,s,r,y,j){const g=o("n-skeleton"),_=o("n-divider"),m=o("CLoadingTripPreviewCard");return a(),n("div",he,[i(g,{class:"loading_user_name",height:"40px",width:"100px"}),c("div",me,[i(g,{text:"",repeat:5})]),i(_),fe,(a(),n(N,null,P(5,$=>i(m,{key:$,wide:!0,"limit-height":!1})),64))])}const _e=R(ce,[["render",ge],["__scopeId","data-v-0521177c"]]),ve=D({name:"CViewUser",components:{CExternalLink:ne,CShare:re,CTripPreviewCard:se,NAlert:J,NButton:K,NDivider:W,CLoadingTripPreviewCard:H},props:{user:{type:S,required:!0},showName:{type:Boolean,default:!0},self:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1}},emits:{logout(){return!0},toggleEdit(){return!0}},data:()=>({trips:[],tripsEmpty:!0,loading:!0,shareURL:""}),async beforeMount(){await this.genPopulateTrips()},async beforeUpdate(){await this.genPopulateTrips()},methods:{async genPopulateTrips(){this.$data.loading=!0,this.$data.trips=this.$props.user.trips,le(this.$data.trips),this.$data.tripsEmpty=this.$data.trips.length<=0,this.$data.loading=!1},logout(){this.$emit("logout")},toggleEdit(){this.$emit("toggleEdit")},async newTrip(){await v.genRedirectTo(h.trip_New)},onShare(){let e=this.$props.user.details.username.valueOf();e===""&&(e=this.$props.user.details.ID.toString()),this.$data.shareURL=w.getAbsoluteURL(h.User,e)}}}),Ce=e=>(M("data-v-8aaca002"),e=e(),q(),e),we={class:"view_user"},ye={class:"userInfo narrow_content"},$e={key:0,class:"userName left_col"},ke={key:1,class:"userBio"},be={class:"externalLink"},Te={key:3,class:"userInfoButtonGroups"},Ee=u("Logout"),Ue=u("Edit"),Le={key:0,class:"viewUserTrips"},Se=Ce(()=>c("h2",null,"Trips",-1)),Oe={key:2,class:"createTripAlertDiv"},Ie=u("Seems like you have not shared any of your own trips."),Ne=u("Create New Trip");function Pe(e,t,s,r,y,j){const g=o("CExternalLink"),_=o("CShare"),m=o("n-button"),$=o("n-divider"),O=o("CLoadingTripPreviewCard"),f=o("CTripPreviewCard"),k=o("n-alert");return a(),n("div",we,[c("div",ye,[e.showName?(a(),n("h2",$e,E(e.user.details.name),1)):d("",!0),e.user.details.bio!==""?(a(),n("p",ke,E(e.user.details.bio),1)):d("",!0),c("div",be,[e.user.details.link!==""?(a(),C(g,{key:0,underline:"hover",url:e.user.details.link.valueOf()},{default:l(()=>[u(E(e.user.details.link),1)]),_:1},8,["url"])):d("",!0)]),e.self?(a(),C(_,{key:2,shareURL:e.shareURL,onClick:e.onShare},null,8,["shareURL","onClick"])):d("",!0),e.self?(a(),n("div",Te,[i(m,{class:"myAccountLogout left_col",type:"error",onClick:e.logout},{default:l(()=>[Ee]),_:1},8,["onClick"]),i(m,{class:"myAccountEdit right_col",type:"default",ref:"edit",onClick:e.toggleEdit},{default:l(()=>[Ue]),_:1},8,["onClick"])])):d("",!0)]),i($,{class:"viewUserDivider"}),e.loading||e.self||!e.tripsEmpty?(a(),n("div",Le,[Se,e.loading?(a(),n(N,{key:0},P(5,I=>i(O,{key:I,wide:!0,"limit-height":!1})),64)):(a(!0),n(N,{key:1},P(e.trips,I=>(a(),C(f,{trip:I,wide:!0,"limit-height":!1},null,8,["trip"]))),256)),e.self&&e.tripsEmpty?(a(),n("div",Oe,[i(k,{class:"createTripAlert",type:"default","show-icon":!1},{default:l(()=>[Ie,e.confirmed?(a(),C(m,{key:0,class:"createTripButton",type:"info",onClick:e.newTrip,size:"large"},{default:l(()=>[Ne]),_:1},8,["onClick"])):d("",!0)]),_:1})])):d("",!0)])):d("",!0)])}const Be=R(ve,[["render",Pe],["__scopeId","data-v-8aaca002"]]);class U extends X{static fromJSON(t){return new U(t)}getObj(){return new S(JSON.parse(this.obj))}}class F extends Z{}class A extends Y{constructor(){super(...arguments),this.storage=z.USER,this.storeCount=10}async genFetch(t){const s=await w.genGET("username/"+t),r=new S(s);return Q.isPWA()?s!==""?(this.storeObj(F,U,B.stringify(r),r.details.username.valueOf()),r):null:r}static genObj(t){return new A().genObjImpl(F,U,t)}}class L extends X{static fromJSON(t){return new L(t)}getObj(){return this.obj}}class G extends Z{}class V extends Y{constructor(){super(...arguments),this.storage=z.USERNAME,this.storeCount=20}async genFetch(t){const s=await w.genGET("v2/username/"+t);return Q.isPWA()?s!==""?(this.storeObj(G,L,s,t),s):null:s}static genObj(t){return new V().genObjImpl(G,L,t)}}const De=D({components:{CEditItem:x,CHead:ee,CLink:te,CLoadingViewUser:_e,CViewUser:Be,NAlert:J,NButton:K},data:()=>({user:new S,edit:!1,self:!1,unconfirmedLink:h.unconfirmed_Email,updated:null,loadingBar:T.loadingBar()}),async beforeMount(){await this.init()},methods:{async init(){p.init();const e=T.paramID();if(e===void 0){await v.genRedirectTo(h.NotFound);return}if(isNaN(Number(e))){const t=await A.genObj(e);if(t.completed!==null&&(this.$data.user=t.completed,this.dataProcessing(t.fromStorage)),t.promise!==null){const s=await t.promise;s!==null&&!de(s,this.$data.user)&&(this.$data.updated=s)}}else{const s=(await V.genObj(e)).completed;if(s!==null&&s!=="")return await v.genRedirectTo(h.User+"/"+s),await this.init()}this.$data.user.ID===-1&&(T.paramID()===T.getCurrentUsername()&&await this.logout(),p.dialogError({title:"User not found",content:"The user you are looking for does not exist.",positiveText:"OK",onPositiveClick:async()=>{await v.genRedirectTo(h.Landing)}}))},dataProcessing(e){this.$data.user.ID!==-1&&(this.$data.self=T.getIsCurrentUser(this.$data.user.ID.valueOf()),e?this.$data.user.details.bio=this.$data.user.details.bio.valueOf():this.$data.user.details.bio=this.$data.user.details.bio.valueOf())},update(){this.$data.updated!==null&&(this.$data.user=this.$data.updated,this.dataProcessing(!1)),this.$data.updated=null},confirmDelete(){p.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var t,s,r;(t=this.$data.loadingBar)==null||t.start(),await w.genDELETE("v2/user/"+this.$data.user.ID,B.stringify(this.$data.user.details))?(localStorage.clear(),(s=this.$data.loadingBar)==null||s.finish(),p.messageInfo("Your account is now deleted."),await v.genRedirectTo(h.Landing)):((r=this.$data.loadingBar)==null||r.error(),p.messageError("Account deletion attempt failed."))},async save(){var s,r,y;(s=this.$data.loadingBar)==null||s.start();const e=new ie({id:this.$data.user.ID,name:b.getVal(this,"name"),email:b.getVal(this,"email"),bio:ue(b.getVal(this,"bio")),link:b.getVal(this,"link"),username:b.getVal(this,"username"),confirmed:this.$data.user.details.confirmed});await w.genPOST("v2/user/"+this.$data.user.ID,B.stringify(e))!==!1?(this.toggleEdit(),(r=this.$data.loadingBar)==null||r.finish(),p.messageSuccess("Profile updated successfully!"),await this.init()):((y=this.$data.loadingBar)==null||y.error(),p.dialogError({title:"Fail",content:"Save was unsuccessful. Please try again later.",positiveText:"OK"}))},async logout(){await w.genGET("logout"),localStorage.clear(),p.messageSuccess("You are now logged out."),await v.genRedirectTo(h.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}}),Re={class:"get_user"},Ae={key:0,class:"narrow_content accountUnconfirmedAlertBar"},Ve=u("Please confirm you email address to access the full site."),je={key:1,class:"narrow_content tapToUpdate"},Fe=u("Press here to view latest version of this profile."),Ge={key:3,class:"userinfo"},He={class:"title"},We={class:"profile_info"},Me={key:1,class:"narrow_content"},qe={class:"myAccountButtonGroups"},Je=u("Save"),Ke=u("Cancel"),Ye={class:"myAccountDeletion"},ze=u("Delete Account");function Qe(e,t,s,r,y,j){const g=o("CHead"),_=o("n-alert"),m=o("CLink"),$=o("CLoadingViewUser"),O=o("CViewUser"),f=o("CEditItem"),k=o("n-button");return a(),n("div",Re,[i(g,{title:e.user.details.name.valueOf(),description:e.user.details.bio.valueOf(),type:"profile"},null,8,["title","description"]),e.self&&!e.user.details.confirmed?(a(),n("div",Ae,[i(m,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:l(()=>[i(_,{title:"Unconfirmed",type:"error"},{default:l(()=>[Ve]),_:1})]),_:1},8,["url"])])):d("",!0),e.updated!==null?(a(),n("div",je,[i(_,{title:"There's an update!",type:"warning",onClick:e.update},{default:l(()=>[Fe]),_:1},8,["onClick"])])):d("",!0),e.user.ID===-1?(a(),C($,{key:2})):(a(),n("div",Ge,[c("h1",He,E(e.user.details.name),1),c("div",We,[e.edit?(a(),n("div",Me,[i(f,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),i(f,{label:"Username",ref:"username",val:e.user.details.username.valueOf(),placeholder:"Set a username"},null,8,["val"]),i(f,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),i(f,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),i(f,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),c("div",qe,[i(k,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:l(()=>[Je]),_:1},8,["onClick"]),i(k,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:l(()=>[Ke]),_:1},8,["onClick"])]),c("div",Ye,[i(k,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:l(()=>[ze]),_:1},8,["onClick"])])])):(a(),C(O,{key:0,user:e.user,showName:!1,self:e.self,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","self","onLogout","onToggleEdit"]))])]))])}const dt=R(De,[["render",Qe],["__scopeId","data-v-e50db14a"]]);export{dt as default};
