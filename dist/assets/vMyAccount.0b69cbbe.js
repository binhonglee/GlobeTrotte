import{C as w,E as i}from"./E.9cfad27d.js";import{C as A}from"./CLink.052211e9.js";import{C as E}from"./CViewUser.80bc5d38.js";import{_ as b,U as B,a as c,G as h,R as _,H as p,d as L}from"./index.c91018d5.js";import{r as n,o as u,d as v,i as o,e as t,w as l,f as T,g as U,h as m,j as V,I as j,t as D,W as y}from"./vendor.ac364b71.js";import"./CPlaces.4eb02410.js";import"./CTripPreviewCard.1ea667c7.js";import"./DataProps.31d9417b.js";import"./TripUtil.cf3da4e6.js";const I={class:"my_account"},O=o("h1",{class:"title"},"My Account",-1),P={class:"narrow_content accountUnconfirmedAlertBar"},N=m("Please confirm you email address to access the full site."),R={class:"profileInfo"},S={key:0},G={key:1,class:"narrow_content"},M={class:"myAccountButtonGroups"},H=m("Save"),W=m("Cancel"),q={class:"myAccountDeletion"},F=m("Delete Account");function K(e,r,a,s,f,z){const C=n("n-alert"),$=n("CLink"),k=n("CViewUser"),d=n("CEditItem"),g=n("n-button");return u(),v("div",I,[O,o("div",P,[t($,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:l(()=>[e.confirmed?U("",!0):(u(),T(C,{key:0,title:"Unconfirmed",type:"error"},{default:l(()=>[N]),_:1}))]),_:1},8,["url"])]),o("div",R,[e.edit?(u(),v("div",G,[t(d,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(d,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(d,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),t(d,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),o("div",M,[t(g,{class:"myAccountSave",type:"info",onClick:e.save},{default:l(()=>[H]),_:1},8,["onClick"]),t(g,{class:"myAccountCancel",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:l(()=>[W]),_:1},8,["onClick"])]),o("div",q,[t(g,{class:"myAccountDelete",type:"error",onClick:e.deleteAccount},{default:l(()=>[F]),_:1},8,["onClick"])])])):(u(),v("div",S,[t(k,{user:e.user,self:!0,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","onLogout","onToggleEdit"])]))])])}const Y=V({components:{CEditItem:w,CLink:A,CViewUser:E,NAlert:j,NButton:D},data(){return{user:new B,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:c.unconfirmed_Email,loadingBar:h.loadingBar()}},beforeMount(){this.init()},mounted(){this.$data.edit&&i.get(i.get(this,"name"),"input").focus()},methods:{async init(){this.$data.loading=!0,this.$data.user=await h.genCurrentUser(),this.$data.user.details.bio=this.$data.user.details.bio.replaceAll("\\n",`
`),this.$data.user.ID===-1&&await _.genRedirectTo(c.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf(),this.$data.loading=!1},async deleteAccount(){var r,a,s;(r=this.$data.loadingBar)==null||r.start(),await p.genDELETE("v2/user/"+this.$data.user.ID,y.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(h.notifConfig("Deleted","Your account is now deleted.","info")),(a=this.$data.loadingBar)==null||a.finish(),await _.genRedirectTo(c.Landing)):((s=this.$data.loadingBar)==null||s.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var a,s,f;(a=this.$data.loadingBar)==null||a.start();const e=new L({id:this.$data.user.ID,name:i.getVal(this,"name"),email:i.getVal(this,"email"),bio:i.getVal(this,"bio").replaceAll("\\t","	").replaceAll("	","").replaceAll(`
`,"\\\\n").replaceAll("\\","\\\\"),link:i.getVal(this,"link"),confirmed:this.$data.user.details.confirmed});await p.genPOST("v2/user/"+this.$data.user.ID,y.stringify(e))!==!1?(this.toggleEdit(),(s=this.$data.loadingBar)==null||s.finish(),this.$message({message:"Profile updated successfully!",type:"success"}),this.init()):((f=this.$data.loadingBar)==null||f.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await p.genGET("logout"),localStorage.clear(),await _.genRedirectTo(c.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ie=b(Y,[["render",K]]);export{ie as default};
