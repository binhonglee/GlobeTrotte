import{C as E,E as l}from"./E.34d210c7.js";import{C as A}from"./CViewUser.424a3c65.js";import{_ as b,U as D,a as f,G as _,R as h,H as p,c as T}from"./index.0627de76.js";import{r,A as U,o as c,d as v,B as V,f as y,w as i,i as o,e as t,g as L,h as d,j,W as C}from"./vendor.99a78856.js";import"./CTripPreviewCard.0f9e7a59.js";import"./CPlaces.4db6653f.js";const I={class:"my_account"},O=o("h1",{class:"title"},"My Account",-1),P={class:"profileInfo"},R={key:0},S={class:"narrow_content"},G={class:"myAccountButtonGroups"},N=d("Logout"),M=d("Edit"),H={key:1,class:"narrow_content"},W={class:"myAccountButtonGroups"},q=d("Save"),F=d("Cancel"),K={class:"myAccountDeletion"},Y=d("Delete Account");function z(e,u,a,s,m,Q){const $=r("el-alert"),w=r("el-link"),k=r("CViewUser"),n=r("el-button"),g=r("CEditItem"),B=U("loading");return c(),v("div",I,[O,V((c(),y(w,{class:"unconfirmedEmailLink",href:e.unconfirmedLink,underline:!1},{default:i(()=>[e.confirmed?L("",!0):(c(),y($,{key:0,class:"narrow_content accountUnconfirmedAlertBar",title:"Unconfirmed",description:"Please confirm you email address to access the full site.",type:"error",closable:!1,"show-icon":""}))]),_:1},8,["href"])),[[B,e.loading,void 0,{fullscreen:!0,lock:!0}]]),o("div",P,[e.edit?(c(),v("div",H,[t(g,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(g,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(g,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf()},null,8,["val"]),o("div",W,[t(n,{class:"myAccountSave",type:"primary",onClick:e.save},{default:i(()=>[q]),_:1},8,["onClick"]),t(n,{class:"myAccountCancel",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:i(()=>[F]),_:1},8,["onClick"])]),o("div",K,[t(n,{class:"myAccountDelete",type:"danger",onClick:e.deleteAccount},{default:i(()=>[Y]),_:1},8,["onClick"])])])):(c(),v("div",R,[t(k,{user:e.user},null,8,["user"]),o("div",S,[o("div",G,[t(n,{class:"myAccountLogout",type:"danger",onClick:e.logout},{default:i(()=>[N]),_:1},8,["onClick"]),t(n,{class:"myAccountEdit",tabindex:"0",type:"default",ref:"edit",onClick:e.toggleEdit},{default:i(()=>[M]),_:1},8,["onClick"])])])]))])])}const J=j({components:{CEditItem:E,CViewUser:A},data(){return{user:new D,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:f.unconfirmed_Email,loadingBar:_.loadingBar()}},async beforeMount(){this.$data.loading=!0,this.$data.user=await _.genCurrentUser(),this.$data.user.ID===-1&&await h.genRedirectTo(f.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf()},mounted(){this.$data.edit&&l.get(l.get(this,"name"),"input").focus(),this.$data.loading=!1},methods:{async deleteAccount(){var u,a,s;(u=this.$data.loadingBar)==null||u.start(),await p.genDELETE("v2/user/"+this.$data.user.ID,C.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(_.notifConfig("Deleted","Your account is now deleted.","info")),(a=this.$data.loadingBar)==null||a.finish(),await h.genRedirectTo(f.Landing)):((s=this.$data.loadingBar)==null||s.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var a,s,m;(a=this.$data.loadingBar)==null||a.start();const e=new T({id:this.$data.user.ID,name:l.getVal(this,"name"),email:l.getVal(this,"email"),bio:l.getVal(this,"bio"),confirmed:this.$data.user.details.confirmed});await p.genPOST("v2/user/"+this.$data.user.ID,C.stringify(e))?(this.toggleEdit(),(s=this.$data.loadingBar)==null||s.finish(),this.$message({message:"Profile updated successfully!",type:"success"})):((m=this.$data.loadingBar)==null||m.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await p.genGET("logout"),localStorage.clear(),await h.genRedirectTo(f.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var se=b(J,[["render",z]]);export{se as default};
