var y=Object.defineProperty;var k=(s,e,n)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[e]=n;var c=(s,e,n)=>k(s,typeof e!="symbol"?e+"":e,n);import{d as R,e as f,B as h,R as m,H as C,j as E,c as u,b as p,a,w as v,r as w,f as l,o as g,h as r,_ as N}from"./index-CVwEz7sZ.js";import{C as V,E as t}from"./CEditItem-CkORRj5K.js";import{C as _}from"./CLink-BZ5D-za9.js";import{N as o}from"./NaiveUtils-CaBEIltk.js";import"./Input-B0b2FwEY.js";class L{constructor(e){c(this,"email","");c(this,"code","");c(this,"password","");e&&(this.email=e.email!==void 0&&e.email!==null?e.email:"",this.code=e.code!==void 0&&e.code!==null?e.code:"",this.password=e.password!==void 0&&e.password!==null?e.password:"")}toJsonKey(e){switch(e){case"email":return"email";case"code":return"code";case"password":return"password";default:return e}}}const S=R({components:{CEditItem:V,CLink:_,NButton:h},data:()=>({email:"",step:0,loginLink:f.Login,loading:!1}),async mounted(){this.$data.step<2?t.get(t.get(this,"email"),"input").focus():t.get(t.get(this,"code"),"input").focus()},async beforeMount(){const s=m.getParamMap();this.$data.email=s.get("email")??"",this.$data.step=+(s.get("step")??""),o.init()},methods:{async confirmEmail(){await C.genPOST("reset/send_email",E.WingsStructUtil.stringify(t.getVal(this,"email")))?(o.messageSuccess("Password reset code sent!"),await m.genRefreshRedirect(f.password_Reset,new Map(Object.entries({email:t.getVal(this,"email"),step:"2"})))):o.messageError("Account not found with email.")},async confirmReset(){if(t.getVal(this,"password").localeCompare(t.getVal(this,"confPassword"))){o.dialogError({title:"Fail",content:"Password does not match.",positiveText:"OK"}),this.$data.loading=!1;return}const s=new L;s.email=t.getVal(this,"email"),s.code=t.getVal(this,"code"),s.password=t.getVal(this,"password"),await C.genPOST("reset/password",E.WingsStructUtil.stringify(s))?(o.messageSuccess("Password reset is successful."),await m.genRedirectTo(f.Login)):o.messageError("Password reset attempt failed.")},async cancel(){await m.paramToNext()}}}),T={class:"password_reset narrow_content"},$={key:0,class:"resetPasswordStart narrow_display_window"},B={class:"backToLogin"},I={key:1,class:"resetPasswordInput narrow_display_window"};function b(s,e,n,K,M,O){const i=w("CEditItem"),d=w("n-button"),P=w("CLink");return g(),u("div",T,[e[7]||(e[7]=p("h1",{class:"title"},"Reset Password",-1)),s.step<2?(g(),u("form",$,[a(i,{className:"emailInput",label:"Email",ref:"email",val:s.email,onKeydown:v(s.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),e[3]||(e[3]=p("br",null,null,-1)),a(d,{class:"resetPasswordSave left_col",type:"info",onClick:s.confirmEmail,loading:s.loading},{default:l(()=>e[0]||(e[0]=[r("Confirm")])),_:1},8,["onClick","loading"]),a(d,{class:"resetPasswordCancel right_col",type:"default",onClick:s.cancel},{default:l(()=>e[1]||(e[1]=[r("Cancel")])),_:1},8,["onClick"]),p("p",B,[a(P,{url:s.loginLink},{default:l(()=>e[2]||(e[2]=[r("Back to Login")])),_:1},8,["url"])])])):(g(),u("form",I,[a(i,{className:"resetEmail",label:"Email",ref:"email",val:s.email,onEnter:s.confirmReset},null,8,["val","onEnter"]),a(i,{className:"resetCode",label:"Code",ref:"code",onEnter:s.confirmReset},null,8,["onEnter"]),a(i,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:s.confirmReset},null,8,["onEnter"]),a(i,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:s.confirmReset},null,8,["onEnter"]),e[6]||(e[6]=p("br",null,null,-1)),a(d,{class:"resetPasswordSave left_col",type:"info",onClick:s.confirmReset,loading:s.loading},{default:l(()=>e[4]||(e[4]=[r("Confirm")])),_:1},8,["onClick","loading"]),a(d,{class:"resetPasswordCancel right_col",type:"default",onClick:s.cancel},{default:l(()=>e[5]||(e[5]=[r("Cancel")])),_:1},8,["onClick"])]))])}const J=N(S,[["render",b],["__scopeId","data-v-90ceb23f"]]);export{J as default};
