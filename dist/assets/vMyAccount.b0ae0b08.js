import{C as A,E as a}from"./E.b3ad2ebb.js";import{C as E}from"./CLink.2a3dd324.js";import{C as B}from"./CViewUser.164db8d3.js";import{r as i,o as d,c as p,a as t,e as r,w as l,p as S,b as I,h as T,l as L,i as m,_ as V,d as D,N as U,bf as N,k as u,G as h,R as _,j as v,aX as C,bg as R}from"./index.7eb2ba00.js";import{N as y}from"./NaiveUtils.7ea2d8e8.js";import{C as O}from"./CHead.1e361d86.js";import{N as P}from"./Alert.54d61180.js";import"./Input.4a5021ad.js";import"./CPlaces.a47b838a.js";import"./CShare.0ed777e5.js";import"./CLoadingTripPreviewCard.f2401070.js";import"./DataProps.38789569.js";import"./TripUtil.cf3da4e6.js";const H=e=>(S("data-v-13bf188b"),e=e(),I(),e),M={class:"my_account"},G=H(()=>r("h1",{class:"title"},"My Account",-1)),j={class:"narrow_content accountUnconfirmedAlertBar"},W=m("Please confirm you email address to access the full site."),Y={class:"profileInfo"},q={key:0},F={key:1,class:"narrow_content"},K={class:"myAccountButtonGroups"},X=m("Save"),z=m("Cancel"),J={class:"myAccountDeletion"},Q=m("Delete Account");function Z(e,c,s,o,f,ee){const $=i("CHead"),k=i("n-alert"),w=i("CLink"),b=i("CViewUser"),n=i("CEditItem"),g=i("n-button");return d(),p("div",M,[t($,{title:"My Accout",description:"Update your account settings.",type:"profile"}),G,r("div",j,[t(w,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:l(()=>[e.confirmed?L("",!0):(d(),T(k,{key:0,title:"Unconfirmed",type:"error"},{default:l(()=>[W]),_:1}))]),_:1},8,["url"])]),r("div",Y,[e.edit?(d(),p("div",F,[t(n,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(n,{label:"Username",ref:"username",val:e.user.details.username.valueOf(),placeholder:"Set a username"},null,8,["val"]),t(n,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(n,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),t(n,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),r("div",K,[t(g,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:l(()=>[X]),_:1},8,["onClick"]),t(g,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:l(()=>[z]),_:1},8,["onClick"])]),r("div",J,[t(g,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:l(()=>[Q]),_:1},8,["onClick"])])])):(d(),p("div",q,[t(b,{user:e.user,self:!0,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","onLogout","onToggleEdit"])]))])])}const x=D({components:{CEditItem:A,CLink:E,CViewUser:B,NAlert:P,NButton:U,CHead:O},data(){return{user:new N,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:u.unconfirmed_Email,loadingBar:h.loadingBar()}},beforeMount(){this.init()},mounted(){this.$data.edit&&a.get(a.get(this,"name"),"input").focus()},methods:{async init(){this.$data.loading=!0,y.init(),this.$data.user=await h.genCurrentUser(),this.$data.user.details.bio=this.$data.user.details.bio.replaceAll("\\n",`
`),this.$data.user.ID===-1&&await _.genRedirectTo(u.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf(),this.$data.loading=!1},confirmDelete(){y.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var c,s,o;(c=this.$data.loadingBar)==null||c.start(),await v.genDELETE("v2/user/"+this.$data.user.ID,C.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(h.notifConfig("Deleted","Your account is now deleted.","info")),(s=this.$data.loadingBar)==null||s.finish(),await _.genRedirectTo(u.Landing)):((o=this.$data.loadingBar)==null||o.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var s,o,f;(s=this.$data.loadingBar)==null||s.start();const e=new R({id:this.$data.user.ID,name:a.getVal(this,"name"),email:a.getVal(this,"email"),bio:a.getVal(this,"bio").replaceAll("\\t","	").replaceAll("	","").replaceAll(`
`,"\\\\n").replaceAll("\\","\\\\"),link:a.getVal(this,"link"),username:a.getVal(this,"username"),confirmed:this.$data.user.details.confirmed});await v.genPOST("v2/user/"+this.$data.user.ID,C.stringify(e))!==!1?(this.toggleEdit(),(o=this.$data.loadingBar)==null||o.finish(),this.$message({message:"Profile updated successfully!",type:"success"}),this.init()):((f=this.$data.loadingBar)==null||f.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await v.genGET("logout"),localStorage.clear(),y.messageSuccess("You are now logged out."),await _.genRedirectTo(u.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ge=V(x,[["render",Z],["__scopeId","data-v-13bf188b"]]);export{ge as default};
