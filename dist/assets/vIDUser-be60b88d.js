var x=Object.defineProperty;var ee=(e,s,t)=>s in e?x(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var k=(e,s,t)=>(ee(e,typeof s!="symbol"?s+"":s,t),t);import{C as te,E as b}from"./CEditItem-27b15f11.js";import{C as se}from"./CHead-aa5a2b5b.js";import{C as ae}from"./CLink-dd99619d.js";import{a as W,C as ie}from"./CLoadingTripPreviewCard-3659807e.js";import{d as R,m as ne,n as J,r as o,o as a,c as r,a as i,e as u,F as B,h as N,p as M,b as q,_ as A,k as K,N as Y,R as C,f,H as h,t as I,u as c,j as U,g as d,i as p,W as D,G as T}from"./index-331782fa.js";import{N as oe,a as re}from"./CPlaces-7b0da3ef.js";import{C as le}from"./CShare-75b21b62.js";import{a as de}from"./TripUtil-c834ea44.js";import{U as E}from"./UserObj-af660086.js";import{N as m}from"./NaiveUtils-778b4c56.js";import{U as ue}from"./TripObj-64bf0718.js";import{C as z,P as Q,a as X,F as Z,s as ce,p as pe}from"./UserUtil-0a716530.js";import"./Input-09d98989.js";import"./DataProps-b44a3c1a.js";const me=R({name:"CLoadingViewUser",components:{NCard:ne,NDivider:J,NSkeleton:oe,CLoadingTripPreviewCard:W}}),fe=e=>(M("data-v-0521177c"),e=e(),q(),e),he={class:"loading_view_user"},ge={class:"narrow_content"},_e=fe(()=>u("h2",null,"Trips",-1));function ve(e,s,t,n,l,F){const g=o("n-skeleton"),_=o("n-divider"),v=o("CLoadingTripPreviewCard");return a(),r("div",he,[i(g,{class:"loading_user_name",height:"40px",width:"100px"}),u("div",ge,[i(g,{text:"",repeat:5})]),i(_),_e,(a(),r(B,null,N(5,y=>i(v,{key:y,wide:!0,"limit-height":!1})),64))])}const we=A(me,[["render",ve],["__scopeId","data-v-0521177c"]]),Ce=R({name:"CViewUser",components:{CExternalLink:re,CShare:le,CTripPreviewCard:ie,NAlert:K,NButton:Y,NDivider:J,CLoadingTripPreviewCard:W},props:{user:{type:E,required:!0},showName:{type:Boolean,default:!0},self:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1}},emits:{logout(){return!0},toggleEdit(){return!0}},data:()=>({trips:[],tripsEmpty:!0,loading:!0,shareURL:""}),async beforeMount(){await this.genPopulateTrips()},async beforeUpdate(){await this.genPopulateTrips()},methods:{async genPopulateTrips(){this.$data.loading=!0,this.$data.trips=this.$props.user.trips,de(this.$data.trips),this.$data.tripsEmpty=this.$data.trips.length<=0,this.$data.loading=!1},logout(){this.$emit("logout")},toggleEdit(){this.$emit("toggleEdit")},async newTrip(){await C.genRedirectTo(f.trip_New)},onShare(){let e=this.$props.user.details.username.valueOf();e===""&&(e=this.$props.user.details.ID.toString()),this.$data.shareURL=h.getAbsoluteURL(f.User,e)}}}),ye=e=>(M("data-v-b2a08393"),e=e(),q(),e),$e={class:"view_user"},ke={class:"userInfo narrow_content"},be={key:0},Te={class:"username left_col"},Ue={key:1,class:"userBio"},Ee={class:"externalLink"},Ie={key:2,class:"userInfoButtonGroups"},Le={key:0,class:"viewUserTrips"},Se=ye(()=>u("h2",null,"Trips",-1)),Oe={key:2,class:"createTripAlertDiv"};function Pe(e,s,t,n,l,F){const g=o("CExternalLink"),_=o("CShare"),v=o("n-button"),y=o("n-divider"),O=o("CLoadingTripPreviewCard"),w=o("CTripPreviewCard"),$=o("n-alert");return a(),r("div",$e,[u("div",ke,[e.user.details.username!==""?(a(),r("h3",be,[u("code",Te,"@"+I(e.user.details.username),1)])):c("",!0),e.user.details.bio!==""?(a(),r("p",Ue,I(e.user.details.bio),1)):c("",!0),u("div",Ee,[e.user.details.link!==""?(a(),U(g,{key:0,underline:"hover",url:e.user.details.link.valueOf()},{default:d(()=>[p(I(e.user.details.link),1)]),_:1},8,["url"])):c("",!0)]),e.self?(a(),r("div",Ie,[i(_,{class:"left_col",shareURL:e.shareURL,onClick:e.onShare},null,8,["shareURL","onClick"]),i(v,{class:"myAccountEdit right_col",type:"default",ref:"edit",onClick:e.toggleEdit},{default:d(()=>[p("Edit")]),_:1},8,["onClick"])])):c("",!0)]),i(y,{class:"viewUserDivider"}),e.loading||e.self||!e.tripsEmpty?(a(),r("div",Le,[Se,e.loading?(a(),r(B,{key:0},N(5,P=>i(O,{key:P,wide:!0,"limit-height":!1})),64)):(a(!0),r(B,{key:1},N(e.trips,P=>(a(),U(w,{trip:P,wide:!0,"limit-height":!1},null,8,["trip"]))),256)),e.self&&e.tripsEmpty?(a(),r("div",Oe,[i($,{class:"createTripAlert",type:"default","show-icon":!1},{default:d(()=>[p("Seems like you have not shared any of your own trips."),e.confirmed?(a(),U(v,{key:0,class:"createTripButton",type:"info",onClick:e.newTrip,size:"large"},{default:d(()=>[p("Create New Trip")]),_:1},8,["onClick"])):c("",!0)]),_:1})])):c("",!0)])):c("",!0)])}const Be=A(Ce,[["render",Pe],["__scopeId","data-v-b2a08393"]]);class L extends X{static fromJSON(s){return new L(s)}getObjImpl(s){return new E(JSON.parse(s))}}class G extends Z{}class V extends z{constructor(){super(...arguments);k(this,"storage","user");k(this,"storeCount",10)}async genFetch(t){const n=await h.genGET("username/"+t),l=new E(n);return Q.isPWA()?n!==""?(this.storeObj(G,L,l.details.username.valueOf(),D.stringify(l,!0)),l):null:l}static genObj(t){return new V().genObjImpl(G,L,t)}}class S extends X{static fromJSON(s){return new S(s)}getObjImpl(s){return this.obj}}class H extends Z{}class j extends z{constructor(){super(...arguments);k(this,"storage","username");k(this,"storeCount",20)}async genFetch(t){const n=await h.genGET("v2/username/"+t);return Q.isPWA()?n!==""?(this.storeObj(H,S,n,t),n):null:n}static genObj(t){return new j().genObjImpl(H,S,t)}}const Ne=R({components:{CEditItem:te,CHead:se,CLink:ae,CLoadingViewUser:we,CViewUser:Be,NAlert:K,NButton:Y},data:()=>({user:new E,edit:!1,self:!1,unconfirmedLink:f.unconfirmed_Email,updated:null,loadingBar:T.loadingBar()}),async beforeMount(){await this.init()},methods:{async init(){m.init();const e=T.paramID();if(e===void 0){await C.genRedirectTo(f.NotFound);return}if(isNaN(Number(e))){const s=await V.genObj(e);if(s.completed!==null&&(this.$data.user=s.completed,this.dataProcessing(s.fromStorage)),s.promise!==null){const t=await s.promise;t!==null&&!ce(t,this.$data.user)&&(this.$data.user=t,this.dataProcessing(!1))}}else{const t=(await j.genObj(e)).completed;if(t!==null&&t!=="")return await C.genRedirectTo(f.User+"/"+t),await this.init();{const n=await h.genGET("v2/user/"+e);n!==null&&(this.$data.user=new E(n))}}this.$data.user.ID===-1&&(T.paramID()===T.getCurrentUsername()&&await this.logout(),m.dialogError({title:"User not found",content:"The user you are looking for does not exist.",positiveText:"OK",onPositiveClick:async()=>{await C.genRedirectTo(f.Landing)}}))},dataProcessing(e){this.$data.user.ID!==-1&&(this.$data.self=T.getIsCurrentUser(this.$data.user.ID.valueOf()),e?this.$data.user.details.bio=this.$data.user.details.bio.valueOf():this.$data.user.details.bio=this.$data.user.details.bio.valueOf())},update(){this.$data.updated!==null&&(this.$data.user=this.$data.updated,this.dataProcessing(!1)),this.$data.updated=null},confirmDelete(){m.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var s,t,n;(s=this.$data.loadingBar)==null||s.start(),await h.genDELETE("v2/user/"+this.$data.user.ID,D.stringify(this.$data.user.details))?(localStorage.clear(),(t=this.$data.loadingBar)==null||t.finish(),m.messageInfo("Your account is now deleted."),await C.genRedirectTo(f.Landing)):((n=this.$data.loadingBar)==null||n.error(),m.messageError("Account deletion attempt failed."))},async save(){var t,n,l;(t=this.$data.loadingBar)==null||t.start();const e=new ue({id:this.$data.user.ID,name:b.getVal(this,"name"),email:b.getVal(this,"email"),bio:pe(b.getVal(this,"bio")),link:b.getVal(this,"link"),username:b.getVal(this,"username"),confirmed:this.$data.user.details.confirmed});await h.genPOST("v2/user/"+this.$data.user.ID,D.stringify(e))!==!1?(this.toggleEdit(),(n=this.$data.loadingBar)==null||n.finish(),m.messageSuccess("Profile updated successfully!"),await this.init()):((l=this.$data.loadingBar)==null||l.error(),m.dialogError({title:"Fail",content:"Save was unsuccessful. Please try again later.",positiveText:"OK"}))},async logout(){await h.genGET("logout"),localStorage.clear(),m.messageSuccess("You are now logged out."),await C.genRedirectTo(f.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}}),De={class:"get_user"},Re={key:0,class:"narrow_content accountUnconfirmedAlertBar"},Ae={key:1,class:"narrow_content tapToUpdate"},Ve={key:3,class:"userinfo"},je={class:"title"},Fe={class:"profile_info"},Ge={key:1,class:"narrow_content"},He={class:"myAccountButtonGroups"},We={class:"myAccountDeletion"};function Je(e,s,t,n,l,F){const g=o("CHead"),_=o("n-alert"),v=o("CLink"),y=o("CLoadingViewUser"),O=o("CViewUser"),w=o("CEditItem"),$=o("n-button");return a(),r("div",De,[i(g,{title:e.user.details.name.valueOf(),description:e.user.details.bio.valueOf(),type:"profile"},null,8,["title","description"]),e.self&&!e.user.details.confirmed?(a(),r("div",Re,[i(v,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:d(()=>[i(_,{title:"Unconfirmed",type:"error"},{default:d(()=>[p("Please confirm you email address to access the full site.")]),_:1})]),_:1},8,["url"])])):c("",!0),e.updated!==null?(a(),r("div",Ae,[i(_,{title:"There's an update!",type:"warning",onClick:e.update},{default:d(()=>[p("Press here to view latest version of this profile.")]),_:1},8,["onClick"])])):c("",!0),e.user.ID===-1?(a(),U(y,{key:2})):(a(),r("div",Ve,[u("h1",je,I(e.user.details.name),1),u("div",Fe,[e.edit?(a(),r("div",Ge,[i(w,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),i(w,{label:"Username",ref:"username",val:e.user.details.username.valueOf(),placeholder:"Set a username"},null,8,["val"]),i(w,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),i(w,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),u("div",He,[i($,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:d(()=>[p("Save")]),_:1},8,["onClick"]),i($,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:d(()=>[p("Cancel")]),_:1},8,["onClick"])]),u("div",We,[i($,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:d(()=>[p("Delete Account")]),_:1},8,["onClick"])])])):(a(),U(O,{key:0,user:e.user,showName:!1,self:e.self,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","self","onLogout","onToggleEdit"]))])]))])}const ot=A(Ne,[["render",Je],["__scopeId","data-v-fb8ebffc"]]);export{ot as default};
