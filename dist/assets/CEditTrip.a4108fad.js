var x=Object.defineProperty;var q=(e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var k=(e,t,s)=>(q(e,typeof t!="symbol"?t+"":t,s),s);import{P as O,a as z,D as U,C as b}from"./DataProps.4fe928ce.js";import{j as D,o as r,d as v,i,r as n,F as M,y as B,e as a,w as l,f as N,g as S,D as j,h as f,z as E,G as F,O as V,A as K,P as X,C as Q,E as Y,B as J,Q as Z,W as ee}from"./vendor.956482ab.js";import{_ as I,D as te,T as se,c as ae,H as ie,G as R,R as ne,a as oe}from"./index.82c4b6b0.js";import{C as le,D as P,E as T,N as re,a as A}from"./E.12d589da.js";import{N as L}from"./NaiveUtils.5d081185.js";const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},de=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),pe=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1),ue=[de,pe];var G=D({name:"Add",render:function(t,s){return r(),v("svg",ce,ue)}});const _e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},he=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),ve=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1),me=[he,ve];var H=D({name:"CloseOutline",render:function(t,s){return r(),v("svg",_e,me)}});const fe={class:"edit_places"},ye={class:"places"},ge={key:0,class:"editTravelTime"},$e={key:0,class:"travelTimeInput"},Ce=i("div",{class:"travelTimeLabel"},"Travel time",-1),we=f("minutes"),Te=f("Set travel time"),De=i("br",null,null,-1),ke=f("Delete this place"),be=f("Add another place");function Pe(e,t,s,y,o,u){const h=n("n-divider"),c=n("n-input-number"),d=n("n-button"),C=n("n-input"),w=n("close-outline"),g=n("n-icon"),$=n("add");return r(),v("div",fe,[i("ul",ye,[(r(!0),v(M,null,B(e.propPlaces,(p,_)=>(r(),v("li",{class:"place",key:_},[_>0?(r(),v("div",ge,[a(h,{class:"editPlaceDivider"}),p.travelTime!==void 0?(r(),v("div",$e,[Ce,a(c,{placeholder:"Travel time (in minutes)",type:"text",min:0,value:p.travelTime.timeInMinutes,"onUpdate:value":m=>p.travelTime.timeInMinutes=m},{suffix:l(()=>[we]),_:2},1032,["value","onUpdate:value"])])):(r(),N(d,{key:1,class:"setTravelTime",type:"default",onClick:m=>e.setTravelTime(_)},{default:l(()=>[Te]),_:2},1032,["onClick"])),a(h,{class:"editPlaceDivider"})])):S("",!0),i("div",{class:j(["editPlace","place"+_])},[a(C,{class:"inputPlaceLabel",value:p.place.label,"onUpdate:value":m=>p.place.label=m,type:"text",placeholder:"Place Name"+(_!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","placeholder"]),a(C,{class:"inputPlaceLink",value:p.place.URL,"onUpdate:value":m=>p.place.URL=m,type:"text",placeholder:"Link"+(_!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","placeholder"]),De,a(C,{class:"inputPlaceDesc",value:p.place.description,"onUpdate:value":m=>p.place.description=m,type:"textarea",placeholder:_!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","placeholder"]),a(d,{class:"removePlace wide_button",type:"error",secondary:"",onClick:m=>e.removePlace(_)},{default:l(()=>[a(g,null,{default:l(()=>[a(w)]),_:1}),ke]),_:2},1032,["onClick"])],2)]))),128))]),a(h,{class:"editPlaceDivider"}),a(d,{class:"addPlace wide_button",onClick:e.pushPlace},{default:l(()=>[a(g,null,{default:l(()=>[a($)]),_:1}),be]),_:1},8,["onClick"])])}const Ne=D({name:"CEditPlaces",components:{Add:G,CloseOutline:H,NButton:E,NDivider:F,NIcon:V,NInput:K,NInputNumber:X},model:{props:{propPlaces:Array()},emits:["update:propPlaces"]},props:{propPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof O))return!1}),!0):!1}}},methods:{pushPlace(){this.$props.propPlaces.push(new O)},removePlace(e){this.$props.propPlaces.splice(e,1)},setTravelTime(e){const t=new z;t.toPlaceIndex=e,this.$props.propPlaces[e].travelTime=t}}});var W=I(Ne,[["render",Pe]]);const Ee={class:"edit_days narrow_content"},Ie={class:"editDayCardContent"},Oe={class:"editDayTitle"},Ue=f("Delete this day"),Re=f("Add another day");function Ae(e,t,s,y,o,u){const h=n("close-outline"),c=n("n-icon"),d=n("n-button"),C=n("CEditPlaces"),w=n("n-card"),g=n("add");return r(),v("div",Ee,[(r(!0),v(M,null,B(e.days,($,p)=>(r(),N(w,{class:j(["editDay","day"+$.dayOf]),key:$.dayOf,hoverable:"","content-style":"padding: 0"},{default:l(()=>[i("div",Ie,[i("div",Oe,[i("b",null,"Day "+Q($.dayOf),1),a(d,{class:"removeDay right_button",secondary:"",type:"error",onClick:_=>e.removeDay(p)},{default:l(()=>[a(c,null,{default:l(()=>[a(h)]),_:1}),Ue]),_:2},1032,["onClick"])]),a(C,{class:"editPlaces",ref_for:!0,ref:"places"+p,propPlaces:$.propPlaces,"onUpdate:propPlaces":_=>$.propPlaces=_},null,8,["propPlaces","onUpdate:propPlaces"])])]),_:2},1032,["class"]))),128)),a(d,{class:"addDay right_button",onClick:t[0]||(t[0]=$=>e.pushDay())},{default:l(()=>[a(c,null,{default:l(()=>[a(g)]),_:1}),Re]),_:1})])}const Le=D({components:{Add:G,CEditPlaces:W,CloseOutline:H,NButton:E,NCard:Y,NIcon:V},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new U(e))},methods:{pushDay(){let e=new U(new te({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let o of this.$data.days)t[o.dayOf]=o;const s=this.$data.days.length;this.$data.days=[];let y=0;for(let o=0;o<s;o++){let u=t[o+y];for(;u==null&&o+y<s+5;)y++,u=t[o+y];u.dayOf=o+1,this.$data.days.push(u)}}}});var Me=I(Le,[["render",Ae],["__scopeId","data-v-3103462c"]]);class Be{constructor(t,s){k(this,"type");k(this,"label");k(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const Se={class:"edit_trip"},je={class:"edit_form"},Ve={class:"narrow_content"},Ge={class:"editTripPrivacy"},He=i("span",{class:"editLabel"},"Private:",-1),We={class:"editInput"},xe={class:"editCity"},qe=i("span",{class:"editLabel"},"Cities:",-1),ze={class:"confirmationButtons narrow_content"},Fe=f("Save"),Ke=f("Cancel"),Xe=f("Delete");function Qe(e,t,s,y,o,u){const h=n("CEditItem"),c=n("n-switch"),d=n("n-select"),C=n("CEditDays"),w=n("n-button");return r(),v("div",Se,[i("form",je,[i("div",Ve,[a(h,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(h,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),i("div",Ge,[He,i("div",We,[a(c,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=g=>e.private=g)},null,8,["value"])])]),i("div",xe,[qe,a(d,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=g=>e.cities=g),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])])]),a(C,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),i("div",ze,[a(w,{class:"saveEditTrip left_col",type:"info",onClick:e.save,loading:e.saving},{default:l(()=>[Fe]),_:1},8,["onClick","loading"]),a(w,{class:"cancelEditTrip right_col",type:"default",onClick:e.cancel},{default:l(()=>[Ke]),_:1},8,["onClick"]),e.isNew?S("",!0):(r(),N(w,{key:0,class:"deleteTrip right_col",onClick:e.confirmDelete,type:"error",loading:e.deleting},{default:l(()=>[Xe]),_:1},8,["onClick","loading"]))])])])}const Ye=3,Je=D({components:{NButton:E,NSelect:J,NSwitch:Z,CEditDays:Me,CEditItem:le,CEditPlaces:W},props:{trip:{type:se,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return P},descriptionRowMinCount(){return Ye}},beforeMount(){L.init(),this.update()},mounted(){T.get(T.get(this,"name"),"input").focus()},methods:{cancel(){var e;T.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new ae;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=b.stringToCities(this.$data.cities.join(","));const t=T.getVal(this,"name"),s=T.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const o=T.get(this,"days");let u=0;for(const h in o.days){const c=o.days[h].toDay(),d=this.filterPlaces(c.places);if(d===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}d.length>0?(c.places=d,c.dayOf=c.dayOf-u,e.days.push(c)):u++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},confirmDelete(){L.dialogWarning({title:"Delete trip",content:"Are you sure you want to delete this trip? THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.del()},onNegativeClick:async()=>{}})},async del(){this.$data.deleting=!0;let e=Boolean(await ie.genDELETE("v2/trip/"+this.$props.trip.ID,ee.stringify(this.$props.trip)));e||(e=(await R.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(R.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&ne.genRedirectTo(oe.Landing)},tripToItem(e){return new Be(e,this.$props.trip[e])},update(){this.$data.possibleCities=b.sortedCityOptions(),this.$data.cities=b.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<re?(this.showAlert("Trip name is too short."),!1):e.length>A?(this.showAlert(`Trip name cannot be longer than ${A}.`),!1):!t||t.length>P?(this.showAlert(`Trip description cannot be longer than ${P}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var nt=I(Je,[["render",Qe]]);export{nt as C};
