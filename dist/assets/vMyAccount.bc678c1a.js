import{C as B,E as i}from"./E.5e463c1d.js";import{C as b}from"./CViewUser.b578d451.js";import{_ as A,U as T,a as r,G as g,R as h,H as _,c as U}from"./index.c9b3b141.js";import{r as o,B as D,o as n,d as p,C as V,f as y,w as c,i as d,e as t,g as j,h as v,j as L,W as C}from"./vendor.b89496ae.js";import"./CTripPreviewCard.9a64307d.js";import"./CPlaces.e7afc49d.js";import"./CityUtil.5044ab31.js";const I={class:"my_account"},O=d("h1",{class:"title"},"My Account",-1),P={class:"profileInfo"},R={key:0},S={key:1,class:"narrow_content"},N={class:"myAccountButtonGroups"},G=v("Save"),M=v("Cancel"),H={class:"myAccountDeletion"},W=v("Delete Account");function q(e,l,a,s,u,K){const $=o("el-alert"),w=o("el-link"),E=o("CViewUser"),f=o("CEditItem"),m=o("el-button"),k=D("loading");return n(),p("div",I,[O,V((n(),y(w,{class:"unconfirmedEmailLink",href:e.unconfirmedLink,underline:!1},{default:c(()=>[e.confirmed?j("",!0):(n(),y($,{key:0,class:"narrow_content accountUnconfirmedAlertBar",title:"Unconfirmed",description:"Please confirm you email address to access the full site.",type:"error",closable:!1,"show-icon":""}))]),_:1},8,["href"])),[[k,e.loading,void 0,{fullscreen:!0,lock:!0}]]),d("div",P,[e.edit?(n(),p("div",S,[t(f,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(f,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(f,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf()},null,8,["val"]),d("div",N,[t(m,{class:"myAccountSave",type:"primary",onClick:e.save},{default:c(()=>[G]),_:1},8,["onClick"]),t(m,{class:"myAccountCancel",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:c(()=>[M]),_:1},8,["onClick"])]),d("div",H,[t(m,{class:"myAccountDelete",type:"danger",onClick:e.deleteAccount},{default:c(()=>[W]),_:1},8,["onClick"])])])):(n(),p("div",R,[t(E,{user:e.user,self:!0,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","onLogout","onToggleEdit"])]))])])}const F=L({components:{CEditItem:B,CViewUser:b},data(){return{user:new T,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:r.unconfirmed_Email,loadingBar:g.loadingBar()}},async beforeMount(){this.$data.loading=!0,this.$data.user=await g.genCurrentUser(),this.$data.user.ID===-1&&await h.genRedirectTo(r.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf()},mounted(){this.$data.edit&&i.get(i.get(this,"name"),"input").focus(),this.$data.loading=!1},methods:{async deleteAccount(){var l,a,s;(l=this.$data.loadingBar)==null||l.start(),await _.genDELETE("v2/user/"+this.$data.user.ID,C.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(g.notifConfig("Deleted","Your account is now deleted.","info")),(a=this.$data.loadingBar)==null||a.finish(),await h.genRedirectTo(r.Landing)):((s=this.$data.loadingBar)==null||s.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var a,s,u;(a=this.$data.loadingBar)==null||a.start();const e=new U({id:this.$data.user.ID,name:i.getVal(this,"name"),email:i.getVal(this,"email"),bio:i.getVal(this,"bio"),confirmed:this.$data.user.details.confirmed});await _.genPOST("v2/user/"+this.$data.user.ID,C.stringify(e))?(this.toggleEdit(),(s=this.$data.loadingBar)==null||s.finish(),this.$message({message:"Profile updated successfully!",type:"success"})):((u=this.$data.loadingBar)==null||u.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await _.genGET("logout"),localStorage.clear(),await h.genRedirectTo(r.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ee=A(F,[["render",q]]);export{ee as default};
