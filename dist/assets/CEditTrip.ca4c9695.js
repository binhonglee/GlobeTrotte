var R=Object.defineProperty;var I=(e,t,s)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var $=(e,t,s)=>(I(e,typeof t!="symbol"?t+"":t,s),s);import{P as E,_ as D,D as L,T as A,b as M,C as B,H as j,G as N,R as S,a as G}from"./index.c31fb35e.js";import{r,o as h,d as m,F as b,n as w,i as u,e as a,w as _,y as V,h as v,j as T,f as P,t as H,g as W,W as q}from"./vendor.95e19654.js";import{C as z,D as k,E as C,N as F,a as O}from"./E.5195c1fd.js";import{C as K}from"./CityUtil.a674c2ed.js";const X={class:"edit_places"},Y=u("br",null,null,-1),J=v("Delete this place"),Q=v("Add another place");function Z(e,t,s,y,i,d){const l=r("el-input"),o=r("el-button"),f=r("el-divider");return h(),m("div",X,[(h(!0),m(b,null,w(e.places,(n,c)=>(h(),m("ul",{class:"places",key:c},[u("div",{class:V(["editPlace","place"+c])},[a(l,{class:"inputPlaceLabel",type:"text",placeholder:"Place Name"+(c!==0?"":" (eg. Golden Gate Bridge)"),modelValue:n.label,"onUpdate:modelValue":p=>n.label=p},null,8,["placeholder","modelValue","onUpdate:modelValue"]),a(l,{class:"inputPlaceLink",type:"text",placeholder:"Link"+(c!==0?"":" (eg. Google Map link)"),modelValue:n.URL,"onUpdate:modelValue":p=>n.URL=p},null,8,["placeholder","modelValue","onUpdate:modelValue"]),Y,a(l,{class:"inputPlaceDesc",type:"textarea",placeholder:c!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3,modelValue:n.description,"onUpdate:modelValue":p=>n.description=p},null,8,["placeholder","modelValue","onUpdate:modelValue"]),a(o,{class:"removePlace",type:"danger",icon:"el-icon-close",plain:"",onClick:p=>e.removePlace(c)},{default:_(()=>[J]),_:2},1032,["onClick"]),a(f,{class:"editPlaceDivider"})],2)]))),128)),a(o,{class:"addPlace",plain:"",icon:"el-icon-plus",onClick:e.pushPlace},{default:_(()=>[Q]),_:1},8,["onClick"])])}const x=T({name:"CEditPlaces",data:()=>({places:[]}),props:{givenPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof E))return!1}),!0):!1}}},methods:{pushPlace(){this.$data.places.push(new E)},removePlace(e){this.$data.places.splice(e,1)}},beforeMount(){var e;this.$data.places=((e=this.$props.givenPlaces)!=null?e:[]).slice(0)}});var U=D(x,[["render",Z]]);const ee={class:"edit_days"},te={class:"editDayCardContent"},se={class:"editDayTitle"},ae=v("Delete this day"),ie=v("Add another day");function le(e,t,s,y,i,d){const l=r("el-button"),o=r("CEditPlaces"),f=r("el-card");return h(),m("div",ee,[(h(!0),m(b,null,w(e.days,(n,c)=>(h(),P(f,{class:V(["editDay","day"+n.dayOf]),shadow:"hover",key:n.dayOf.valueOf()},{default:_(()=>[u("div",te,[u("div",se,[u("b",null,"Day "+H(n.dayOf),1),a(l,{class:"removeDay",type:"danger",icon:"el-icon-close",plain:"",onClick:p=>e.removeDay(c)},{default:_(()=>[ae]),_:2},1032,["onClick"])]),a(o,{class:"editPlaces",givenPlaces:n.places,ref_for:!0,ref:"places"+c},null,8,["givenPlaces"])])]),_:2},1032,["class"]))),128)),a(l,{class:"addDay",icon:"el-icon-plus",onClick:e.pushDay},{default:_(()=>[ie]),_:1},8,["onClick"])])}const ne=T({data:()=>({days:[]}),props:{givenDays:{type:Array,required:!0}},methods:{pushDay(){let e=new L({places:[{}]});e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let i of this.$data.days)t[i.dayOf.valueOf()]=i;const s=this.$data.days.length;this.$data.days=[];let y=0;for(let i=0;i<s;i++){let d=t[i+y];for(;d==null&&i+y<s+5;)y++,d=t[i+y];d.dayOf=i+1,this.$data.days.push(d)}}},beforeMount(){var e;this.$data.days=((e=this.$props.givenDays)!=null?e:[]).slice(0)},components:{CEditPlaces:U}});var oe=D(ne,[["render",le],["__scopeId","data-v-14cd01e7"]]);class re{constructor(t,s){$(this,"type");$(this,"label");$(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const de={class:"edit_trip"},ce={class:"edit_form"},pe={class:"editTripPrivacy"},ue=u("span",{class:"editLabel"},"Private:",-1),he={class:"editCity"},fe=u("span",{class:"editLabel"},"Cities:",-1),_e={class:"confirmationButtons"},ye=v("Save"),me=v("Cancel"),ve=v("Delete");function ge(e,t,s,y,i,d){const l=r("CEditItem"),o=r("el-switch"),f=r("el-option"),n=r("el-select"),c=r("CEditDays"),p=r("el-button");return h(),m("div",de,[u("form",ce,[a(l,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(l,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),u("div",pe,[ue,a(o,{class:"editInput",modelValue:e.private,"onUpdate:modelValue":t[0]||(t[0]=g=>e.private=g)},null,8,["modelValue"])]),u("div",he,[fe,a(n,{class:"editInput",modelValue:e.cities,"onUpdate:modelValue":t[1]||(t[1]=g=>e.cities=g),filterable:"",multiple:"","no-match-text":"City not found",placeholder:""},{default:_(()=>[(h(!0),m(b,null,w(e.possibleCities,g=>(h(),P(f,{class:"editTripSingleCity",label:g.label,value:g.key},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),a(c,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),u("div",_e,[a(p,{class:"saveEditTrip",type:"primary",onClick:e.save,loading:e.saving},{default:_(()=>[ye]),_:1},8,["onClick","loading"]),a(p,{class:"cancelEditTrip",type:"default",onClick:e.cancel},{default:_(()=>[me]),_:1},8,["onClick"]),e.isNew?W("",!0):(h(),P(p,{key:0,class:"deleteTrip",onClick:e.del,type:"danger",loading:e.deleting},{default:_(()=>[ve]),_:1},8,["onClick","loading"]))])])])}const Ce=3,$e=T({components:{CEditDays:oe,CEditItem:z,CEditPlaces:U},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),props:{trip:{type:A,required:!0},isNew:{type:Boolean,required:!0}},computed:{descriptionMaxCharCount(){return k},descriptionRowMinCount(){return Ce}},methods:{cancel(){var e;C.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new M;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=[];for(let l of this.$data.cities)typeof l=="number"?e.cities.push(l):e.cities.push(parseInt(B[l],10));const t=C.getVal(this,"name"),s=C.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const i=C.get(this,"days");let d=0;for(const l in i.days){const o=i.days[l],f=this.filterPlaces(o.places);if(f===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}f.length>0?(o.places=f,o.dayOf=o.dayOf-d,e.days.push(o)):d++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},async del(){this.$data.deleting=!0;let e=Boolean(await j.genDELETE("v2/trip/"+this.$props.trip.ID,q.stringify(this.$props.trip)));e||(e=(await N.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(N.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&S.genRedirectTo(G.Landing)},tripToItem(e){return new re(e,this.$props.trip[e])},update(){this.$data.possibleCities=K.sortedCityList(),this.$data.cities=this.$props.trip.details.cities,this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<F?(this.showAlert("Trip name is too short."),!1):e.length>O?(this.showAlert(`Trip name cannot be longer than ${O}.`),!1):!t||t.length>k?(this.showAlert(`Trip description cannot be longer than ${k}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}},beforeMount(){this.update()},mounted(){C.get(C.get(this,"name"),"input").focus()}});var ke=D($e,[["render",ge]]);export{ke as C};
