var E=Object.defineProperty;var P=(e,s,o)=>s in e?E(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o;var d=(e,s,o)=>(P(e,typeof s!="symbol"?s+"":s,o),o);import{d as v,N as k,g as f,R as m,f as h,aS as C,r as u,o as w,c as g,a as t,h as R,w as l,e as p,j as r,p as N,b as S,_ as V}from"./index.a9591fd9.js";import{C as I,E as a}from"./CEditItem.29dd54f2.js";import{C as L}from"./CLink.9de9f5a7.js";import{N as n}from"./NaiveUtils.0b9af0d6.js";import"./Input.5748103d.js";class T{constructor(s){d(this,"email","");d(this,"code","");d(this,"password","");s&&(this.email=s.email!==void 0&&s.email!==null?s.email:"",this.code=s.code!==void 0&&s.code!==null?s.code:"",this.password=s.password!==void 0&&s.password!==null?s.password:"")}toJsonKey(s){switch(s){case"email":return"email";case"code":return"code";case"password":return"password";default:return s}}}const $=v({components:{CEditItem:I,CLink:L,NButton:k},data:()=>({email:"",step:0,loginLink:f.Login,loading:!1}),async mounted(){this.$data.step<2?a.get(a.get(this,"email"),"input").focus():a.get(a.get(this,"code"),"input").focus()},async beforeMount(){var s,o;const e=m.getParamMap();this.$data.email=(s=e.get("email"))!=null?s:"",this.$data.step=+((o=e.get("step"))!=null?o:""),n.init()},methods:{async confirmEmail(){await h.genPOST("reset/send_email",C.stringify(a.getVal(this,"email")))?(n.messageSuccess("Password reset code sent!"),await m.genRefreshRedirect(f.password_Reset,new Map(Object.entries({email:a.getVal(this,"email"),step:"2"})))):n.messageError("Account not found with email.")},async confirmReset(){if(a.getVal(this,"password").localeCompare(a.getVal(this,"confPassword"))){n.dialogError({title:"Fail",content:"Password does not match.",positiveText:"OK"}),this.$data.loading=!1;return}const e=new T;e.email=a.getVal(this,"email"),e.code=a.getVal(this,"code"),e.password=a.getVal(this,"password"),await h.genPOST("reset/password",C.stringify(e))?(n.messageSuccess("Password reset is successful."),await m.genRedirectTo(f.Login)):n.messageError("Password reset attempt failed.")},async cancel(){await m.paramToNext()}}}),_=e=>(N("data-v-90ceb23f"),e=e(),S(),e),b={class:"password_reset narrow_content"},B=_(()=>p("h1",{class:"title"},"Reset Password",-1)),K={key:0,class:"resetPasswordStart narrow_display_window"},M=_(()=>p("br",null,null,-1)),O={class:"backToLogin"},U={key:1,class:"resetPasswordInput narrow_display_window"},q=_(()=>p("br",null,null,-1));function A(e,s,o,F,H,J){const i=u("CEditItem"),c=u("n-button"),y=u("CLink");return w(),g("div",b,[B,e.step<2?(w(),g("form",K,[t(i,{className:"emailInput",label:"Email",ref:"email",val:e.email,onKeydown:R(e.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),M,t(c,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmEmail,loading:e.loading},{default:l(()=>[r("Confirm")]),_:1},8,["onClick","loading"]),t(c,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:l(()=>[r("Cancel")]),_:1},8,["onClick"]),p("p",O,[t(y,{url:e.loginLink},{default:l(()=>[r("Back to Login")]),_:1},8,["url"])])])):(w(),g("form",U,[t(i,{className:"resetEmail",label:"Email",ref:"email",val:e.email,onEnter:e.confirmReset},null,8,["val","onEnter"]),t(i,{className:"resetCode",label:"Code",ref:"code",onEnter:e.confirmReset},null,8,["onEnter"]),t(i,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),t(i,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),q,t(c,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmReset,loading:e.loading},{default:l(()=>[r("Confirm")]),_:1},8,["onClick","loading"]),t(c,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:l(()=>[r("Cancel")]),_:1},8,["onClick"])]))])}const Y=V($,[["render",A],["__scopeId","data-v-90ceb23f"]]);export{Y as default};
