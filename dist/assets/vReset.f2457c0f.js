var C=Object.defineProperty;var P=(e,s,t)=>s in e?C(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var c=(e,s,t)=>(P(e,typeof s!="symbol"?s+"":s,t),t);import{C as E,E as a}from"./E.0486ff15.js";import{_ as k,a as f,H as h,R as d}from"./index.a4de7a58.js";import{r as g,v as R,o as r,d as u,e as o,m as $,x as _,f as v,w as m,i,h as p,j as V,W as y}from"./vendor.7b9428fe.js";class N{constructor(s){c(this,"email","");c(this,"code","");c(this,"password","");s&&(this.email=s.email!==void 0&&s.email!==null?s.email:"",this.code=s.code!==void 0&&s.code!==null?s.code:"",this.password=s.password!==void 0&&s.password!==null?s.password:"")}toJsonKey(s){switch(s){case"email":return"email";case"code":return"code";case"password":return"password";default:return s}}}const T={class:"password_reset narrow_content"},B=i("h1",{class:"title"},"Reset Password",-1),L={key:0,class:"resetPasswordStart"},S=i("br",null,null,-1),I=p("Confirm"),K=p("Cancel"),b={class:"backToLogin"},M=["href"],O={key:1,class:"resetPasswordInput"},D=i("br",null,null,-1),H=p("Confirm"),W=p("Cancel");function q(e,s,t,F,J,U){const n=g("CEditItem"),l=g("el-button"),w=R("loading");return r(),u("div",T,[B,e.step<2?(r(),u("form",L,[o(n,{className:"emailInput",label:"Email",ref:"email",val:e.email,onKeydown:$(e.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),S,_((r(),v(l,{class:"resetPasswordSave",type:"primary",onClick:e.confirmEmail},{default:m(()=>[I]),_:1},8,["onClick"])),[[w,e.loading,void 0,{fullscreen:!0,lock:!0}]]),o(l,{class:"resetPasswordCancel",type:"default",onClick:e.cancel},{default:m(()=>[K]),_:1},8,["onClick"]),i("p",b,[i("a",{href:e.loginLink},"Back to Login",8,M)])])):(r(),u("form",O,[o(n,{className:"resetEmail",label:"Email",ref:"email",val:e.email,onEnter:e.confirmReset},null,8,["val","onEnter"]),o(n,{className:"resetCode",label:"Code",ref:"code",onEnter:e.confirmReset},null,8,["onEnter"]),o(n,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),o(n,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),D,_((r(),v(l,{class:"resetPasswordSave",type:"primary",onClick:e.confirmReset},{default:m(()=>[H]),_:1},8,["onClick"])),[[w,e.loading,void 0,{fullscreen:!0,lock:!0}]]),o(l,{class:"resetPasswordCancel",type:"default",onClick:e.cancel},{default:m(()=>[W]),_:1},8,["onClick"])]))])}const A=V({components:{CEditItem:E},data:()=>({email:"",step:0,loginLink:f.Login,loading:!1}),methods:{async confirmEmail(){await h.genPOST("reset/send_email",y.stringify(a.getVal(this,"email")))?(this.$message({type:"success",message:"Password reset code sent!"}),await d.genRefreshRedirect(f.password_Reset,new Map(Object.entries({email:a.getVal(this,"email"),step:"2"})))):this.$message({type:"error",message:"Account not found with email."})},async confirmReset(){if(a.getVal(this,"password").localeCompare(a.getVal(this,"confPassword"))){this.$alert("Password does not match.","Fail",{confirmButtonText:"OK"}),this.$data.loading=!1;return}const e=new N;e.email=a.getVal(this,"email"),e.code=a.getVal(this,"code"),e.password=a.getVal(this,"password"),await h.genPOST("reset/password",y.stringify(e))?(this.$message({type:"success",message:"Password reset is successful."}),await d.genRedirectTo(f.Login)):this.$message({type:"error",message:"Password reset attempt failed."})},async cancel(){await d.paramToNext()}},async mounted(){this.$data.step<2?a.get(a.get(this,"email"),"input").focus():a.get(a.get(this,"code"),"input").focus()},async beforeMount(){var s,t;const e=d.getParamMap();this.$data.email=(s=e.get("email"))!=null?s:"",this.$data.step=+((t=e.get("step"))!=null?t:"")}});var Y=k(A,[["render",q]]);export{Y as default};
