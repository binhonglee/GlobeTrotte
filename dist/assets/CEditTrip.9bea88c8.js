var R=Object.defineProperty;var A=(e,t,s)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var $=(e,t,s)=>(A(e,typeof t!="symbol"?t+"":t,s),s);import{P as T,_ as C,D as I,T as L,b as M,H as B,G as P,R as j,a as S}from"./index.c9b3b141.js";import{j as D,r as p,o as f,d as v,F as E,s as k,i as u,e as a,w as y,D as N,h as m,f as O,x as G,g as H,v as W,W as q}from"./vendor.b89496ae.js";import{C as z,D as b,E as g,N as F,a as U}from"./E.5e463c1d.js";import{C as w}from"./CityUtil.5044ab31.js";const K=D({name:"CEditPlaces",props:{givenPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof T))return!1}),!0):!1}}},data:()=>({places:[]}),beforeMount(){var e;this.$data.places=((e=this.$props.givenPlaces)!=null?e:[]).slice(0)},methods:{pushPlace(){this.$data.places.push(new T)},removePlace(e){this.$data.places.splice(e,1)}}}),X={class:"edit_places"},Y=u("br",null,null,-1),J=m("Delete this place"),Q=m("Add another place");function Z(e,t,s,_,i,r){const d=p("el-input"),o=p("el-button"),h=p("el-divider");return f(),v("div",X,[(f(!0),v(E,null,k(e.places,(l,n)=>(f(),v("ul",{key:n,class:"places"},[u("div",{class:N(["editPlace","place"+n])},[a(d,{modelValue:l.label,"onUpdate:modelValue":c=>l.label=c,class:"inputPlaceLabel",type:"text",placeholder:"Place Name"+(n!==0?"":" (eg. Golden Gate Bridge)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(d,{modelValue:l.URL,"onUpdate:modelValue":c=>l.URL=c,class:"inputPlaceLink",type:"text",placeholder:"Link"+(n!==0?"":" (eg. Google Map link)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),Y,a(d,{modelValue:l.description,"onUpdate:modelValue":c=>l.description=c,class:"inputPlaceDesc",type:"textarea",placeholder:n!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(o,{class:"removePlace",type:"danger",icon:"el-icon-close",plain:"plain",onClick:c=>e.removePlace(n)},{default:y(()=>[J]),_:2},1032,["onClick"]),a(h,{class:"editPlaceDivider"})],2)]))),128)),a(o,{class:"addPlace",plain:"plain",icon:"el-icon-plus",onClick:e.pushPlace},{default:y(()=>[Q]),_:1},8,["onClick"])])}var V=C(K,[["render",Z]]);const x=D({components:{CEditPlaces:V},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0)},methods:{pushDay(){let e=new I({places:[{}]});e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let i of this.$data.days)t[i.dayOf.valueOf()]=i;const s=this.$data.days.length;this.$data.days=[];let _=0;for(let i=0;i<s;i++){let r=t[i+_];for(;r==null&&i+_<s+5;)_++,r=t[i+_];r.dayOf=i+1,this.$data.days.push(r)}}}}),ee={class:"edit_days"},te={class:"editDayCardContent"},se={class:"editDayTitle"},ae=m("Delete this day"),ie=m("Add another day");function le(e,t,s,_,i,r){const d=p("el-button"),o=p("CEditPlaces"),h=p("el-card");return f(),v("div",ee,[(f(!0),v(E,null,k(e.days,(l,n)=>(f(),O(h,{key:l.dayOf.valueOf(),class:N(["editDay","day"+l.dayOf]),shadow:"hover"},{default:y(()=>[u("div",te,[u("div",se,[u("b",null,"Day "+G(l.dayOf),1),a(d,{class:"removeDay",type:"danger",icon:"el-icon-close",plain:"plain",onClick:c=>e.removeDay(n)},{default:y(()=>[ae]),_:2},1032,["onClick"])]),a(o,{ref_for:!0,ref:"places"+n,class:"editPlaces","given-places":l.places},null,8,["given-places"])])]),_:2},1032,["class"]))),128)),a(d,{class:"addDay",icon:"el-icon-plus",onClick:e.pushDay},{default:y(()=>[ie]),_:1},8,["onClick"])])}var ne=C(x,[["render",le],["__scopeId","data-v-2fb67b51"]]);class oe{constructor(t,s){$(this,"type");$(this,"label");$(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const re={class:"edit_trip"},de={class:"edit_form"},ce={class:"editTripPrivacy"},pe=u("span",{class:"editLabel"},"Private:",-1),ue={class:"editCity"},he=u("span",{class:"editLabel"},"Cities:",-1),_e={class:"confirmationButtons"},fe=m("Save"),ye=m("Cancel"),me=m("Delete");function ve(e,t,s,_,i,r){const d=p("CEditItem"),o=p("el-switch"),h=p("n-select"),l=p("CEditDays"),n=p("el-button");return f(),v("div",re,[u("form",de,[a(d,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(d,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),u("div",ce,[pe,a(o,{class:"editInput",modelValue:e.private,"onUpdate:modelValue":t[0]||(t[0]=c=>e.private=c)},null,8,["modelValue"])]),u("div",ue,[he,a(h,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=c=>e.cities=c),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])]),a(l,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),u("div",_e,[a(n,{class:"saveEditTrip",type:"primary",onClick:e.save,loading:e.saving},{default:y(()=>[fe]),_:1},8,["onClick","loading"]),a(n,{class:"cancelEditTrip",type:"default",onClick:e.cancel},{default:y(()=>[ye]),_:1},8,["onClick"]),e.isNew?H("",!0):(f(),O(n,{key:0,class:"deleteTrip",onClick:e.del,type:"danger",loading:e.deleting},{default:y(()=>[me]),_:1},8,["onClick","loading"]))])])])}const ge=3,$e=D({components:{NSelect:W,CEditDays:ne,CEditItem:z,CEditPlaces:V},props:{trip:{type:L,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return b},descriptionRowMinCount(){return ge}},beforeMount(){this.update()},mounted(){g.get(g.get(this,"name"),"input").focus()},methods:{cancel(){var e;g.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new M;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=w.stringToCities(this.$data.cities.join(","));const t=g.getVal(this,"name"),s=g.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const i=g.get(this,"days");let r=0;for(const d in i.days){const o=i.days[d],h=this.filterPlaces(o.places);if(h===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}h.length>0?(o.places=h,o.dayOf=o.dayOf-r,e.days.push(o)):r++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},async del(){this.$data.deleting=!0;let e=Boolean(await B.genDELETE("v2/trip/"+this.$props.trip.ID,q.stringify(this.$props.trip)));e||(e=(await P.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(P.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&j.genRedirectTo(S.Landing)},tripToItem(e){return new oe(e,this.$props.trip[e])},update(){this.$data.possibleCities=w.sortedCityOptions(),this.$data.cities=w.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<F?(this.showAlert("Trip name is too short."),!1):e.length>U?(this.showAlert(`Trip name cannot be longer than ${U}.`),!1):!t||t.length>b?(this.showAlert(`Trip description cannot be longer than ${b}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var Pe=C($e,[["render",ve]]);export{Pe as C};
