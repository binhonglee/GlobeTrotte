var G=Object.defineProperty;var H=(e,t,s)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var d=(e,t,s)=>(H(e,typeof t!="symbol"?t+"":t,s),s);import{j as b,o as f,f as k,e as i,r as o,d as C,i as r,F as E,s as U,y as R,w as p,h as w,t as O,B as W,J as L,v as q,A as z,z as K,g as F,x as X,K as J,W as Y}from"./vendor.8e06973c.js";import{_ as T,D as A,P as Q,T as Z,b as ee,H as te,G as M,R as se,a as ie}from"./index.5b22a1f4.js";import{C as ae,D as I,E as D,N as ne,a as B}from"./E.1256182a.js";import{C as N}from"./CityUtil.9c32d7ab.js";const oe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},le=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),re=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1);var j=b({name:"Add",render:function(t,s){return f(),k("svg",oe,[le,re])}});const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},de=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),pe=i("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1);var S=b({name:"CloseOutline",render:function(t,s){return f(),k("svg",ce,[de,pe])}});const ue={class:"edit_places"},he={class:"places"},_e=r("br",null,null,-1),fe=w("Delete this place"),ve=w("Add another place");function ye(e,t,s,n,a,l){const _=o("n-input"),c=o("close-outline"),u=o("n-icon"),$=o("n-button"),y=o("n-divider"),m=o("add");return f(),C("div",ue,[r("ul",he,[(f(!0),C(E,null,U(e.places,(h,v)=>(f(),C("li",{class:"place",key:v},[r("div",{class:R(["editPlace","place"+v])},[i(_,{class:"inputPlaceLabel",value:h.label,"onUpdate:value":g=>h.label=g,type:"text",placeholder:"Place Name"+(v!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","placeholder"]),i(_,{class:"inputPlaceLink",value:h.URL,"onUpdate:value":g=>h.URL=g,type:"text",placeholder:"Link"+(v!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","placeholder"]),_e,i(_,{class:"inputPlaceDesc",value:h.description,"onUpdate:value":g=>h.description=g,type:"textarea",placeholder:v!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","placeholder"]),i($,{class:"removePlace",type:"error",secondary:"",onClick:g=>e.removePlace(v)},{default:p(()=>[i(u,null,{default:p(()=>[i(c)]),_:1}),fe]),_:2},1032,["onClick"]),i(y,{class:"editPlaceDivider"})],2)]))),128))]),i($,{class:"addPlace",onClick:e.pushPlace},{default:p(()=>[i(u,null,{default:p(()=>[i(m)]),_:1}),ve]),_:1},8,["onClick"])])}class P{constructor(t){d(this,"ID");d(this,"label");d(this,"URL");d(this,"description");var s,n,a,l;this.ID=(s=t==null?void 0:t.ID.valueOf())!=null?s:-1,this.label=(n=t==null?void 0:t.label.valueOf())!=null?n:"",this.URL=(a=t==null?void 0:t.URL.valueOf())!=null?a:"",this.description=(l=t==null?void 0:t.description.valueOf())!=null?l:""}}const me=b({name:"CEditPlaces",components:{Add:j,CloseOutline:S,NButton:O,NDivider:W,NIcon:L,NInput:q},props:{givenPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof P))return!1}),!0):!1}}},data:()=>({places:[]}),beforeMount(){var e;this.$data.places=((e=this.$props.givenPlaces)!=null?e:[]).slice(0)},methods:{pushPlace(){this.$data.places.push(new P)},removePlace(e){this.$data.places.splice(e,1)}}});var V=T(me,[["render",ye]]);class x{constructor(t){d(this,"ID");d(this,"tripID");d(this,"dayOf");d(this,"places",[]);this.ID=t.ID.valueOf(),this.tripID=t.tripID.valueOf(),this.dayOf=t.dayOf.valueOf(),this.places=t.places.map(s=>new P(s))}toDay(){const t=new A;return t.ID=this.ID,t.tripID=this.tripID,t.dayOf=this.dayOf,t.places=this.places.map(s=>{const n=new Q;return n.ID=s.ID,n.URL=s.URL,n.description=s.description,n.label=s.label,n}),t}}const ge=b({components:{Add:j,CEditPlaces:V,CloseOutline:S,NButton:O,NCard:z,NIcon:L},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new x(e))},methods:{pushDay(){let e=new x(new A({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let a of this.$data.days)t[a.dayOf]=a;const s=this.$data.days.length;this.$data.days=[];let n=0;for(let a=0;a<s;a++){let l=t[a+n];for(;l==null&&a+n<s+5;)n++,l=t[a+n];l.dayOf=a+1,this.$data.days.push(l)}}}}),we={class:"edit_days narrow_content"},$e={class:"editDayCardContent"},Ce={class:"editDayTitle"},De=w(" Delete this day "),be=w(" Add another day ");function ke(e,t,s,n,a,l){const _=o("close-outline"),c=o("n-icon"),u=o("n-button"),$=o("CEditPlaces"),y=o("n-card"),m=o("add");return f(),C("div",we,[(f(!0),C(E,null,U(e.days,(h,v)=>(f(),k(y,{key:h.dayOf,hoverable:"","content-style":"padding: 0",class:R(["editDay","day"+h.dayOf])},{default:p(()=>[r("div",$e,[r("div",Ce,[r("b",null,"Day "+K(h.dayOf),1),i(u,{secondary:"",class:"removeDay",type:"error",onClick:g=>e.removeDay(v)},{default:p(()=>[i(c,null,{default:p(()=>[i(_)]),_:1}),De]),_:2},1032,["onClick"])]),i($,{ref_for:!0,ref:"places"+v,class:"editPlaces","given-places":h.places},null,8,["given-places"])])]),_:2},1032,["class"]))),128)),i(u,{class:"addDay",onClick:e.pushDay},{default:p(()=>[i(c,null,{default:p(()=>[i(m)]),_:1}),be]),_:1},8,["onClick"])])}var Oe=T(ge,[["render",ke],["__scopeId","data-v-22bcc1eb"]]);class Te{constructor(t,s){d(this,"type");d(this,"label");d(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const Ie={class:"edit_trip"},Ne={class:"edit_form"},Pe={class:"narrow_content"},Ee={class:"editTripPrivacy"},Ue=r("span",{class:"editLabel"},"Private:",-1),Re={class:"editInput"},Le={class:"editCity"},Ae=r("span",{class:"editLabel"},"Cities:",-1),Me={class:"confirmationButtons narrow_content"},Be=w("Save"),je=w("Cancel"),Se=w("Delete");function Ve(e,t,s,n,a,l){const _=o("CEditItem"),c=o("n-switch"),u=o("n-select"),$=o("CEditDays"),y=o("n-button");return f(),C("div",Ie,[r("form",Ne,[r("div",Pe,[i(_,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),i(_,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),r("div",Ee,[Ue,r("div",Re,[i(c,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=m=>e.private=m)},null,8,["value"])])]),r("div",Le,[Ae,i(u,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=m=>e.cities=m),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])])]),i($,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),r("div",Me,[i(y,{class:"saveEditTrip",type:"info",onClick:e.save,loading:e.saving},{default:p(()=>[Be]),_:1},8,["onClick","loading"]),i(y,{class:"cancelEditTrip",type:"default",onClick:e.cancel},{default:p(()=>[je]),_:1},8,["onClick"]),e.isNew?F("",!0):(f(),k(y,{key:0,class:"deleteTrip",onClick:e.del,type:"error",loading:e.deleting},{default:p(()=>[Se]),_:1},8,["onClick","loading"]))])])])}const xe=3,Ge=b({components:{NButton:O,NSelect:X,NSwitch:J,CEditDays:Oe,CEditItem:ae,CEditPlaces:V},props:{trip:{type:Z,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return I},descriptionRowMinCount(){return xe}},beforeMount(){this.update()},mounted(){D.get(D.get(this,"name"),"input").focus()},methods:{cancel(){var e;D.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new ee;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=N.stringToCities(this.$data.cities.join(","));const t=D.getVal(this,"name"),s=D.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const a=D.get(this,"days");let l=0;for(const _ in a.days){const c=a.days[_].toDay(),u=this.filterPlaces(c.places);if(u===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}u.length>0?(c.places=u,c.dayOf=c.dayOf-l,e.days.push(c)):l++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},async del(){this.$data.deleting=!0;let e=Boolean(await te.genDELETE("v2/trip/"+this.$props.trip.ID,Y.stringify(this.$props.trip)));e||(e=(await M.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(M.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&se.genRedirectTo(ie.Landing)},tripToItem(e){return new Te(e,this.$props.trip[e])},update(){this.$data.possibleCities=N.sortedCityOptions(),this.$data.cities=N.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<ne?(this.showAlert("Trip name is too short."),!1):e.length>B?(this.showAlert(`Trip name cannot be longer than ${B}.`),!1):!t||t.length>I?(this.showAlert(`Trip description cannot be longer than ${I}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var Fe=T(Ge,[["render",Ve]]);export{Fe as C};
