import{d as y,N as C,f as E,aS as U,G as T,R as c,g as u,b3 as k,r as h,o as I,c as N,a as t,e as p,w as v,k as _,_ as P}from"./index.3d0376f2.js";import{U as f}from"./UserObj.ca2b49b2.js";import{C as $,E as i}from"./CEditItem.0a61a256.js";import{N as a}from"./NaiveUtils.baecc81c.js";import{C as S}from"./CHead.62f47b73.js";import"./TripObj.601d8a67.js";import"./Input.4dc57d07.js";class V{constructor(e){this.ID=-1,this.username="",this.name="",this.email="",this.bio="",this.password="",e&&(this.ID=e.id!==void 0&&e.id!==null?e.id:-1,this.username=e.username!==void 0&&e.username!==null?e.username:"",this.name=e.name!==void 0&&e.name!==null?e.name:"",this.email=e.email!==void 0&&e.email!==null?e.email:"",this.bio=e.bio!==void 0&&e.bio!==null?e.bio:"",this.password=e.password!==void 0&&e.password!==null?e.password:"")}toJsonKey(e){switch(e){case"ID":return"id";case"username":return"username";case"name":return"name";case"email":return"email";case"bio":return"bio";case"password":return"password";default:return e}}register(e){this.name=e.name,this.username=e.username,this.email=e.email,this.password=e.password}}var r=(s=>(s[s.InvalidType=0]="InvalidType",s[s.EmailAlreadyExists=1]="EmailAlreadyExists",s[s.EmailInvalid=2]="EmailInvalid",s[s.UsernameInvalid=3]="UsernameInvalid",s[s.UsernameTaken=4]="UsernameTaken",s[s.UsernameTooShort=5]="UsernameTooShort",s[s.Success=6]="Success",s))(r||{});class A{constructor(e){this.error=r.InvalidType,this.user=new f,e&&(this.error=e.error!==void 0&&e.error!==null?e.error:r.InvalidType,this.user=e.user!==void 0&&e.user!==null?new f(e.user):new f)}toJsonKey(e){switch(e){case"error":return"error";case"user":return"user";default:return e}}}const x=y({components:{CEditItem:$,NButton:C,CHead:S},data(){return{loading:!1}},mounted(){a.init(),i.get(i.get(this,"name"),"input").focus()},methods:{async confirm(){if(this.$data.loading=!0,i.getVal(this,"password").localeCompare(i.getVal(this,"confPassword"))){a.dialogError({title:"Fail",content:"Password does not match.",positiveText:"OK"}),this.$data.loading=!1;return}const s=i.getVal(this,"name").trim(),e=i.getVal(this,"username").trim(),m=i.getVal(this,"email").trim(),d=i.getVal(this,"password").trim();if(s.length<1||m.length<1||d.length<1){this.$data.loading=!1,a.messageError("Missing input. Please try again.");return}if(e.length<3){this.$data.loading=!1,a.messageError("Username should be at least 3 letters.");return}const g=new V({name:s,username:e,email:m,password:d}),w=await E.genPOST("v2/user",U.stringify(g)),l=new A(w);if(l.error!==r.Success){switch(this.$data.loading=!1,l.error){case r.EmailAlreadyExists:a.messageError("Email already has an account registered.");break;case r.EmailInvalid:a.messageError("This is an invalid email. Please try a proper email instead.");break;case r.InvalidType:a.messageError("Unknown error. Please try again later.");break;case r.UsernameInvalid:a.messageError("The provided username is invalid please try a different username.");break;case r.UsernameTaken:a.messageError("Username is already taken. Please try a different username.");break;case r.UsernameTooShort:a.messageError("Username should be at least 3 letters.");break}return}const n=l.user;if(n.ID===-1){this.$data.loading=!1,a.messageError("Unknown error. Please try again later.");return}await T.genCurrentUser(),this.$data.loading=!1,a.messageSuccess("Your account is created successfully!");let o=c.getNext(this.$route);o===u.Landing&&(o=u.User+"/"+n.details.username),await c.genRedirectTo(c.addParamNext(u.unconfirmed_Email,o))},cancel(){k.back()}}}),B={class:"new_user narrow_content"},D=p("h1",{class:"title"},"Create Account",-1),H={class:"newUser narrow_display_window"},b=p("br",null,null,-1),G=_("Confirm"),K=_("Cancel");function O(s,e,m,d,g,w){const l=h("CHead"),n=h("CEditItem"),o=h("n-button");return I(),N("div",B,[t(l,{title:"Create Account",description:"Create your GlobeTrotte account!",type:"signup"}),D,p("form",H,[t(n,{className:"registrationName",label:"Name",ref:"name",onEnter:s.confirm},null,8,["onEnter"]),t(n,{className:"registrationUsername",label:"Username",ref:"username",onEnter:s.confirm},null,8,["onEnter"]),t(n,{className:"registrationEmail",label:"Email",ref:"email",onEnter:s.confirm},null,8,["onEnter"]),t(n,{className:"registrationPassword",label:"Password",ref:"password",type:"password",onEnter:s.confirm},null,8,["onEnter"]),t(n,{className:"registrationConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:s.confirm},null,8,["onEnter"]),b,t(o,{class:"registrationSave left_col",type:"info",onClick:s.confirm,loading:s.loading},{default:v(()=>[G]),_:1},8,["onClick","loading"]),t(o,{class:"registrationCancel right_col",type:"default",onClick:s.cancel},{default:v(()=>[K]),_:1},8,["onClick"])])])}const z=P(x,[["render",O]]);export{z as default};
