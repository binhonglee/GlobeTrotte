var y=Object.defineProperty;var P=(e,s,o)=>s in e?y(e,s,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[s]=o;var c=(e,s,o)=>(P(e,typeof s!="symbol"?s+"":s,o),o);import{C as v,E as a}from"./E.3472039f.js";import{C as E}from"./CLink.aec7ba0a.js";import{_ as k,a as p,R as d,H as g}from"./index.999f971f.js";import{r as u,o as f,d as w,e as t,x as R,w as i,i as m,t as $,v as N,h as l,j as V,z as I,W as h}from"./vendor.c4defc2a.js";class L{constructor(s){c(this,"email","");c(this,"code","");c(this,"password","");s&&(this.email=s.email!==void 0&&s.email!==null?s.email:"",this.code=s.code!==void 0&&s.code!==null?s.code:"",this.password=s.password!==void 0&&s.password!==null?s.password:"")}toJsonKey(s){switch(s){case"email":return"email";case"code":return"code";case"password":return"password";default:return s}}}const _=e=>($("data-v-48aacec7"),e=e(),N(),e),S={class:"password_reset narrow_content"},T=_(()=>m("h1",{class:"title"},"Reset Password",-1)),B={key:0,class:"resetPasswordStart narrow_display_window"},K=_(()=>m("br",null,null,-1)),M=l("Confirm"),O=l("Cancel"),b={class:"backToLogin"},H=l("Back to Login"),W={key:1,class:"resetPasswordInput narrow_display_window"},q=_(()=>m("br",null,null,-1)),z=l("Confirm"),A=l("Cancel");function F(e,s,o,U,D,G){const n=u("CEditItem"),r=u("n-button"),C=u("CLink");return f(),w("div",S,[T,e.step<2?(f(),w("form",B,[t(n,{className:"emailInput",label:"Email",ref:"email",val:e.email,onKeydown:R(e.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),K,t(r,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmEmail,loading:e.loading},{default:i(()=>[M]),_:1},8,["onClick","loading"]),t(r,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:i(()=>[O]),_:1},8,["onClick"]),m("p",b,[t(C,{url:e.loginLink},{default:i(()=>[H]),_:1},8,["url"])])])):(f(),w("form",W,[t(n,{className:"resetEmail",label:"Email",ref:"email",val:e.email,onEnter:e.confirmReset},null,8,["val","onEnter"]),t(n,{className:"resetCode",label:"Code",ref:"code",onEnter:e.confirmReset},null,8,["onEnter"]),t(n,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),t(n,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),q,t(r,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmReset,loading:e.loading},{default:i(()=>[z]),_:1},8,["onClick","loading"]),t(r,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:i(()=>[A]),_:1},8,["onClick"])]))])}const J=V({components:{CEditItem:v,CLink:E,NButton:I},data:()=>({email:"",step:0,loginLink:p.Login,loading:!1}),async mounted(){this.$data.step<2?a.get(a.get(this,"email"),"input").focus():a.get(a.get(this,"code"),"input").focus()},async beforeMount(){var s,o;const e=d.getParamMap();this.$data.email=(s=e.get("email"))!=null?s:"",this.$data.step=+((o=e.get("step"))!=null?o:"")},methods:{async confirmEmail(){await g.genPOST("reset/send_email",h.stringify(a.getVal(this,"email")))?(this.$message({type:"success",message:"Password reset code sent!"}),await d.genRefreshRedirect(p.password_Reset,new Map(Object.entries({email:a.getVal(this,"email"),step:"2"})))):this.$message({type:"error",message:"Account not found with email."})},async confirmReset(){if(a.getVal(this,"password").localeCompare(a.getVal(this,"confPassword"))){this.$alert("Password does not match.","Fail",{confirmButtonText:"OK"}),this.$data.loading=!1;return}const e=new L;e.email=a.getVal(this,"email"),e.code=a.getVal(this,"code"),e.password=a.getVal(this,"password"),await g.genPOST("reset/password",h.stringify(e))?(this.$message({type:"success",message:"Password reset is successful."}),await d.genRedirectTo(p.Login)):this.$message({type:"error",message:"Password reset attempt failed."})},async cancel(){await d.paramToNext()}}});var j=k(J,[["render",F],["__scopeId","data-v-48aacec7"]]);export{j as default};
