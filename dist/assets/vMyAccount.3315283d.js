import{C as E,E as i}from"./E.a3fc0823.js";import{C as b}from"./CLink.94a5dbd3.js";import{C as A}from"./CViewUser.bdae58ea.js";import{_ as B,U as T,a as d,G as h,R as p,H as _,d as I}from"./index.1a3e7aab.js";import{r as o,o as u,d as v,i as n,e as t,w as l,q as L,s as S,f as U,g as D,h as f,j as V,K as j,x as R,W as y}from"./vendor.1cd2bc54.js";import{N as C}from"./NaiveUtils.bff83414.js";import"./CPlaces.7149245f.js";import"./CTripPreviewCard.c4a7690c.js";import"./DataProps.4308ef4e.js";import"./TripUtil.cf3da4e6.js";const N=e=>(L("data-v-4ff3436a"),e=e(),S(),e),P={class:"my_account"},O=N(()=>n("h1",{class:"title"},"My Account",-1)),G={class:"narrow_content accountUnconfirmedAlertBar"},M=f("Please confirm you email address to access the full site."),H={class:"profileInfo"},W={key:0},q={key:1,class:"narrow_content"},K={class:"myAccountButtonGroups"},F=f("Save"),Y=f("Cancel"),x={class:"myAccountDeletion"},z=f("Delete Account");function J(e,r,a,s,m,X){const $=o("n-alert"),w=o("CLink"),k=o("CViewUser"),c=o("CEditItem"),g=o("n-button");return u(),v("div",P,[O,n("div",G,[t(w,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:l(()=>[e.confirmed?D("",!0):(u(),U($,{key:0,title:"Unconfirmed",type:"error"},{default:l(()=>[M]),_:1}))]),_:1},8,["url"])]),n("div",H,[e.edit?(u(),v("div",q,[t(c,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(c,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(c,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),t(c,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),n("div",K,[t(g,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:l(()=>[F]),_:1},8,["onClick"]),t(g,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:l(()=>[Y]),_:1},8,["onClick"])]),n("div",x,[t(g,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:l(()=>[z]),_:1},8,["onClick"])])])):(u(),v("div",W,[t(k,{user:e.user,self:!0,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","onLogout","onToggleEdit"])]))])])}const Q=V({components:{CEditItem:E,CLink:b,CViewUser:A,NAlert:j,NButton:R},data(){return{user:new T,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:d.unconfirmed_Email,loadingBar:h.loadingBar()}},beforeMount(){this.init()},mounted(){this.$data.edit&&i.get(i.get(this,"name"),"input").focus()},methods:{async init(){this.$data.loading=!0,C.init(),this.$data.user=await h.genCurrentUser(),this.$data.user.details.bio=this.$data.user.details.bio.replaceAll("\\n",`
`),this.$data.user.ID===-1&&await p.genRedirectTo(d.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf(),this.$data.loading=!1},confirmDelete(){C.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var r,a,s;(r=this.$data.loadingBar)==null||r.start(),await _.genDELETE("v2/user/"+this.$data.user.ID,y.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(h.notifConfig("Deleted","Your account is now deleted.","info")),(a=this.$data.loadingBar)==null||a.finish(),await p.genRedirectTo(d.Landing)):((s=this.$data.loadingBar)==null||s.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var a,s,m;(a=this.$data.loadingBar)==null||a.start();const e=new I({id:this.$data.user.ID,name:i.getVal(this,"name"),email:i.getVal(this,"email"),bio:i.getVal(this,"bio").replaceAll("\\t","	").replaceAll("	","").replaceAll(`
`,"\\\\n").replaceAll("\\","\\\\"),link:i.getVal(this,"link"),confirmed:this.$data.user.details.confirmed});await _.genPOST("v2/user/"+this.$data.user.ID,y.stringify(e))!==!1?(this.toggleEdit(),(s=this.$data.loadingBar)==null||s.finish(),this.$message({message:"Profile updated successfully!",type:"success"}),this.init()):((m=this.$data.loadingBar)==null||m.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await _.genGET("logout"),localStorage.clear(),await p.genRedirectTo(d.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ce=B(Q,[["render",J],["__scopeId","data-v-4ff3436a"]]);export{ce as default};
