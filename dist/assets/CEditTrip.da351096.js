var R=Object.defineProperty;var A=(e,t,s)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var $=(e,t,s)=>(A(e,typeof t!="symbol"?t+"":t,s),s);import{P as T,_ as C,D as I,T as L,b as M,H as B,G as P,R as j,a as S}from"./index.b45d7991.js";import{j as w,r as u,o as f,d as v,F as E,s as k,i as r,e as a,w as m,z as N,h as y,f as O,y as G,g as H,x as W,W as q}from"./vendor.b76afd09.js";import{C as z,D,E as g,N as F,a as U}from"./E.4def98ad.js";import{C as b}from"./CityUtil.668632f5.js";const K=w({name:"CEditPlaces",props:{givenPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof T))return!1}),!0):!1}}},data:()=>({places:[]}),beforeMount(){var e;this.$data.places=((e=this.$props.givenPlaces)!=null?e:[]).slice(0)},methods:{pushPlace(){this.$data.places.push(new T)},removePlace(e){this.$data.places.splice(e,1)}}}),X={class:"edit_places"},Y=r("br",null,null,-1),J=y("Delete this place"),Q=y("Add another place");function Z(e,t,s,_,i,d){const c=u("el-input"),o=u("el-button"),h=u("el-divider");return f(),v("div",X,[(f(!0),v(E,null,k(e.places,(l,n)=>(f(),v("ul",{key:n,class:"places"},[r("div",{class:N(["editPlace","place"+n])},[a(c,{modelValue:l.label,"onUpdate:modelValue":p=>l.label=p,class:"inputPlaceLabel",type:"text",placeholder:"Place Name"+(n!==0?"":" (eg. Golden Gate Bridge)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(c,{modelValue:l.URL,"onUpdate:modelValue":p=>l.URL=p,class:"inputPlaceLink",type:"text",placeholder:"Link"+(n!==0?"":" (eg. Google Map link)")},null,8,["modelValue","onUpdate:modelValue","placeholder"]),Y,a(c,{modelValue:l.description,"onUpdate:modelValue":p=>l.description=p,class:"inputPlaceDesc",type:"textarea",placeholder:n!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a(o,{class:"removePlace",type:"danger",icon:"el-icon-close",plain:"plain",onClick:p=>e.removePlace(n)},{default:m(()=>[J]),_:2},1032,["onClick"]),a(h,{class:"editPlaceDivider"})],2)]))),128)),a(o,{class:"addPlace",plain:"plain",icon:"el-icon-plus",onClick:e.pushPlace},{default:m(()=>[Q]),_:1},8,["onClick"])])}var V=C(K,[["render",Z]]);const x=w({components:{CEditPlaces:V},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0)},methods:{pushDay(){let e=new I({places:[{}]});e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let i of this.$data.days)t[i.dayOf.valueOf()]=i;const s=this.$data.days.length;this.$data.days=[];let _=0;for(let i=0;i<s;i++){let d=t[i+_];for(;d==null&&i+_<s+5;)_++,d=t[i+_];d.dayOf=i+1,this.$data.days.push(d)}}}}),ee={class:"edit_days narrow_content"},te={class:"editDayCardContent"},se={class:"editDayTitle"},ae=y("Delete this day"),ie=y("Add another day");function le(e,t,s,_,i,d){const c=u("el-button"),o=u("CEditPlaces"),h=u("el-card");return f(),v("div",ee,[(f(!0),v(E,null,k(e.days,(l,n)=>(f(),O(h,{key:l.dayOf.valueOf(),class:N(["editDay","day"+l.dayOf]),shadow:"hover"},{default:m(()=>[r("div",te,[r("div",se,[r("b",null,"Day "+G(l.dayOf),1),a(c,{class:"removeDay",type:"danger",icon:"el-icon-close",plain:"plain",onClick:p=>e.removeDay(n)},{default:m(()=>[ae]),_:2},1032,["onClick"])]),a(o,{ref_for:!0,ref:"places"+n,class:"editPlaces","given-places":l.places},null,8,["given-places"])])]),_:2},1032,["class"]))),128)),a(c,{class:"addDay",icon:"el-icon-plus",onClick:e.pushDay},{default:m(()=>[ie]),_:1},8,["onClick"])])}var ne=C(x,[["render",le],["__scopeId","data-v-2328843e"]]);class oe{constructor(t,s){$(this,"type");$(this,"label");$(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const re={class:"edit_trip"},de={class:"edit_form"},ce={class:"narrow_content"},pe={class:"editTripPrivacy"},ue=r("span",{class:"editLabel"},"Private:",-1),he={class:"editCity"},_e=r("span",{class:"editLabel"},"Cities:",-1),fe={class:"confirmationButtons narrow_content"},me=y("Save"),ye=y("Cancel"),ve=y("Delete");function ge(e,t,s,_,i,d){const c=u("CEditItem"),o=u("el-switch"),h=u("n-select"),l=u("CEditDays"),n=u("el-button");return f(),v("div",re,[r("form",de,[r("div",ce,[a(c,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(c,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),r("div",pe,[ue,a(o,{class:"editInput",modelValue:e.private,"onUpdate:modelValue":t[0]||(t[0]=p=>e.private=p)},null,8,["modelValue"])]),r("div",he,[_e,a(h,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=p=>e.cities=p),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])])]),a(l,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),r("div",fe,[a(n,{class:"saveEditTrip",type:"primary",onClick:e.save,loading:e.saving},{default:m(()=>[me]),_:1},8,["onClick","loading"]),a(n,{class:"cancelEditTrip",type:"default",onClick:e.cancel},{default:m(()=>[ye]),_:1},8,["onClick"]),e.isNew?H("",!0):(f(),O(n,{key:0,class:"deleteTrip",onClick:e.del,type:"danger",loading:e.deleting},{default:m(()=>[ve]),_:1},8,["onClick","loading"]))])])])}const $e=3,Ce=w({components:{NSelect:W,CEditDays:ne,CEditItem:z,CEditPlaces:V},props:{trip:{type:L,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return D},descriptionRowMinCount(){return $e}},beforeMount(){this.update()},mounted(){g.get(g.get(this,"name"),"input").focus()},methods:{cancel(){var e;g.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new M;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=b.stringToCities(this.$data.cities.join(","));const t=g.getVal(this,"name"),s=g.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const i=g.get(this,"days");let d=0;for(const c in i.days){const o=i.days[c],h=this.filterPlaces(o.places);if(h===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}h.length>0?(o.places=h,o.dayOf=o.dayOf-d,e.days.push(o)):d++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},async del(){this.$data.deleting=!0;let e=Boolean(await B.genDELETE("v2/trip/"+this.$props.trip.ID,q.stringify(this.$props.trip)));e||(e=(await P.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(P.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&j.genRedirectTo(S.Landing)},tripToItem(e){return new oe(e,this.$props.trip[e])},update(){this.$data.possibleCities=b.sortedCityOptions(),this.$data.cities=b.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<F?(this.showAlert("Trip name is too short."),!1):e.length>U?(this.showAlert(`Trip name cannot be longer than ${U}.`),!1):!t||t.length>D?(this.showAlert(`Trip description cannot be longer than ${D}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var Ee=C(Ce,[["render",ge]]);export{Ee as C};
