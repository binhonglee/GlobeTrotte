var U=Object.defineProperty;var C=(s,e,r)=>e in s?U(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var i=(s,e,r)=>(C(s,typeof e!="symbol"?e+"":e,r),r);import{r as v,o as I,d as T,i as p,e as o,w as y,h as E,j as k,z as N,W as _}from"./vendor.7e76ed18.js";import{U as u,_ as P,H as $,G as S,R as f,a as h,r as V}from"./index.5f7d8ff2.js";import{C as A,E as l}from"./E.318fca05.js";import{N as a}from"./NaiveUtils.f685e1b2.js";class B{constructor(e){i(this,"ID",-1);i(this,"username","");i(this,"name","");i(this,"email","");i(this,"bio","");i(this,"password","");e&&(this.ID=e.id!==void 0&&e.id!==null?e.id:-1,this.username=e.username!==void 0&&e.username!==null?e.username:"",this.name=e.name!==void 0&&e.name!==null?e.name:"",this.email=e.email!==void 0&&e.email!==null?e.email:"",this.bio=e.bio!==void 0&&e.bio!==null?e.bio:"",this.password=e.password!==void 0&&e.password!==null?e.password:"")}toJsonKey(e){switch(e){case"ID":return"id";case"username":return"username";case"name":return"name";case"email":return"email";case"bio":return"bio";case"password":return"password";default:return e}}register(e){this.name=e.name,this.username=e.username,this.email=e.email,this.password=e.password}}var n=(s=>(s[s.InvalidType=0]="InvalidType",s[s.EmailAlreadyExists=1]="EmailAlreadyExists",s[s.EmailInvalid=2]="EmailInvalid",s[s.UsernameInvalid=3]="UsernameInvalid",s[s.UsernameTaken=4]="UsernameTaken",s[s.UsernameTooShort=5]="UsernameTooShort",s[s.Success=6]="Success",s))(n||{});class x{constructor(e){i(this,"error",n.InvalidType);i(this,"user",new u);e&&(this.error=e.error!==void 0&&e.error!==null?e.error:n.InvalidType,this.user=e.user!==void 0&&e.user!==null?new u(e.user):new u)}toJsonKey(e){switch(e){case"error":return"error";case"user":return"user";default:return e}}}const D={class:"new_user narrow_content"},K=p("h1",{class:"title"},"Create Account",-1),O={class:"newUser narrow_display_window"},b=p("br",null,null,-1),G=E("Confirm"),H=E("Cancel");function J(s,e,r,d,g,w){const t=v("CEditItem"),m=v("n-button");return I(),T("div",D,[K,p("form",O,[o(t,{className:"registrationName",label:"Name",ref:"name",onEnter:s.confirm},null,8,["onEnter"]),o(t,{className:"registrationUsername",label:"Username",ref:"username",onEnter:s.confirm},null,8,["onEnter"]),o(t,{className:"registrationEmail",label:"Email",ref:"email",onEnter:s.confirm},null,8,["onEnter"]),o(t,{className:"registrationPassword",label:"Password",ref:"password",type:"password",onEnter:s.confirm},null,8,["onEnter"]),o(t,{className:"registrationConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:s.confirm},null,8,["onEnter"]),b,o(m,{class:"registrationSave left_col",type:"info",onClick:s.confirm,loading:s.loading},{default:y(()=>[G]),_:1},8,["onClick","loading"]),o(m,{class:"registrationCancel right_col",type:"default",onClick:s.cancel},{default:y(()=>[H]),_:1},8,["onClick"])])])}const M=k({components:{CEditItem:A,NButton:N},data(){return{loading:!1}},mounted(){a.init(),l.get(l.get(this,"name"),"input").focus()},methods:{async confirm(){if(this.$data.loading=!0,l.getVal(this,"password").localeCompare(l.getVal(this,"confPassword"))){this.$alert("Password does not match.","Fail",{confirmButtonText:"OK"}),this.$data.loading=!1;return}const s=l.getVal(this,"name").trim(),e=l.getVal(this,"username").trim(),r=l.getVal(this,"email").trim(),d=l.getVal(this,"password").trim();if(s.length<1||r.length<1||d.length<1){this.$data.loading=!1,a.messageError("Missing input. Please try again.");return}if(e.length<3){this.$data.loading=!1,a.messageError("Username should be at least 3 letters.");return}const g=new B({name:s,username:e,email:r,password:d}),w=await $.genPOST("v2/user",_.stringify(g)),t=new x(w);if(t.error!==n.Success){switch(this.$data.loading=!1,t.error){case n.EmailAlreadyExists:a.messageError("Email already has an account registered.");break;case n.EmailInvalid:a.messageError("This is an invalid email. Please try a proper email instead.");break;case n.InvalidType:a.messageError("Unknown error. Please try again later.");break;case n.UsernameInvalid:a.messageError("The provided username is invalid please try a different username.");break;case n.UsernameTaken:a.messageError("Username is already taken. Please try a different username.");break;case n.UsernameTooShort:a.messageError("Username should be at least 3 letters.");break}return}const m=t.user;if(m.ID===-1){this.$data.loading=!1,a.messageError("Unknown error. Please try again later.");return}localStorage.setItem("userobj",_.stringify(m)),this.$data.loading=!1,this.$notify(S.notifConfig("Success","Your account is created successfully!","success"));let c=f.getNext(this.$route);c===h.Landing&&(c=h.MyAccount),await f.genRedirectTo(f.addParamNext(h.unconfirmed_Email,c))},cancel(){V.back()}}});var Y=P(M,[["render",J]]);export{Y as default};
