var E=Object.defineProperty;var U=(a,e,n)=>e in a?E(a,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[e]=n;var t=(a,e,n)=>(U(a,typeof e!="symbol"?e+"":e,n),n);import{d as _,N as T,H as I,W as k,G as N,R as u,f,v as P,r as p,o as $,c as S,a as l,e as g,g as y,i as C,_ as V}from"./index-147973cf.js";import{U as h}from"./UserObj-90887f06.js";import{C as A,E as o}from"./CEditItem-1595fc0d.js";import{N as s}from"./NaiveUtils-395111c1.js";import{C as H}from"./CHead-73ad5be2.js";import"./TripObj-b50c88ea.js";import"./Input-c3c5bdea.js";class x{constructor(e){t(this,"ID",-1);t(this,"username","");t(this,"name","");t(this,"email","");t(this,"bio","");t(this,"password","");e&&(this.ID=e.id!==void 0&&e.id!==null?e.id:-1,this.username=e.username!==void 0&&e.username!==null?e.username:"",this.name=e.name!==void 0&&e.name!==null?e.name:"",this.email=e.email!==void 0&&e.email!==null?e.email:"",this.bio=e.bio!==void 0&&e.bio!==null?e.bio:"",this.password=e.password!==void 0&&e.password!==null?e.password:"")}toJsonKey(e){switch(e){case"ID":return"id";case"username":return"username";case"name":return"name";case"email":return"email";case"bio":return"bio";case"password":return"password";default:return e}}register(e){this.name=e.name,this.username=e.username,this.email=e.email,this.password=e.password}}var r=(a=>(a[a.InvalidType=0]="InvalidType",a[a.EmailAlreadyExists=1]="EmailAlreadyExists",a[a.EmailInvalid=2]="EmailInvalid",a[a.UsernameInvalid=3]="UsernameInvalid",a[a.UsernameTaken=4]="UsernameTaken",a[a.UsernameTooShort=5]="UsernameTooShort",a[a.Success=6]="Success",a))(r||{});class B{constructor(e){t(this,"error",r.InvalidType);t(this,"user",new h);e&&(this.error=e.error!==void 0&&e.error!==null?e.error:r.InvalidType,this.user=e.user!==void 0&&e.user!==null?new h(e.user):new h)}toJsonKey(e){switch(e){case"error":return"error";case"user":return"user";default:return e}}}const D=_({components:{CEditItem:A,NButton:T,CHead:H},data(){return{loading:!1}},mounted(){s.init(),o.get(o.get(this,"name"),"input").focus()},methods:{async confirm(){if(this.$data.loading=!0,o.getVal(this,"password").localeCompare(o.getVal(this,"confPassword"))){s.dialogError({title:"Fail",content:"Password does not match.",positiveText:"OK"}),this.$data.loading=!1;return}const a=o.getVal(this,"name").trim(),e=o.getVal(this,"username").trim(),n=o.getVal(this,"email").trim(),c=o.getVal(this,"password").trim();if(a.length<1||n.length<1||c.length<1){this.$data.loading=!1,s.messageError("Missing input. Please try again.");return}if(e.length<3){this.$data.loading=!1,s.messageError("Username should be at least 3 letters.");return}const w=new x({name:a,username:e,email:n,password:c}),v=await I.genPOST("v2/user",k.stringify(w)),d=new B(v);if(d.error!==r.Success){switch(this.$data.loading=!1,d.error){case r.EmailAlreadyExists:s.messageError("Email already has an account registered.");break;case r.EmailInvalid:s.messageError("This is an invalid email. Please try a proper email instead.");break;case r.InvalidType:s.messageError("Unknown error. Please try again later.");break;case r.UsernameInvalid:s.messageError("The provided username is invalid please try a different username.");break;case r.UsernameTaken:s.messageError("Username is already taken. Please try a different username.");break;case r.UsernameTooShort:s.messageError("Username should be at least 3 letters.");break}return}const i=d.user;if(i.ID===-1){this.$data.loading=!1,s.messageError("Unknown error. Please try again later.");return}await N.genCurrentUser(),this.$data.loading=!1,s.messageSuccess("Your account is created successfully!");let m=u.getNext(this.$route);m===f.Landing&&(m=f.User+"/"+i.details.username),await u.genRedirectTo(u.addParamNext(f.unconfirmed_Email,m))},cancel(){P.back()}}}),G={class:"new_user narrow_content"},K=g("h1",{class:"title"},"Create Account",-1),O={class:"newUser narrow_display_window"},b=g("br",null,null,-1);function J(a,e,n,c,w,v){const d=p("CHead"),i=p("CEditItem"),m=p("n-button");return $(),S("div",G,[l(d,{title:"Create Account",description:"Create your GlobeTrotte account!",type:"signup"}),K,g("form",O,[l(i,{className:"registrationName",label:"Name",ref:"name",onEnter:a.confirm},null,8,["onEnter"]),l(i,{className:"registrationUsername",label:"Username",ref:"username",onEnter:a.confirm},null,8,["onEnter"]),l(i,{className:"registrationEmail",label:"Email",ref:"email",onEnter:a.confirm},null,8,["onEnter"]),l(i,{className:"registrationPassword",label:"Password",ref:"password",type:"password",onEnter:a.confirm},null,8,["onEnter"]),l(i,{className:"registrationConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:a.confirm},null,8,["onEnter"]),b,l(m,{class:"registrationSave left_col",type:"info",onClick:a.confirm,loading:a.loading},{default:y(()=>[C("Confirm")]),_:1},8,["onClick","loading"]),l(m,{class:"registrationCancel right_col",type:"default",onClick:a.cancel},{default:y(()=>[C("Cancel")]),_:1},8,["onClick"])])])}const X=V(D,[["render",J]]);export{X as default};
