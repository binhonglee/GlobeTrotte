var x=Object.defineProperty;var W=(e,t,s)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var b=(e,t,s)=>(W(e,typeof t!="symbol"?t+"":t,s),s);import{P as O,a as q,D as U,C as P}from"./DataProps.434363a8.js";import{j as D,o as r,f as k,e as a,r as i,d as $,i as o,F as A,s as L,w as l,g as M,y as R,h as m,t as N,B as z,J as B,v as K,K as F,z as X,A as J,x as Y,L as Q,W as Z}from"./vendor.6a882937.js";import{_ as E,D as ee,T as te,c as se,H as ae,G as j,R as ie,a as ne}from"./index.fe573105.js";import{C as oe,D as I,E as T,N as le,a as S}from"./E.fb8361d5.js";const re={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ce=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),de=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1);var V=D({name:"Add",render:function(t,s){return r(),k("svg",re,[ce,de])}});const pe={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),_e=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1);var G=D({name:"CloseOutline",render:function(t,s){return r(),k("svg",pe,[ue,_e])}});const he={class:"edit_places"},ve={class:"places"},me={key:0,class:"editTravelTime"},fe={key:0,class:"travelTimeInput"},ye=o("div",{class:"travelTimeLabel"},"Travel time",-1),ge=m("minutes"),$e=m("Set travel time"),Ce=o("br",null,null,-1),we=m("Delete this place"),Te=m("Add another place");function De(e,t,s,f,n,u){const h=i("n-divider"),c=i("n-input-number"),d=i("n-button"),C=i("n-input"),w=i("close-outline"),y=i("n-icon"),g=i("add");return r(),$("div",he,[o("ul",ve,[(r(!0),$(A,null,L(e.propPlaces,(p,_)=>(r(),$("li",{class:"place",key:_},[_>0?(r(),$("div",me,[a(h,{class:"editPlaceDivider"}),p.travelTime!==void 0?(r(),$("div",fe,[ye,a(c,{placeholder:"Travel time (in minutes)",type:"text",min:0,value:p.travelTime.timeInMinutes,"onUpdate:value":v=>p.travelTime.timeInMinutes=v},{suffix:l(()=>[ge]),_:2},1032,["value","onUpdate:value"])])):(r(),k(d,{key:1,class:"setTravelTime",type:"default",onClick:v=>e.setTravelTime(_)},{default:l(()=>[$e]),_:2},1032,["onClick"])),a(h,{class:"editPlaceDivider"})])):M("",!0),o("div",{class:R(["editPlace","place"+_])},[a(C,{class:"inputPlaceLabel",value:p.place.label,"onUpdate:value":v=>p.place.label=v,type:"text",placeholder:"Place Name"+(_!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","placeholder"]),a(C,{class:"inputPlaceLink",value:p.place.URL,"onUpdate:value":v=>p.place.URL=v,type:"text",placeholder:"Link"+(_!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","placeholder"]),Ce,a(C,{class:"inputPlaceDesc",value:p.place.description,"onUpdate:value":v=>p.place.description=v,type:"textarea",placeholder:_!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","placeholder"]),a(d,{class:"removePlace",type:"error",secondary:"",onClick:v=>e.removePlace(_)},{default:l(()=>[a(y,null,{default:l(()=>[a(w)]),_:1}),we]),_:2},1032,["onClick"])],2)]))),128))]),a(h,{class:"editPlaceDivider"}),a(d,{class:"addPlace",onClick:e.pushPlace},{default:l(()=>[a(y,null,{default:l(()=>[a(g)]),_:1}),Te]),_:1},8,["onClick"])])}const ke=D({name:"CEditPlaces",components:{Add:V,CloseOutline:G,NButton:N,NDivider:z,NIcon:B,NInput:K,NInputNumber:F},model:{props:{propPlaces:Array()},emits:["update:propPlaces"]},props:{propPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof O))return!1}),!0):!1}}},methods:{pushPlace(){this.$props.propPlaces.push(new O)},removePlace(e){this.$props.propPlaces.splice(e,1)},setTravelTime(e){const t=new q;t.toPlaceIndex=e,this.$props.propPlaces[e].travelTime=t}}});var H=E(ke,[["render",De]]);const be={class:"edit_days narrow_content"},Pe={class:"editDayCardContent"},Ne={class:"editDayTitle"},Ee=m("Delete this day"),Ie=m("Add another day");function Oe(e,t,s,f,n,u){const h=i("close-outline"),c=i("n-icon"),d=i("n-button"),C=i("CEditPlaces"),w=i("n-card"),y=i("add");return r(),$("div",be,[(r(!0),$(A,null,L(e.days,(g,p)=>(r(),k(w,{class:R(["editDay","day"+g.dayOf]),key:g.dayOf,hoverable:"","content-style":"padding: 0"},{default:l(()=>[o("div",Pe,[o("div",Ne,[o("b",null,"Day "+X(g.dayOf),1),a(d,{class:"removeDay",secondary:"",type:"error",onClick:_=>e.removeDay(p)},{default:l(()=>[a(c,null,{default:l(()=>[a(h)]),_:1}),Ee]),_:2},1032,["onClick"])]),a(C,{class:"editPlaces",ref_for:!0,ref:"places"+p,propPlaces:g.propPlaces,"onUpdate:propPlaces":_=>g.propPlaces=_},null,8,["propPlaces","onUpdate:propPlaces"])])]),_:2},1032,["class"]))),128)),a(d,{class:"addDay",onClick:t[0]||(t[0]=g=>e.pushDay())},{default:l(()=>[a(c,null,{default:l(()=>[a(y)]),_:1}),Ie]),_:1})])}const Ue=D({components:{Add:V,CEditPlaces:H,CloseOutline:G,NButton:N,NCard:J,NIcon:B},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new U(e))},methods:{pushDay(){let e=new U(new ee({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let n of this.$data.days)t[n.dayOf]=n;const s=this.$data.days.length;this.$data.days=[];let f=0;for(let n=0;n<s;n++){let u=t[n+f];for(;u==null&&n+f<s+5;)f++,u=t[n+f];u.dayOf=n+1,this.$data.days.push(u)}}}});var Ae=E(Ue,[["render",Oe],["__scopeId","data-v-e404e4de"]]);class Le{constructor(t,s){b(this,"type");b(this,"label");b(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const Me={class:"edit_trip"},Re={class:"edit_form"},Be={class:"narrow_content"},je={class:"editTripPrivacy"},Se=o("span",{class:"editLabel"},"Private:",-1),Ve={class:"editInput"},Ge={class:"editCity"},He=o("span",{class:"editLabel"},"Cities:",-1),xe={class:"confirmationButtons narrow_content"},We=m("Save"),qe=m("Cancel"),ze=m("Delete");function Ke(e,t,s,f,n,u){const h=i("CEditItem"),c=i("n-switch"),d=i("n-select"),C=i("CEditDays"),w=i("n-button");return r(),$("div",Me,[o("form",Re,[o("div",Be,[a(h,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(h,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),o("div",je,[Se,o("div",Ve,[a(c,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=y=>e.private=y)},null,8,["value"])])]),o("div",Ge,[He,a(d,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=y=>e.cities=y),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])])]),a(C,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),o("div",xe,[a(w,{class:"saveEditTrip",type:"info",onClick:e.save,loading:e.saving},{default:l(()=>[We]),_:1},8,["onClick","loading"]),a(w,{class:"cancelEditTrip",type:"default",onClick:e.cancel},{default:l(()=>[qe]),_:1},8,["onClick"]),e.isNew?M("",!0):(r(),k(w,{key:0,class:"deleteTrip",onClick:e.del,type:"error",loading:e.deleting},{default:l(()=>[ze]),_:1},8,["onClick","loading"]))])])])}const Fe=3,Xe=D({components:{NButton:N,NSelect:Y,NSwitch:Q,CEditDays:Ae,CEditItem:oe,CEditPlaces:H},props:{trip:{type:te,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return I},descriptionRowMinCount(){return Fe}},beforeMount(){this.update()},mounted(){T.get(T.get(this,"name"),"input").focus()},methods:{cancel(){var e;T.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new se;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=P.stringToCities(this.$data.cities.join(","));const t=T.getVal(this,"name"),s=T.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const n=T.get(this,"days");let u=0;for(const h in n.days){const c=n.days[h].toDay(),d=this.filterPlaces(c.places);if(d===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}d.length>0?(c.places=d,c.dayOf=c.dayOf-u,e.days.push(c)):u++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},async del(){this.$data.deleting=!0;let e=Boolean(await ae.genDELETE("v2/trip/"+this.$props.trip.ID,Z.stringify(this.$props.trip)));e||(e=(await j.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(j.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&ie.genRedirectTo(ne.Landing)},tripToItem(e){return new Le(e,this.$props.trip[e])},update(){this.$data.possibleCities=P.sortedCityOptions(),this.$data.cities=P.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<le?(this.showAlert("Trip name is too short."),!1):e.length>S?(this.showAlert(`Trip name cannot be longer than ${S}.`),!1):!t||t.length>I?(this.showAlert(`Trip description cannot be longer than ${I}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var tt=E(Xe,[["render",Ke]]);export{tt as C};
