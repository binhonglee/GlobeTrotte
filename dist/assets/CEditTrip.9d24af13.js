var at=Object.defineProperty;var it=(e,t,s)=>t in e?at(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var R=(e,t,s)=>(it(e,typeof t!="symbol"?t+"":t,s),s);import{P as he,a as lt,D as me}from"./DataProps.44ae130e.js";import{d as M,y as $,B as ot,A as rt,T as dt,U as Ne,X as ut,V as H,I as ct,W as pt,Y as P,ac as ft,a2 as ht,x as mt,aY as ve,K as ge,aZ as vt,a7 as _e,aa as V,a_ as gt,o as D,c as O,e as h,N as se,m as _t,a$ as Ie,f as j,r as m,F as Re,i as ke,a as o,w,j as ae,q as Oe,n as Se,k as S,p as yt,b as wt,_ as ie,l as bt,t as Ct,aS as Me,b0 as $t,R as Dt,g as Tt}from"./index.c74f9166.js";import{u as Nt,N as Pe}from"./Input.a7711bb2.js";import{D as It,T as le,b as Rt,c as ye}from"./TripObj.7f17e106.js";import{C as kt,D as ee,E as A,N as Ot,a as we}from"./CEditItem.5ac1921b.js";import{N as G,a as be}from"./NaiveUtils.632d4605.js";import{C as St,a as Mt,P as Pt,b as Vt,F as At,p as Ce}from"./UserUtil.6b2dcc59.js";import{N as Bt}from"./Select.3c8956a0.js";const Ut=M({name:"Add",render(){return $("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},$("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),Lt=M({name:"Remove",render(){return $("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},$("line",{x1:"400",y1:"256",x2:"112",y2:"256",style:`
        fill: none;
        stroke: currentColor;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-width: 32px;
      `}))}});function Et(e){return e==null||typeof e=="string"&&e.trim()===""?null:Number(e)}function xt(e){return e.includes(".")&&(/^(-)?\d+.*(\.|0)$/.test(e)||/^\.\d+$/.test(e))}function te(e){return e==null?!0:!Number.isNaN(e)}function Ft(e){return e==null?"":String(e)}function ne(e){if(e===null)return null;if(typeof e=="number")return e;{const t=Number(e);return Number.isNaN(t)?null:t}}const Ht=ot([rt("input-number-suffix",`
 display: inline-block;
 margin-right: 10px;
 `)]),$e=800,De=100,Gt=Object.assign(Object.assign({},Ne.props),{autofocus:Boolean,loading:{type:Boolean,default:void 0},placeholder:String,defaultValue:{type:Number,default:null},value:Number,step:{type:[Number,String],default:1},min:[Number,String],max:[Number,String],size:String,disabled:{type:Boolean,default:void 0},validator:Function,bordered:{type:Boolean,default:void 0},showButton:{type:Boolean,default:!0},readonly:Boolean,clearable:Boolean,keyboard:{type:Object,default:{}},updateValueOnInput:{type:Boolean,default:!0},status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onChange:[Function,Array]}),Wt=M({name:"InputNumber",props:Gt,setup(e){const{mergedBorderedRef:t,mergedClsPrefixRef:s,mergedRtlRef:i}=dt(e),r=Ne("InputNumber","-input-number",Ht,vt,e,s),{localeRef:u}=Nt("InputNumber"),g=ut(e),{mergedSizeRef:b,mergedDisabledRef:c,mergedStatusRef:_}=g,y=H(null),N=H(null),I=H(null),v=H(e.defaultValue),f=ct(e,"value"),p=pt(f,v),B=H(""),xe=n=>{const a=[e.min,e.max,e.step,n].map(l=>{const d=String(l).split(".")[1];return d?d.length:0});return Math.max(...a)},Fe=P(()=>{const{placeholder:n}=e;return n!==void 0?n:u.value.placeholder}),W=P(()=>{const n=ne(e.step);return n!==null?n===0?1:Math.abs(n):1}),oe=P(()=>{const n=ne(e.min);return n!==null?n:null}),re=P(()=>{const n=ne(e.max);return n!==null?n:null}),U=n=>{const{value:a}=p;if(n===a){L();return}const{"onUpdate:value":l,onUpdateValue:d,onChange:T}=e,{nTriggerFormInput:F,nTriggerFormChange:C}=g;T&&V(T,n),d&&V(d,n),l&&V(l,n),v.value=n,F(),C()},k=(n=0,a=!0,l=!1)=>{const{value:d}=B;if(l&&xt(d))return!1;const T=Et(d);if(T===null)return a&&U(null),null;if(te(T)){const F=xe(T);let C=parseFloat((T+n).toFixed(F));if(te(C)){const{value:Z}=re,{value:Q}=oe;if(Z!==null&&C>Z){if(!a||l)return!1;C=Z}if(Q!==null&&C<Q){if(!a||l)return!1;C=Q}return e.validator&&!e.validator(C)?!1:(a&&U(C),C)}}return!1},L=()=>{const{value:n}=p;te(n)?B.value=Ft(n):B.value=String(n)};L();const He=P(()=>k(0,!1)===!1),de=P(()=>{const{value:n}=p;if(e.validator&&n===null)return!1;const{value:a}=W;return k(-a,!1)!==!1}),ue=P(()=>{const{value:n}=p;if(e.validator&&n===null)return!1;const{value:a}=W;return k(+a,!1)!==!1});function Ge(n){const{onFocus:a}=e,{nTriggerFormFocus:l}=g;a&&V(a,n),l()}function We(n){var a,l;if(n.target===((a=y.value)===null||a===void 0?void 0:a.wrapperElRef))return;const d=k();if(d!==!1){const C=(l=y.value)===null||l===void 0?void 0:l.inputElRef;C&&(C.value=String(d||"")),p.value===d&&L()}else L();const{onBlur:T}=e,{nTriggerFormBlur:F}=g;T&&V(T,n),F()}function ze(n){const{onClear:a}=e;a&&V(a,n)}function X(){const{value:n}=ue;if(!n){fe();return}const{value:a}=p;if(a===null)e.validator||U(ce());else{const{value:l}=W;k(l)}}function Y(){const{value:n}=de;if(!n){pe();return}const{value:a}=p;if(a===null)e.validator||U(ce());else{const{value:l}=W;k(-l)}}const Ke=Ge,je=We;function ce(){if(e.validator)return null;const{value:n}=oe,{value:a}=re;return n!==null?Math.max(0,n):a!==null?Math.min(0,a):0}function qe(n){ze(n),U(null)}function Je(n){var a,l,d;!((a=I.value)===null||a===void 0)&&a.$el.contains(n.target)&&n.preventDefault(),!((l=N.value)===null||l===void 0)&&l.$el.contains(n.target)&&n.preventDefault(),(d=y.value)===null||d===void 0||d.activate()}let E=null,x=null,z=null;function pe(){z&&(window.clearTimeout(z),z=null),E&&(window.clearInterval(E),E=null)}function fe(){K&&(window.clearTimeout(K),K=null),x&&(window.clearInterval(x),x=null)}function Xe(){z=window.setTimeout(()=>{E=window.setInterval(()=>{Y()},De)},$e),_e("mouseup",document,()=>{window.setTimeout(pe,0)})}let K=null;function Ye(){K=window.setTimeout(()=>{x=window.setInterval(()=>{X()},De)},$e),_e("mouseup",document,()=>{window.setTimeout(fe,0)})}const Ze=()=>{x||X()},Qe=()=>{E||Y()};function et(n){var a,l;if(n.code==="Enter"||n.code==="NumpadEnter"){if(n.target===((a=y.value)===null||a===void 0?void 0:a.wrapperElRef))return;k()!==!1&&((l=y.value)===null||l===void 0||l.deactivate())}else if(n.code==="ArrowUp"){if(e.keyboard.ArrowUp===!1)return;n.preventDefault(),k()!==!1&&X()}else if(n.code==="ArrowDown"){if(e.keyboard.ArrowDown===!1)return;n.preventDefault(),k()!==!1&&Y()}}function tt(n){B.value=n,e.updateValueOnInput&&k(0,!0,!0)}ft(p,()=>{L()});const nt={focus:()=>{var n;return(n=y.value)===null||n===void 0?void 0:n.focus()},blur:()=>{var n;return(n=y.value)===null||n===void 0?void 0:n.blur()}},st=ht("InputNumber",i,s);return Object.assign(Object.assign({},nt),{rtlEnabled:st,inputInstRef:y,minusButtonInstRef:N,addButtonInstRef:I,mergedClsPrefix:s,mergedBordered:t,uncontrolledValue:v,mergedValue:p,mergedPlaceholder:Fe,displayedValueInvalid:He,mergedSize:b,mergedDisabled:c,displayedValue:B,addable:ue,minusable:de,mergedStatus:_,handleFocus:Ke,handleBlur:je,handleClear:qe,handleMouseDown:Je,handleAddClick:Ze,handleMinusClick:Qe,handleAddMousedown:Ye,handleMinusMousedown:Xe,handleKeyDown:et,handleUpdateDisplayedValue:tt,mergedTheme:r,inputThemeOverrides:{paddingSmall:"0 8px 0 10px",paddingMedium:"0 8px 0 12px",paddingLarge:"0 8px 0 14px"},buttonThemeOverrides:mt(()=>{const{self:{iconColorDisabled:n}}=r.value,[a,l,d,T]=gt(n);return{textColorTextDisabled:`rgb(${a}, ${l}, ${d})`,opacityDisabled:`${T}`}})})},render(){const{mergedClsPrefix:e}=this;return $("div",{class:[`${e}-input-number`,this.rtlEnabled&&`${e}-input-number--rtl`]},$(Pe,{ref:"inputInstRef",autofocus:this.autofocus,status:this.mergedStatus,bordered:this.mergedBordered,loading:this.loading,value:this.displayedValue,onUpdateValue:this.handleUpdateDisplayedValue,theme:this.mergedTheme.peers.Input,themeOverrides:this.mergedTheme.peerOverrides.Input,builtinThemeOverrides:this.inputThemeOverrides,size:this.mergedSize,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,readonly:this.readonly,textDecoration:this.displayedValueInvalid?"line-through":void 0,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeydown:this.handleKeyDown,onMousedown:this.handleMouseDown,onClear:this.handleClear,clearable:this.clearable,internalLoadingBeforeSuffix:!0},{prefix:()=>{var t,s;return(s=(t=this.$slots).prefix)===null||s===void 0?void 0:s.call(t)},suffix:()=>{var t,s;return this.showButton?[this.$slots.suffix&&$("span",{class:`${e}-input-number-suffix`},{default:this.$slots.suffix}),$(ve,{text:!0,disabled:!this.minusable||this.mergedDisabled||this.readonly,focusable:!1,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleMinusClick,onMousedown:this.handleMinusMousedown,ref:"minusButtonInstRef"},{default:()=>$(ge,{clsPrefix:e,"aria-disabled":!0},{default:()=>$(Lt,null)})}),$(ve,{text:!0,disabled:!this.addable||this.mergedDisabled||this.readonly,focusable:!1,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleAddClick,onMousedown:this.handleAddMousedown,ref:"addButtonInstRef"},{default:()=>$(ge,{clsPrefix:e},{default:()=>$(Ut,null)})})]:(s=(t=this.$slots).suffix)===null||s===void 0?void 0:s.call(t)}}))}}),zt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Kt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),jt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1),qt=[Kt,jt],Ve=M({name:"Add",render:function(t,s){return D(),O("svg",zt,qt)}}),Jt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Xt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),Yt=h("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1),Zt=[Xt,Yt],Ae=M({name:"CloseOutline",render:function(t,s){return D(),O("svg",Jt,Zt)}});var q=(e=>(e[e.URLInvalid=0]="URLInvalid",e[e.URLNotFound=1]="URLNotFound",e[e.URLProcessingFailed=2]="URLProcessingFailed",e[e.None=3]="None",e))(q||{});class Qt{constructor(t){R(this,"URL","");R(this,"title","");R(this,"description","");R(this,"siteName","");R(this,"error",q.None);t&&(this.URL=t.url!==void 0&&t.url!==null?t.url:"",this.title=t.title!==void 0&&t.title!==null?t.title:"",this.description=t.description!==void 0&&t.description!==null?t.description:"",this.siteName=t.site_name!==void 0&&t.site_name!==null?t.site_name:"",this.error=t.error!==void 0&&t.error!==null?t.error:q.None)}toJsonKey(t){switch(t){case"URL":return"url";case"title":return"title";case"description":return"description";case"siteName":return"site_name";case"error":return"error";default:return t}}}const en=M({name:"CEditPlaces",components:{Add:Ve,CloseOutline:Ae,NButton:se,NDivider:_t,NIcon:Ie,NInput:Pe,NInputNumber:Wt},model:{props:{propPlaces:Array()},emits:["update:propPlaces"]},props:{propPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof he))return!1}),!0):!1}}},data:()=>({parsing:[]}),beforeMount(){this.$props.propPlaces.map(()=>this.$data.parsing.push(!1))},methods:{pushPlace(){this.$props.propPlaces.push(new he)},removePlace(e){this.$props.propPlaces.splice(e,1)},setTravelTime(e){const t=new lt;t.toPlaceIndex=e,this.$props.propPlaces[e].travelTime=t},async parse(e){this.$data.parsing[e]=!0;const t=JSON.stringify(this.$props.propPlaces[e].place.URL.valueOf().trim()),s=await j.genPOST("parseURL",t);if(s===null){this.$data.parsing[e]=!1;return}const i=new Qt(s);if(i.error!==q.None){this.$data.parsing[e]=!1;return}this.$props.propPlaces[e].place.URL=i.URL.valueOf(),this.$props.propPlaces[e].place.label=i.title.valueOf(),this.$props.propPlaces[e].place.description=i.description.valueOf(),this.$data.parsing[e]=!1}}}),Be=e=>(yt("data-v-6ef07bd7"),e=e(),wt(),e),tn={class:"edit_places"},nn={class:"places"},sn={key:0,class:"editTravelTime"},an={key:0,class:"travelTimeInput"},ln=Be(()=>h("div",{class:"travelTimeLabel"},"Travel time",-1)),on=S("minutes"),rn=S("Set travel time"),dn=S("Parse"),un=Be(()=>h("br",null,null,-1)),cn=S("Delete this place"),pn=S("Add another place");function fn(e,t,s,i,r,u){const g=m("n-divider"),b=m("n-input-number"),c=m("n-button"),_=m("n-input"),y=m("close-outline"),N=m("n-icon"),I=m("add");return D(),O("div",tn,[h("ul",nn,[(D(!0),O(Re,null,ke(e.propPlaces,(v,f)=>(D(),O("li",{class:"place",key:f},[f>0?(D(),O("div",sn,[o(g,{class:"editPlaceDivider"}),v.travelTime!==void 0?(D(),O("div",an,[ln,o(b,{placeholder:"Travel time (in minutes)",type:"text",min:0,value:v.travelTime.timeInMinutes,"onUpdate:value":p=>v.travelTime.timeInMinutes=p},{suffix:w(()=>[on]),_:2},1032,["value","onUpdate:value"])])):(D(),ae(c,{key:1,class:"setTravelTime",type:"default",onClick:p=>e.setTravelTime(f)},{default:w(()=>[rn]),_:2},1032,["onClick"])),o(g,{class:"editPlaceDivider"})])):Oe("",!0),h("div",{class:Se(["editPlace","place"+f])},[o(_,{class:"inputPlaceLink",value:v.place.URL,"onUpdate:value":p=>v.place.URL=p,type:"text",disabled:e.parsing[f],placeholder:"Link"+(f!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","disabled","placeholder"]),o(c,{class:"inputPlaceLinkParse",type:"default",disabled:v.place.URL.length===0||e.parsing[f],loading:e.parsing[f],onClick:p=>e.parse(f)},{default:w(()=>[dn]),_:2},1032,["disabled","loading","onClick"]),o(_,{class:"inputPlaceLabel",value:v.place.label,"onUpdate:value":p=>v.place.label=p,type:"text",disabled:e.parsing[f],placeholder:"Place Name"+(f!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","disabled","placeholder"]),un,o(_,{class:"inputPlaceDesc",value:v.place.description,"onUpdate:value":p=>v.place.description=p,type:"textarea",disabled:e.parsing[f],placeholder:f!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","disabled","placeholder"]),o(c,{class:"removePlace wide_button",type:"error",secondary:"",onClick:p=>e.removePlace(f)},{default:w(()=>[o(N,null,{default:w(()=>[o(y)]),_:1}),cn]),_:2},1032,["onClick"])],2)]))),128))]),o(g,{class:"editPlaceDivider"}),o(c,{class:"addPlace wide_button",onClick:e.pushPlace},{default:w(()=>[o(N,null,{default:w(()=>[o(I)]),_:1}),pn]),_:1},8,["onClick"])])}const Ue=ie(en,[["render",fn],["__scopeId","data-v-6ef07bd7"]]),hn=M({components:{Add:Ve,CEditPlaces:Ue,CloseOutline:Ae,NButton:se,NCard:bt,NIcon:Ie},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new me(e))},methods:{pushDay(){const e=new me(new It({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);const t={};for(const r of this.$data.days)t[r.dayOf]=r;const s=this.$data.days.length;this.$data.days=[];let i=0;for(let r=0;r<s;r++){let u=t[r+i];for(;u==null&&r+i<s+5;)i++,u=t[r+i];u.dayOf=r+1,this.$data.days.push(u)}}}}),mn={class:"edit_days narrow_content"},vn={class:"editDayCardContent"},gn={class:"editDayTitle"},_n=S("Delete this day"),yn=S("Add another day");function wn(e,t,s,i,r,u){const g=m("close-outline"),b=m("n-icon"),c=m("n-button"),_=m("CEditPlaces"),y=m("n-card"),N=m("add");return D(),O("div",mn,[(D(!0),O(Re,null,ke(e.days,(I,v)=>(D(),ae(y,{class:Se(["editDay","day"+I.dayOf]),key:I.dayOf,hoverable:"","content-style":"padding: 0"},{default:w(()=>[h("div",vn,[h("div",gn,[h("b",null,"Day "+Ct(I.dayOf),1),o(c,{class:"removeDay right_button",secondary:"",type:"error",onClick:f=>e.removeDay(v)},{default:w(()=>[o(b,null,{default:w(()=>[o(g)]),_:1}),_n]),_:2},1032,["onClick"])]),o(_,{class:"editPlaces",ref_for:!0,ref:"places"+v,propPlaces:I.propPlaces,"onUpdate:propPlaces":f=>I.propPlaces=f},null,8,["propPlaces","onUpdate:propPlaces"])])]),_:2},1032,["class"]))),128)),o(c,{class:"addDay right_button",onClick:t[0]||(t[0]=I=>e.pushDay())},{default:w(()=>[o(b,null,{default:w(()=>[o(N)]),_:1}),yn]),_:1})])}const bn=ie(hn,[["render",wn],["__scopeId","data-v-964eaa4e"]]);class Cn{constructor(t,s){R(this,"type");R(this,"label");R(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}class J extends Vt{static fromJSON(t){return new J(t)}getObjImpl(t){return new le(JSON.parse(t))}}class Te extends At{}class Le extends St{constructor(){super(...arguments);R(this,"storage",Mt.TRIP);R(this,"storeCount",10)}async genFetch(s){const i=await Ee(s);return Pt.isPWA()?i.ID!==-1?(this.storeObj(Te,J,i.ID.toString(),Me.stringify(i,!0)),i):null:i}static genObj(s){return new Le().genObjImpl(Te,J,s)}}async function Ee(e){const t=await j.genGET("v2/trip/"+e);return new le(t)}const $n=3,Dn=M({components:{NButton:se,NSelect:Bt,NSwitch:$t,CEditDays:bn,CEditItem:kt,CEditPlaces:Ue},props:{trip:{type:le,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],cityLoading:!1,parsedCities:[],parsedCitiesMap:new Map,possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return ee},descriptionRowMinCount(){return $n}},async beforeMount(){G.init(),this.update(),await this.searchCity("")},mounted(){A.get(A.get(this,"name"),"input").focus()},methods:{cancel(){var e;A.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){const e=new Rt;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0;const t=[];for(const b of this.$data.cities){const c=this.$data.parsedCitiesMap.get(b);if(c!==void 0)t.push(c);else{const _=new ye;_.ID=+b,t.push(_)}}e.cities=t;const s=A.getVal(this,"name"),i=Ce(A.getVal(this,"description"));if(!this.checkValidNameDescription(s,i)){this.$data.saving=!1;return}e.name=s,e.description=i,e.days=[];const u=A.get(this,"days");let g=0;for(const b in u.days){const c=u.days[b].toDay(),_=this.filterPlaces(c.places);if(_===null){G.dialogError({title:"Invalid Link",content:"We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.",positiveText:"OK"}),this.$data.saving=!1;return}_.length>0?(c.places=_,c.dayOf=c.dayOf-g,e.days.push(c)):g++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){const t=[];for(const s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=Ce(s.description.valueOf()),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},confirmDelete(){G.dialogWarning({title:"Delete trip",content:"Are you sure you want to delete this trip? THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.del()},onNegativeClick:async()=>{}})},async del(){this.$data.deleting=!0;let e=Boolean(await j.genDELETE("v2/trip/"+this.$props.trip.ID,Me.stringify(this.$props.trip)));e||(e=(await Ee(this.$props.trip.ID.toString())).ID===-1),this.$data.deleting=!1,G.notifyTrigger("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?be.SUCCESS:be.ERROR),e&&Dt.genRedirectTo(Tt.Landing)},tripToItem(e){return new Cn(e,this.$props.trip[e])},update(){const e=[];for(const t of this.$props.trip.details.cities)e.push(t.ID.toString());this.$data.cities=e;for(const t of this.$props.trip.details.cities)this.$data.parsedCitiesMap.set(t.ID.toString(),t),this.$data.parsedCities.push(t);this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<Ot?(this.showAlert("Trip name is too short."),!1):e.length>we?(this.showAlert(`Trip name cannot be longer than ${we}.`),!1):!t||t.length>ee?(this.showAlert(`Trip description cannot be longer than ${ee}.`),!1):!0},showAlert(e){G.dialogError({title:"Error",content:e,positiveText:"OK"})},async searchCity(e){this.$data.possibleCities=[];const t=[];for(const r of this.$data.parsedCities)this.$data.possibleCities.push({label:r.display.valueOf()+", "+r.iso2.valueOf(),value:r.ID.toString()}),t.push(r.ID.valueOf());this.$data.cityLoading=!0;const s=JSON.stringify(e),i=await j.genPOST("cities",s);if(i===null){this.$data.cityLoading=!1;return}for(const r of i){const u=new ye(r);this.$data.parsedCitiesMap.set(u.ID.toString(),u),t.includes(u.ID.valueOf())||this.$data.possibleCities.push({label:u.display.valueOf()+", "+u.iso2.valueOf(),value:u.ID.toString()})}this.$data.cityLoading=!1},onSelect(e){for(const t of e){let s=!0;for(const i of this.$data.parsedCities)i.ID.toString()===t&&(s=!1);if(s){const i=this.$data.parsedCitiesMap.get(t);i!==void 0&&this.$data.parsedCities.push(i)}}}}}),Tn={class:"edit_trip"},Nn={class:"edit_form"},In={class:"narrow_content"},Rn={class:"editTripPrivacy"},kn=h("span",{class:"editLabel"},"Private:",-1),On={class:"editInput"},Sn={class:"editCity"},Mn=h("span",{class:"editLabel"},"Cities:",-1),Pn={class:"confirmationButtons narrow_content"},Vn=S("Save"),An=S("Cancel"),Bn=S("Delete");function Un(e,t,s,i,r,u){const g=m("CEditItem"),b=m("n-switch"),c=m("n-select"),_=m("CEditDays"),y=m("n-button");return D(),O("div",Tn,[h("form",Nn,[h("div",In,[o(g,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),o(g,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),h("div",Rn,[kn,h("div",On,[o(b,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=N=>e.private=N)},null,8,["value"])])]),h("div",Sn,[Mn,o(c,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=N=>e.cities=N),options:e.possibleCities,loading:e.cityLoading,filterable:"",multiple:"",placeholder:"",onSearch:e.searchCity,onUpdateValue:e.onSelect},null,8,["value","options","loading","onSearch","onUpdateValue"])])]),o(_,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),h("div",Pn,[o(y,{class:"saveEditTrip left_col",type:"info",onClick:e.save,loading:e.saving},{default:w(()=>[Vn]),_:1},8,["onClick","loading"]),o(y,{class:"cancelEditTrip right_col",type:"default",onClick:e.cancel},{default:w(()=>[An]),_:1},8,["onClick"]),e.isNew?Oe("",!0):(D(),ae(y,{key:0,class:"deleteTrip right_col",onClick:e.confirmDelete,type:"error",loading:e.deleting},{default:w(()=>[Bn]),_:1},8,["onClick","loading"]))])])])}const jn=ie(Dn,[["render",Un]]);export{jn as C,Le as T};
