var X=Object.defineProperty;var Z=(e,t,s)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var k=(e,t,s)=>Z(e,typeof t!="symbol"?t+"":t,s);import{C as x,E as T}from"./CEditItem-CkORRj5K.js";import{C as ee}from"./CHead-DB__Oa_T.js";import{C as te}from"./CLink-BZ5D-za9.js";import{C as H,a as se}from"./CLoadingTripPreviewCard-UzNnqP2X.js";import{d as R,l as q,m as ae,c as o,a,b as u,r,F as P,g as N,o as i,_ as A,B as J,N as M,H as g,e as f,R as y,q as c,t as L,i as E,f as d,h as p,j as D,G as b}from"./index-CVwEz7sZ.js";import{N as ie,a as ne}from"./CPlaces-DBdQOhbq.js";import{C as re}from"./CShare-BGpHMHTP.js";import{a as oe}from"./TripUtil-DgNcC7ap.js";import{U}from"./UserObj-C4SvK9zP.js";import{N as m}from"./NaiveUtils-CaBEIltk.js";import{U as le}from"./TripObj-B2zgwhZc.js";import{C as K,P as Y,F as z,a as Q,p as de,s as ue}from"./UserUtil-BfIc5bHd.js";import"./Input-B0b2FwEY.js";import"./DataProps-DCopCXR4.js";const ce=R({name:"CLoadingViewUser",components:{NCard:ae,NDivider:q,NSkeleton:ie,CLoadingTripPreviewCard:H}}),pe={class:"loading_view_user"},me={class:"narrow_content"};function fe(e,t,s,n,l,F){const h=r("n-skeleton"),v=r("n-divider"),w=r("CLoadingTripPreviewCard");return i(),o("div",pe,[a(h,{class:"loading_user_name",height:"40px",width:"100px"}),u("div",me,[a(h,{text:"",repeat:5})]),a(v),t[0]||(t[0]=u("h2",null,"Trips",-1)),(i(),o(P,null,N(5,$=>a(w,{key:$,wide:!0,"limit-height":!1})),64))])}const ge=A(ce,[["render",fe],["__scopeId","data-v-0521177c"]]),he=R({name:"CViewUser",components:{CExternalLink:ne,CShare:re,CTripPreviewCard:se,NAlert:M,NButton:J,NDivider:q,CLoadingTripPreviewCard:H},props:{user:{type:U,required:!0},showName:{type:Boolean,default:!0},self:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1}},emits:{logout(){return!0},toggleEdit(){return!0}},data:()=>({trips:[],tripsEmpty:!0,loading:!0,shareURL:""}),async beforeMount(){await this.genPopulateTrips()},async beforeUpdate(){await this.genPopulateTrips()},methods:{async genPopulateTrips(){this.$data.loading=!0,this.$data.trips=this.$props.user.trips,oe(this.$data.trips),this.$data.tripsEmpty=this.$data.trips.length<=0,this.$data.loading=!1},logout(){this.$emit("logout")},toggleEdit(){this.$emit("toggleEdit")},async newTrip(){await y.genRedirectTo(f.trip_New)},onShare(){let e=this.$props.user.details.username.valueOf();e===""&&(e=this.$props.user.details.ID.toString()),this.$data.shareURL=g.getAbsoluteURL(f.User,e)}}}),ve={class:"view_user"},we={class:"userInfo narrow_content"},Ce={key:0},ye={class:"username left_col"},$e={key:1,class:"userBio"},_e={class:"externalLink"},ke={key:2,class:"userInfoButtonGroups"},Te={key:0,class:"viewUserTrips"},be={key:2,class:"createTripAlertDiv"};function Ee(e,t,s,n,l,F){const h=r("CExternalLink"),v=r("CShare"),w=r("n-button"),$=r("n-divider"),I=r("CLoadingTripPreviewCard"),C=r("CTripPreviewCard"),_=r("n-alert");return i(),o("div",ve,[u("div",we,[e.user.details.username!==""?(i(),o("h3",Ce,[u("code",ye,"@"+L(e.user.details.username),1)])):c("",!0),e.user.details.bio!==""?(i(),o("p",$e,L(e.user.details.bio),1)):c("",!0),u("div",_e,[e.user.details.link!==""?(i(),E(h,{key:0,underline:"hover",url:e.user.details.link.valueOf()},{default:d(()=>[p(L(e.user.details.link),1)]),_:1},8,["url"])):c("",!0)]),e.self?(i(),o("div",ke,[a(v,{class:"left_col",shareURL:e.shareURL,onClick:e.onShare},null,8,["shareURL","onClick"]),a(w,{class:"myAccountEdit right_col",type:"default",ref:"edit",onClick:e.toggleEdit},{default:d(()=>t[0]||(t[0]=[p("Edit")])),_:1},8,["onClick"])])):c("",!0)]),a($,{class:"viewUserDivider"}),e.loading||e.self||!e.tripsEmpty?(i(),o("div",Te,[t[3]||(t[3]=u("h2",null,"Trips",-1)),e.loading?(i(),o(P,{key:0},N(5,B=>a(I,{key:B,wide:!0,"limit-height":!1})),64)):(i(!0),o(P,{key:1},N(e.trips,B=>(i(),E(C,{trip:B,wide:!0,"limit-height":!1},null,8,["trip"]))),256)),e.self&&e.tripsEmpty?(i(),o("div",be,[a(_,{class:"createTripAlert",type:"default","show-icon":!1},{default:d(()=>[t[2]||(t[2]=p("Seems like you have not shared any of your own trips.")),e.confirmed?(i(),E(w,{key:0,class:"createTripButton",type:"info",onClick:e.newTrip,size:"large"},{default:d(()=>t[1]||(t[1]=[p("Create New Trip")])),_:1},8,["onClick"])):c("",!0)]),_:1})])):c("",!0)])):c("",!0)])}const Ue=A(he,[["render",Ee],["__scopeId","data-v-b2a08393"]]);class O extends Q{static fromJSON(t){return new O(t)}getObjImpl(t){return new U(JSON.parse(t))}}class G extends z{}class V extends K{constructor(){super(...arguments);k(this,"storage","user");k(this,"storeCount",10)}async genFetch(s){const n=await g.genGET("username/"+s),l=new U(n);return Y.isPWA()?n!==""?(this.storeObj(G,O,l.details.username.valueOf(),D.WingsStructUtil.stringify(l,!0)),l):null:l}static genObj(s){return new V().genObjImpl(G,O,s)}}class S extends Q{static fromJSON(t){return new S(t)}getObjImpl(t){return this.obj}}class W extends z{}class j extends K{constructor(){super(...arguments);k(this,"storage","username");k(this,"storeCount",20)}async genFetch(s){const n=await g.genGET("v2/username/"+s);return Y.isPWA()?n!==""?(this.storeObj(W,S,n,s),n):null:n}static genObj(s){return new j().genObjImpl(W,S,s)}}const Le=R({components:{CEditItem:x,CHead:ee,CLink:te,CLoadingViewUser:ge,CViewUser:Ue,NAlert:M,NButton:J},data:()=>({user:new U,edit:!1,self:!1,unconfirmedLink:f.unconfirmed_Email,updated:null,loadingBar:b.loadingBar()}),async beforeMount(){await this.init()},methods:{async init(){m.init();const e=b.paramID();if(e===void 0){await y.genRedirectTo(f.NotFound);return}if(isNaN(Number(e))){const t=await V.genObj(e);if(t.completed!==null&&(this.$data.user=t.completed,this.dataProcessing(t.fromStorage)),t.promise!==null){const s=await t.promise;s!==null&&!ue(s,this.$data.user)&&(this.$data.user=s,this.dataProcessing(!1))}}else{const s=(await j.genObj(e)).completed;if(s!==null&&s!=="")return await y.genRedirectTo(f.User+"/"+s),await this.init();{const n=await g.genGET("v2/user/"+e);n!==null&&(this.$data.user=new U(n))}}this.$data.user.ID===-1&&(b.paramID()===b.getCurrentUsername()&&await this.logout(),m.dialogError({title:"User not found",content:"The user you are looking for does not exist.",positiveText:"OK",onPositiveClick:async()=>{await y.genRedirectTo(f.Landing)}}))},dataProcessing(e){this.$data.user.ID!==-1&&(this.$data.self=b.getIsCurrentUser(this.$data.user.ID.valueOf()),e?this.$data.user.details.bio=this.$data.user.details.bio.valueOf():this.$data.user.details.bio=this.$data.user.details.bio.valueOf())},update(){this.$data.updated!==null&&(this.$data.user=this.$data.updated,this.dataProcessing(!1)),this.$data.updated=null},confirmDelete(){m.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var t,s,n;(t=this.$data.loadingBar)==null||t.start(),await g.genDELETE("v2/user/"+this.$data.user.ID,D.WingsStructUtil.stringify(this.$data.user.details))?(localStorage.clear(),(s=this.$data.loadingBar)==null||s.finish(),m.messageInfo("Your account is now deleted."),await y.genRedirectTo(f.Landing)):((n=this.$data.loadingBar)==null||n.error(),m.messageError("Account deletion attempt failed."))},async save(){var s,n,l;(s=this.$data.loadingBar)==null||s.start();const e=new le({id:this.$data.user.ID,name:T.getVal(this,"name"),email:T.getVal(this,"email"),bio:de(T.getVal(this,"bio")),link:T.getVal(this,"link"),username:T.getVal(this,"username"),confirmed:this.$data.user.details.confirmed});await g.genPOST("v2/user/"+this.$data.user.ID,D.WingsStructUtil.stringify(e))!==!1?(this.toggleEdit(),(n=this.$data.loadingBar)==null||n.finish(),m.messageSuccess("Profile updated successfully!"),await this.init()):((l=this.$data.loadingBar)==null||l.error(),m.dialogError({title:"Fail",content:"Save was unsuccessful. Please try again later.",positiveText:"OK"}))},async logout(){await g.genGET("logout"),localStorage.clear(),m.messageSuccess("You are now logged out."),await y.genRedirectTo(f.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}}),Oe={class:"get_user"},Se={key:0,class:"narrow_content accountUnconfirmedAlertBar"},Ie={key:1,class:"narrow_content tapToUpdate"},Be={key:3,class:"userinfo"},Pe={class:"title"},Ne={class:"profile_info"},De={key:1,class:"narrow_content"},Re={class:"myAccountButtonGroups"},Ae={class:"myAccountDeletion"};function Ve(e,t,s,n,l,F){const h=r("CHead"),v=r("n-alert"),w=r("CLink"),$=r("CLoadingViewUser"),I=r("CViewUser"),C=r("CEditItem"),_=r("n-button");return i(),o("div",Oe,[a(h,{title:e.user.details.name.valueOf(),description:e.user.details.bio.valueOf(),type:"profile"},null,8,["title","description"]),e.self&&!e.user.details.confirmed?(i(),o("div",Se,[a(w,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:d(()=>[a(v,{title:"Unconfirmed",type:"error"},{default:d(()=>t[0]||(t[0]=[p("Please confirm you email address to access the full site.")])),_:1})]),_:1},8,["url"])])):c("",!0),e.updated!==null?(i(),o("div",Ie,[a(v,{title:"There's an update!",type:"warning",onClick:e.update},{default:d(()=>t[1]||(t[1]=[p("Press here to view latest version of this profile.")])),_:1},8,["onClick"])])):c("",!0),e.user.ID===-1?(i(),E($,{key:2})):(i(),o("div",Be,[u("h1",Pe,L(e.user.details.name),1),u("div",Ne,[e.edit?(i(),o("div",De,[a(C,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),a(C,{label:"Username",ref:"username",val:e.user.details.username.valueOf(),placeholder:"Set a username"},null,8,["val"]),a(C,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),a(C,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),u("div",Re,[a(_,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:d(()=>t[2]||(t[2]=[p("Save")])),_:1},8,["onClick"]),a(_,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:d(()=>t[3]||(t[3]=[p("Cancel")])),_:1},8,["onClick"])]),u("div",Ae,[a(_,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:d(()=>t[4]||(t[4]=[p("Delete Account")])),_:1},8,["onClick"])])])):(i(),E(I,{key:0,user:e.user,showName:!1,self:e.self,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","self","onLogout","onToggleEdit"]))])]))])}const et=A(Le,[["render",Ve],["__scopeId","data-v-fb8ebffc"]]);export{et as default};
