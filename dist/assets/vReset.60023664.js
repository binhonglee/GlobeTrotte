import{C,E as a}from"./E.3f827e06.js";import{C as y}from"./CLink.ee7e2d36.js";import{r as m,o as p,c as u,a as t,f as P,w as n,e as c,p as v,b as k,i,_ as E,d as R,N as $,k as f,R as r,j as _,aX as h}from"./index.19e11df1.js";import"./Input.19065b66.js";class N{constructor(s){this.email="",this.code="",this.password="",s&&(this.email=s.email!==void 0&&s.email!==null?s.email:"",this.code=s.code!==void 0&&s.code!==null?s.code:"",this.password=s.password!==void 0&&s.password!==null?s.password:"")}toJsonKey(s){switch(s){case"email":return"email";case"code":return"code";case"password":return"password";default:return s}}}const w=e=>(v("data-v-48aacec7"),e=e(),k(),e),V={class:"password_reset narrow_content"},I=w(()=>c("h1",{class:"title"},"Reset Password",-1)),L={key:0,class:"resetPasswordStart narrow_display_window"},S=w(()=>c("br",null,null,-1)),T=i("Confirm"),B=i("Cancel"),K={class:"backToLogin"},b=i("Back to Login"),M={key:1,class:"resetPasswordInput narrow_display_window"},O=w(()=>c("br",null,null,-1)),q=i("Confirm"),A=i("Cancel");function F(e,s,d,J,U,W){const o=m("CEditItem"),l=m("n-button"),g=m("CLink");return p(),u("div",V,[I,e.step<2?(p(),u("form",L,[t(o,{className:"emailInput",label:"Email",ref:"email",val:e.email,onKeydown:P(e.confirmEmail,["enter","native"])},null,8,["val","onKeydown"]),S,t(l,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmEmail,loading:e.loading},{default:n(()=>[T]),_:1},8,["onClick","loading"]),t(l,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:n(()=>[B]),_:1},8,["onClick"]),c("p",K,[t(g,{url:e.loginLink},{default:n(()=>[b]),_:1},8,["url"])])])):(p(),u("form",M,[t(o,{className:"resetEmail",label:"Email",ref:"email",val:e.email,onEnter:e.confirmReset},null,8,["val","onEnter"]),t(o,{className:"resetCode",label:"Code",ref:"code",onEnter:e.confirmReset},null,8,["onEnter"]),t(o,{className:"resetPassword",label:"Password",ref:"password",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),t(o,{className:"resetConfPassword",label:"Confirm Password",ref:"confPassword",type:"password",onEnter:e.confirmReset},null,8,["onEnter"]),O,t(l,{class:"resetPasswordSave left_col",type:"info",onClick:e.confirmReset,loading:e.loading},{default:n(()=>[q]),_:1},8,["onClick","loading"]),t(l,{class:"resetPasswordCancel right_col",type:"default",onClick:e.cancel},{default:n(()=>[A]),_:1},8,["onClick"])]))])}const H=R({components:{CEditItem:C,CLink:y,NButton:$},data:()=>({email:"",step:0,loginLink:f.Login,loading:!1}),async mounted(){this.$data.step<2?a.get(a.get(this,"email"),"input").focus():a.get(a.get(this,"code"),"input").focus()},async beforeMount(){var s,d;const e=r.getParamMap();this.$data.email=(s=e.get("email"))!=null?s:"",this.$data.step=+((d=e.get("step"))!=null?d:"")},methods:{async confirmEmail(){await _.genPOST("reset/send_email",h.stringify(a.getVal(this,"email")))?(this.$message({type:"success",message:"Password reset code sent!"}),await r.genRefreshRedirect(f.password_Reset,new Map(Object.entries({email:a.getVal(this,"email"),step:"2"})))):this.$message({type:"error",message:"Account not found with email."})},async confirmReset(){if(a.getVal(this,"password").localeCompare(a.getVal(this,"confPassword"))){this.$alert("Password does not match.","Fail",{confirmButtonText:"OK"}),this.$data.loading=!1;return}const e=new N;e.email=a.getVal(this,"email"),e.code=a.getVal(this,"code"),e.password=a.getVal(this,"password"),await _.genPOST("reset/password",h.stringify(e))?(this.$message({type:"success",message:"Password reset is successful."}),await r.genRedirectTo(f.Login)):this.$message({type:"error",message:"Password reset attempt failed."})},async cancel(){await r.paramToNext()}}});var Q=E(H,[["render",F],["__scopeId","data-v-48aacec7"]]);export{Q as default};
