import{C as se,E as T}from"./CEditItem.1a5c6f9b.js";import{C as ie}from"./CHead.697158f6.js";import{C as ne}from"./CLink.dc4255c8.js";import{a as W,C as oe}from"./CLoadingTripPreviewCard.8bf5570a.js";import{r as n,o as s,c as r,a as i,e as u,F as A,g as B,p as M,b as q,d as P,m as re,q as J,_ as R,t as U,l as d,h as w,w as l,i as c,a_ as z,N as K,b8 as L,R as v,k as f,j as y,aV as D,G as b,b9 as le}from"./index.ddc3f2ba.js";import{N as de,a as ce}from"./CPlaces.9dd276b2.js";import{C as ue}from"./CShare.b1f63e0b.js";import{a as pe}from"./TripUtil.eb3ebdea.js";import{N as p}from"./NaiveUtils.f474adff.js";import{C as Y,F as Q,a as X,b as Z,P as ee}from"./CacheStorage.3773b082.js";import"./Input.08a00163.js";import"./DataProps.7f2e17ac.js";const fe=e=>(M("data-v-6cc9822f"),e=e(),q(),e),me={class:"loading_view_user"},he={class:"narrow_content"},ge=fe(()=>u("h2",null,"Trips",-1));function _e(e,t,a,o,C,F){const g=n("n-skeleton"),_=n("n-divider"),m=n("CLoadingTripPreviewCard");return s(),r("div",me,[i(g,{class:"loading_user_name",height:"40px",width:"100px"}),u("div",he,[i(g,{text:"",repeat:5})]),i(_),ge,(s(),r(A,null,B(5,$=>i(m,{key:$,wide:!0,"limit-height":!1})),64))])}const ve=P({name:"CLoadingViewUser",components:{NCard:re,NDivider:J,NSkeleton:de,CLoadingTripPreviewCard:W}});var we=R(ve,[["render",_e],["__scopeId","data-v-6cc9822f"]]);const ye=e=>(M("data-v-534c6cae"),e=e(),q(),e),Ce={class:"view_user"},$e={class:"userInfo narrow_content"},ke={key:0,class:"userName left_col"},Te={key:1,class:"userBio"},be={class:"externalLink"},Ue={key:3,class:"userInfoButtonGroups"},Ee=c("Logout"),Se=c("Edit"),Le={key:0,class:"viewUserTrips"},Ie=ye(()=>u("h2",null,"Trips",-1)),Oe={key:2,class:"createTripAlertDiv"},Ae=c("Seems like you have not shared any of your own trips."),Be=c("Create New Trip");function De(e,t,a,o,C,F){const g=n("CExternalLink"),_=n("CShare"),m=n("n-button"),$=n("n-divider"),I=n("CLoadingTripPreviewCard"),h=n("CTripPreviewCard"),k=n("n-alert");return s(),r("div",Ce,[u("div",$e,[e.showName?(s(),r("h2",ke,U(e.user.details.name),1)):d("",!0),e.user.details.bio!==""?(s(),r("p",Te,U(e.user.details.bio),1)):d("",!0),u("div",be,[e.user.details.link!==""?(s(),w(g,{key:0,underline:"hover",url:e.user.details.link.valueOf()},{default:l(()=>[c(U(e.user.details.link),1)]),_:1},8,["url"])):d("",!0)]),e.self?(s(),w(_,{key:2,shareURL:e.shareURL,onClick:e.onShare},null,8,["shareURL","onClick"])):d("",!0),e.self?(s(),r("div",Ue,[i(m,{class:"myAccountLogout left_col",type:"error",onClick:e.logout},{default:l(()=>[Ee]),_:1},8,["onClick"]),i(m,{class:"myAccountEdit right_col",type:"default",ref:"edit",onClick:e.toggleEdit},{default:l(()=>[Se]),_:1},8,["onClick"])])):d("",!0)]),i($,{class:"viewUserDivider"}),e.loading||e.self||!e.tripsEmpty?(s(),r("div",Le,[Ie,e.loading?(s(),r(A,{key:0},B(5,O=>i(I,{key:O,wide:!0,"limit-height":!1})),64)):(s(!0),r(A,{key:1},B(e.trips,O=>(s(),w(h,{trip:O,wide:!0,"limit-height":!1},null,8,["trip"]))),256)),e.self&&e.tripsEmpty?(s(),r("div",Oe,[i(k,{class:"createTripAlert",type:"default","show-icon":!1},{default:l(()=>[Ae,e.confirmed?(s(),w(m,{key:0,class:"createTripButton",type:"info",onClick:e.newTrip,size:"large"},{default:l(()=>[Be]),_:1},8,["onClick"])):d("",!0)]),_:1})])):d("",!0)])):d("",!0)])}const Ne=P({name:"CViewUser",components:{CExternalLink:ce,CShare:ue,CTripPreviewCard:oe,NAlert:z,NButton:K,NDivider:J,CLoadingTripPreviewCard:W},props:{user:{type:L,required:!0},showName:{type:Boolean,default:!0},self:{type:Boolean,default:!1},confirmed:{type:Boolean,default:!1}},emits:{logout(){return!0},toggleEdit(){return!0}},data:()=>({trips:[],tripsEmpty:!0,loading:!0,shareURL:""}),async beforeMount(){await this.genPopulateTrips()},async beforeUpdate(){await this.genPopulateTrips()},methods:{async genPopulateTrips(){this.$data.loading=!0,this.$data.trips=this.$props.user.trips,pe(this.$data.trips),this.$data.tripsEmpty=this.$data.trips.length<=0,this.$data.loading=!1},logout(){this.$emit("logout")},toggleEdit(){this.$emit("toggleEdit")},async newTrip(){await v.genRedirectTo(f.trip_New)},onShare(){let e=this.$props.user.details.username.valueOf();e===""&&(e=this.$props.user.details.ID.toString()),this.$data.shareURL=y.getAbsoluteURL(f.User,e)}}});var Pe=R(Ne,[["render",De],["__scopeId","data-v-534c6cae"]]),N=(e=>(e.Server="server",e.Storage="storage",e))(N||{});function te(e){return e.replaceAll("\\\\n",`
`)}function ae(e){return e.replaceAll("\\n",`
`)}function Re(e){return e.replaceAll("\\t","	").replaceAll("	","").replaceAll(`
`,"\\\\n").replaceAll("\\","\\\\")}function G(e,t){switch(t){case"server":return te(e);case"storage":return ae(e)}}function Ve(e,t,a,o){return e.ID===t.ID&&G(e.details.bio.valueOf(),a)===G(t.details.bio.valueOf(),o)&&e.details.email===t.details.email&&e.details.link===t.details.link&&e.details.name===t.details.name&&e.details.username===t.details.username}class E extends Y{static fromJSON(t){return new E(t)}getObj(){return new L(JSON.parse(this.obj))}}class x extends Q{}class V extends X{constructor(){super(...arguments),this.storage=Z.USER,this.storeCount=10}async genFetch(t){const a=await y.genGET("username/"+t),o=new L(a);return ee.isPWA()?a!==""?(this.storeObj(x,E,D.stringify(o),o.details.username.valueOf()),o):null:o}static genObj(t){return new V().genObjImpl(x,E,t)}}class S extends Y{static fromJSON(t){return new S(t)}getObj(){return this.obj}}class H extends Q{}class j extends X{constructor(){super(...arguments),this.storage=Z.USERNAME,this.storeCount=20}async genFetch(t){const a=await y.genGET("v2/username/"+t);return ee.isPWA()?a!==""?(this.storeObj(H,S,a,t),a):null:a}static genObj(t){return new j().genObjImpl(H,S,t)}}const je={class:"get_user"},Fe={key:0,class:"narrow_content accountUnconfirmedAlertBar"},Ge=c("Please confirm you email address to access the full site."),xe={key:1,class:"narrow_content tapToUpdate"},He=c("Press here to view latest version of this profile."),We={key:3,class:"userinfo"},Me={class:"title"},qe={class:"profile_info"},Je={key:1,class:"narrow_content"},ze={class:"myAccountButtonGroups"},Ke=c("Save"),Ye=c("Cancel"),Qe={class:"myAccountDeletion"},Xe=c("Delete Account");function Ze(e,t,a,o,C,F){const g=n("CHead"),_=n("n-alert"),m=n("CLink"),$=n("CLoadingViewUser"),I=n("CViewUser"),h=n("CEditItem"),k=n("n-button");return s(),r("div",je,[i(g,{title:e.user.details.name.valueOf(),description:e.user.details.bio.valueOf(),type:"profile"},null,8,["title","description"]),e.self&&!e.user.details.confirmed?(s(),r("div",Fe,[i(m,{class:"unconfirmedEmailLink",url:e.unconfirmedLink,underline:"never"},{default:l(()=>[i(_,{title:"Unconfirmed",type:"error"},{default:l(()=>[Ge]),_:1})]),_:1},8,["url"])])):d("",!0),e.updated!==null?(s(),r("div",xe,[i(_,{title:"There's an update!",type:"warning",onClick:e.update},{default:l(()=>[He]),_:1},8,["onClick"])])):d("",!0),e.user.ID===-1?(s(),w($,{key:2})):(s(),r("div",We,[u("h1",Me,U(e.user.details.name),1),u("div",qe,[e.edit?(s(),r("div",Je,[i(h,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),i(h,{label:"Username",ref:"username",val:e.user.details.username.valueOf(),placeholder:"Set a username"},null,8,["val"]),i(h,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),i(h,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),i(h,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),u("div",ze,[i(k,{class:"myAccountSave left_col",type:"info",onClick:e.save},{default:l(()=>[Ke]),_:1},8,["onClick"]),i(k,{class:"myAccountCancel right_col",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:l(()=>[Ye]),_:1},8,["onClick"])]),u("div",Qe,[i(k,{class:"myAccountDelete",type:"error",onClick:e.confirmDelete},{default:l(()=>[Xe]),_:1},8,["onClick"])])])):(s(),w(I,{key:0,user:e.user,showName:!1,self:e.self,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","self","onLogout","onToggleEdit"]))])]))])}const et=P({components:{CEditItem:se,CHead:ie,CLink:ne,CLoadingViewUser:we,CViewUser:Pe,NAlert:z,NButton:K},data:()=>({user:new L,edit:!1,self:!1,unconfirmedLink:f.unconfirmed_Email,updated:null,loadingBar:b.loadingBar()}),async beforeMount(){await this.init()},methods:{async init(){p.init();const e=b.paramID();if(e===void 0){await v.genRedirectTo(f.NotFound);return}if(isNaN(Number(e))){const t=await V.genObj(e);if(t.completed!==null&&(this.$data.user=t.completed,this.dataProcessing(t.fromStorage)),t.promise!==null){const a=await t.promise;a!==null&&!Ve(a,this.$data.user,N.Server,N.Storage)&&(this.$data.updated=a)}}else{const a=(await j.genObj(e)).completed;if(a!==null&&a!=="")return await v.genRedirectTo(f.User+"/"+a),await this.init()}this.$data.user.ID===-1&&(b.paramID()===b.getCurrentUsername()&&await this.logout(),p.dialogError({title:"User not found",content:"The user you are looking for does not exist.",positiveText:"OK",onPositiveClick:async()=>{await v.genRedirectTo(f.Landing)}}))},dataProcessing(e){this.$data.user.ID!==-1&&(this.$data.self=b.getIsCurrentUser(this.$data.user.ID.valueOf()),e?this.$data.user.details.bio=ae(this.$data.user.details.bio.valueOf()):this.$data.user.details.bio=te(this.$data.user.details.bio.valueOf()))},update(){this.$data.updated!==null&&(this.$data.user=this.$data.updated,this.dataProcessing(!1)),this.$data.updated=null},confirmDelete(){p.dialogWarning({title:"Delete account",content:"Are you sure you want to delete this account? All trips owned by this account will also be deleted. THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.deleteAccount()}})},async deleteAccount(){var t,a,o;(t=this.$data.loadingBar)==null||t.start(),await y.genDELETE("v2/user/"+this.$data.user.ID,D.stringify(this.$data.user.details))?(localStorage.clear(),(a=this.$data.loadingBar)==null||a.finish(),p.messageInfo("Your account is now deleted."),await v.genRedirectTo(f.Landing)):((o=this.$data.loadingBar)==null||o.error(),p.messageError("Account deletion attempt failed."))},async save(){var a,o,C;(a=this.$data.loadingBar)==null||a.start();const e=new le({id:this.$data.user.ID,name:T.getVal(this,"name"),email:T.getVal(this,"email"),bio:Re(T.getVal(this,"bio")),link:T.getVal(this,"link"),username:T.getVal(this,"username"),confirmed:this.$data.user.details.confirmed});await y.genPOST("v2/user/"+this.$data.user.ID,D.stringify(e))!==!1?(this.toggleEdit(),(o=this.$data.loadingBar)==null||o.finish(),p.messageSuccess("Profile updated successfully!"),await this.init()):((C=this.$data.loadingBar)==null||C.error(),p.dialogError({title:"Fail",content:"Save was unsuccessful. Please try again later.",positiveText:"OK"}))},async logout(){await y.genGET("logout"),localStorage.clear(),p.messageSuccess("You are now logged out."),await v.genRedirectTo(f.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ft=R(et,[["render",Ze],["__scopeId","data-v-3f310f98"]]);export{ft as default};
