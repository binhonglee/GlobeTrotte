import{C as A,E as i}from"./E.4def98ad.js";import{C as b}from"./CViewUser.88e40a57.js";import{_ as B,U as T,a as c,G as g,R as h,H as _,c as U}from"./index.b45d7991.js";import{r as n,G as V,o,d as p,H as D,f as y,w as d,i as u,e as t,g as L,h as v,j,W as $}from"./vendor.b76afd09.js";import"./CPlaces.2c2e8c9b.js";import"./CTripPreviewCard.fc0e3c00.js";import"./CityUtil.668632f5.js";const I={class:"my_account"},O=u("h1",{class:"title"},"My Account",-1),P={class:"profileInfo"},R={key:0},S={key:1,class:"narrow_content"},G={class:"myAccountButtonGroups"},N=v("Save"),H=v("Cancel"),M={class:"myAccountDeletion"},W=v("Delete Account");function q(e,l,a,s,f,K){const C=n("el-alert"),k=n("el-link"),w=n("CViewUser"),r=n("CEditItem"),m=n("el-button"),E=V("loading");return o(),p("div",I,[O,D((o(),y(k,{class:"unconfirmedEmailLink",href:e.unconfirmedLink,underline:!1},{default:d(()=>[e.confirmed?L("",!0):(o(),y(C,{key:0,class:"narrow_content accountUnconfirmedAlertBar",title:"Unconfirmed",description:"Please confirm you email address to access the full site.",type:"error",closable:!1,"show-icon":""}))]),_:1},8,["href"])),[[E,e.loading,void 0,{fullscreen:!0,lock:!0}]]),u("div",P,[e.edit?(o(),p("div",S,[t(r,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(r,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(r,{label:"Link",ref:"link",val:e.user.details.link.valueOf()},null,8,["val"]),t(r,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf(),"row-min-count":3,"val-max-count":1e3},null,8,["val"]),u("div",G,[t(m,{class:"myAccountSave",type:"primary",onClick:e.save},{default:d(()=>[N]),_:1},8,["onClick"]),t(m,{class:"myAccountCancel",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:d(()=>[H]),_:1},8,["onClick"])]),u("div",M,[t(m,{class:"myAccountDelete",type:"danger",onClick:e.deleteAccount},{default:d(()=>[W]),_:1},8,["onClick"])])])):(o(),p("div",R,[t(w,{user:e.user,self:!0,onLogout:e.logout,onToggleEdit:e.toggleEdit},null,8,["user","onLogout","onToggleEdit"])]))])])}const F=j({components:{CEditItem:A,CViewUser:b},data(){return{user:new T,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:c.unconfirmed_Email,loadingBar:g.loadingBar()}},mounted(){this.init(),this.$data.edit&&i.get(i.get(this,"name"),"input").focus()},methods:{async init(){this.$data.loading=!0,this.$data.user=await g.genCurrentUser(),this.$data.user.details.bio=this.$data.user.details.bio.replaceAll("\\n",`
`),this.$data.user.ID===-1&&await h.genRedirectTo(c.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf(),this.$data.loading=!1},async deleteAccount(){var l,a,s;(l=this.$data.loadingBar)==null||l.start(),await _.genDELETE("v2/user/"+this.$data.user.ID,$.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(g.notifConfig("Deleted","Your account is now deleted.","info")),(a=this.$data.loadingBar)==null||a.finish(),await h.genRedirectTo(c.Landing)):((s=this.$data.loadingBar)==null||s.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){var a,s,f;(a=this.$data.loadingBar)==null||a.start();const e=new U({id:this.$data.user.ID,name:i.getVal(this,"name"),email:i.getVal(this,"email"),bio:i.getVal(this,"bio").replaceAll("\\t","	").replaceAll("	","").replaceAll(`
`,"\\\\n").replaceAll("\\","\\\\"),link:i.getVal(this,"link"),confirmed:this.$data.user.details.confirmed});await _.genPOST("v2/user/"+this.$data.user.ID,$.stringify(e))!==!1?(this.toggleEdit(),(s=this.$data.loadingBar)==null||s.finish(),this.$message({message:"Profile updated successfully!",type:"success"}),this.init()):((f=this.$data.loadingBar)==null||f.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await _.genGET("logout"),localStorage.clear(),await h.genRedirectTo(c.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}}});var ee=B(F,[["render",q]]);export{ee as default};
