var W=Object.defineProperty;var q=(e,t,s)=>t in e?W(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var b=(e,t,s)=>(q(e,typeof t!="symbol"?t+"":t,s),s);import{P as O,a as z,D as U,C as P}from"./DataProps.995a53a3.js";import{j as T,o as r,f as k,e as a,r as i,d as $,i as o,F as R,v as A,w as l,g as L,A as M,h as m,x as N,D as F,L as B,y as K,M as X,B as Y,C as J,z as Q,O as Z,W as ee}from"./vendor.7e867dc2.js";import{_ as E,D as te,T as se,c as ae,H as ie,G as j,R as ne,a as oe}from"./index.2e1f3478.js";import{C as le,D as I,E as D,N as re,a as S}from"./E.09e9f9c8.js";import{N as V}from"./NaiveUtils.3fc13944.js";const ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},de=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),pe=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1);var x=T({name:"Add",render:function(t,s){return r(),k("svg",ce,[de,pe])}});const ue={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},_e=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),he=a("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1);var H=T({name:"CloseOutline",render:function(t,s){return r(),k("svg",ue,[_e,he])}});const ve={class:"edit_places"},me={class:"places"},fe={key:0,class:"editTravelTime"},ye={key:0,class:"travelTimeInput"},ge=o("div",{class:"travelTimeLabel"},"Travel time",-1),$e=m("minutes"),Ce=m("Set travel time"),we=o("br",null,null,-1),De=m("Delete this place"),Te=m("Add another place");function ke(e,t,s,f,n,u){const h=i("n-divider"),c=i("n-input-number"),d=i("n-button"),C=i("n-input"),w=i("close-outline"),y=i("n-icon"),g=i("add");return r(),$("div",ve,[o("ul",me,[(r(!0),$(R,null,A(e.propPlaces,(p,_)=>(r(),$("li",{class:"place",key:_},[_>0?(r(),$("div",fe,[a(h,{class:"editPlaceDivider"}),p.travelTime!==void 0?(r(),$("div",ye,[ge,a(c,{placeholder:"Travel time (in minutes)",type:"text",min:0,value:p.travelTime.timeInMinutes,"onUpdate:value":v=>p.travelTime.timeInMinutes=v},{suffix:l(()=>[$e]),_:2},1032,["value","onUpdate:value"])])):(r(),k(d,{key:1,class:"setTravelTime",type:"default",onClick:v=>e.setTravelTime(_)},{default:l(()=>[Ce]),_:2},1032,["onClick"])),a(h,{class:"editPlaceDivider"})])):L("",!0),o("div",{class:M(["editPlace","place"+_])},[a(C,{class:"inputPlaceLabel",value:p.place.label,"onUpdate:value":v=>p.place.label=v,type:"text",placeholder:"Place Name"+(_!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","placeholder"]),a(C,{class:"inputPlaceLink",value:p.place.URL,"onUpdate:value":v=>p.place.URL=v,type:"text",placeholder:"Link"+(_!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","placeholder"]),we,a(C,{class:"inputPlaceDesc",value:p.place.description,"onUpdate:value":v=>p.place.description=v,type:"textarea",placeholder:_!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","placeholder"]),a(d,{class:"removePlace wide_button",type:"error",secondary:"",onClick:v=>e.removePlace(_)},{default:l(()=>[a(y,null,{default:l(()=>[a(w)]),_:1}),De]),_:2},1032,["onClick"])],2)]))),128))]),a(h,{class:"editPlaceDivider"}),a(d,{class:"addPlace wide_button",onClick:e.pushPlace},{default:l(()=>[a(y,null,{default:l(()=>[a(g)]),_:1}),Te]),_:1},8,["onClick"])])}const be=T({name:"CEditPlaces",components:{Add:x,CloseOutline:H,NButton:N,NDivider:F,NIcon:B,NInput:K,NInputNumber:X},model:{props:{propPlaces:Array()},emits:["update:propPlaces"]},props:{propPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof O))return!1}),!0):!1}}},methods:{pushPlace(){this.$props.propPlaces.push(new O)},removePlace(e){this.$props.propPlaces.splice(e,1)},setTravelTime(e){const t=new z;t.toPlaceIndex=e,this.$props.propPlaces[e].travelTime=t}}});var G=E(be,[["render",ke]]);const Pe={class:"edit_days narrow_content"},Ne={class:"editDayCardContent"},Ee={class:"editDayTitle"},Ie=m("Delete this day"),Oe=m("Add another day");function Ue(e,t,s,f,n,u){const h=i("close-outline"),c=i("n-icon"),d=i("n-button"),C=i("CEditPlaces"),w=i("n-card"),y=i("add");return r(),$("div",Pe,[(r(!0),$(R,null,A(e.days,(g,p)=>(r(),k(w,{class:M(["editDay","day"+g.dayOf]),key:g.dayOf,hoverable:"","content-style":"padding: 0"},{default:l(()=>[o("div",Ne,[o("div",Ee,[o("b",null,"Day "+Y(g.dayOf),1),a(d,{class:"removeDay right_button",secondary:"",type:"error",onClick:_=>e.removeDay(p)},{default:l(()=>[a(c,null,{default:l(()=>[a(h)]),_:1}),Ie]),_:2},1032,["onClick"])]),a(C,{class:"editPlaces",ref_for:!0,ref:"places"+p,propPlaces:g.propPlaces,"onUpdate:propPlaces":_=>g.propPlaces=_},null,8,["propPlaces","onUpdate:propPlaces"])])]),_:2},1032,["class"]))),128)),a(d,{class:"addDay right_button",onClick:t[0]||(t[0]=g=>e.pushDay())},{default:l(()=>[a(c,null,{default:l(()=>[a(y)]),_:1}),Oe]),_:1})])}const Re=T({components:{Add:x,CEditPlaces:G,CloseOutline:H,NButton:N,NCard:J,NIcon:B},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new U(e))},methods:{pushDay(){let e=new U(new te({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);let t={};for(let n of this.$data.days)t[n.dayOf]=n;const s=this.$data.days.length;this.$data.days=[];let f=0;for(let n=0;n<s;n++){let u=t[n+f];for(;u==null&&n+f<s+5;)f++,u=t[n+f];u.dayOf=n+1,this.$data.days.push(u)}}}});var Ae=E(Re,[["render",Ue],["__scopeId","data-v-3103462c"]]);class Le{constructor(t,s){b(this,"type");b(this,"label");b(this,"value");this.type=t,this.label=this.getLabel(),this.value=s}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}const Me={class:"edit_trip"},Be={class:"edit_form"},je={class:"narrow_content"},Se={class:"editTripPrivacy"},Ve=o("span",{class:"editLabel"},"Private:",-1),xe={class:"editInput"},He={class:"editCity"},Ge=o("span",{class:"editLabel"},"Cities:",-1),We={class:"confirmationButtons narrow_content"},qe=m("Save"),ze=m("Cancel"),Fe=m("Delete");function Ke(e,t,s,f,n,u){const h=i("CEditItem"),c=i("n-switch"),d=i("n-select"),C=i("CEditDays"),w=i("n-button");return r(),$("div",Me,[o("form",Be,[o("div",je,[a(h,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),a(h,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),o("div",Se,[Ve,o("div",xe,[a(c,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=y=>e.private=y)},null,8,["value"])])]),o("div",He,[Ge,a(d,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=y=>e.cities=y),options:e.possibleCities,filterable:"",multiple:"",placeholder:""},null,8,["value","options"])])]),a(C,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),o("div",We,[a(w,{class:"saveEditTrip left_col",type:"info",onClick:e.save,loading:e.saving},{default:l(()=>[qe]),_:1},8,["onClick","loading"]),a(w,{class:"cancelEditTrip right_col",type:"default",onClick:e.cancel},{default:l(()=>[ze]),_:1},8,["onClick"]),e.isNew?L("",!0):(r(),k(w,{key:0,class:"deleteTrip right_col",onClick:e.confirmDelete,type:"error",loading:e.deleting},{default:l(()=>[Fe]),_:1},8,["onClick","loading"]))])])])}const Xe=3,Ye=T({components:{NButton:N,NSelect:Q,NSwitch:Z,CEditDays:Ae,CEditItem:le,CEditPlaces:G},props:{trip:{type:se,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return I},descriptionRowMinCount(){return Xe}},beforeMount(){V.init(),this.update()},mounted(){D.get(D.get(this,"name"),"input").focus()},methods:{cancel(){var e;D.get(this,"days").$data.days=((e=this.$props.trip.details.days)!=null?e:[]).slice(0),this.$emit("cancel")},save(){let e=new ae;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0,e.cities=P.stringToCities(this.$data.cities.join(","));const t=D.getVal(this,"name"),s=D.getVal(this,"description").split(`
`).join(" ");if(!this.checkValidNameDescription(t,s)){this.$data.saving=!1;return}e.name=t,e.description=s,e.days=[];const n=D.get(this,"days");let u=0;for(const h in n.days){const c=n.days[h].toDay(),d=this.filterPlaces(c.places);if(d===null){this.$alert("We currently only support links to limited websites including OpenStreetMap, Google Map, Bing Maps and Yelp.","Invalid Link",{confirmButtonText:"OK"}),this.$data.saving=!1;return}d.length>0?(c.places=d,c.dayOf=c.dayOf-u,e.days.push(c)):u++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){let t=[];for(let s of e)if(s.label=s.label.trim(),s.URL=s.URL.trim(),s.label!=="")if(s.URL===""||this.filterPlace(s))s.description=s.description.split(`
`).join(" "),t.push(s);else return null;return t},filterPlace(e){const t=["https://goo.gl/maps/","https://google.com/maps/","https://www.google.com/maps/","https://maps.google.com/","https://www.openstreetmap.org/way/","https://www.bing.com/maps?","https://www.yelp.com/biz/"];for(const s of t)if(e.URL.startsWith(s))return!0;return!1},confirmDelete(){V.dialogWarning({title:"Delete trip",content:"Are you sure you want to delete this trip? THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.del()},onNegativeClick:async()=>{}})},async del(){this.$data.deleting=!0;let e=Boolean(await ie.genDELETE("v2/trip/"+this.$props.trip.ID,ee.stringify(this.$props.trip)));e||(e=(await j.genTrip(this.$props.trip.ID.valueOf())).ID===-1),this.$data.deleting=!1,this.$notify(j.notifConfig("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?"success":"error")),e&&ne.genRedirectTo(oe.Landing)},tripToItem(e){return new Le(e,this.$props.trip[e])},update(){this.$data.possibleCities=P.sortedCityOptions(),this.$data.cities=P.stringToCityStringArray(this.$props.trip.details.cities.join(",")),this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<re?(this.showAlert("Trip name is too short."),!1):e.length>S?(this.showAlert(`Trip name cannot be longer than ${S}.`),!1):!t||t.length>I?(this.showAlert(`Trip description cannot be longer than ${I}.`),!1):!0},showAlert(e){this.$alert(e,"",{confirmButtonText:"OK"})}}});var at=E(Ye,[["render",Ke]]);export{at as C};
