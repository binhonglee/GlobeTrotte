import{C as k,E as i}from"./E.589345bc.js";import{C as w}from"./CViewUser.fc7e64f0.js";import{_ as E,U as B,a as r,H as u,G as g,R as f,c as b}from"./index.03aec9c1.js";import{r as n,v as A,o as l,d as m,x as D,f as _,w as a,i as s,e as t,g as T,h as c,j as U,u as V,W as h}from"./vendor.ecd2beb5.js";import"./CTripInCarousel.f70c86ce.js";import"./CPlaces.3d57f8be.js";const L={class:"my_account"},I=s("h1",{class:"title"},"My Account",-1),j={class:"profileInfo"},O={key:0},R={class:"narrow_content"},S={class:"myAccountButtonGroups"},P=c("Logout"),G=c("Edit"),N={key:1,class:"narrow_content"},M={class:"myAccountButtonGroups"},H=c("Save"),W=c("Cancel"),q={class:"myAccountDeletion"},F=c("Delete Account");function K(e,p,z,J,Q,X){const v=n("el-alert"),y=n("el-link"),C=n("CViewUser"),o=n("el-button"),d=n("CEditItem"),$=A("loading");return l(),m("div",L,[I,D((l(),_(y,{class:"unconfirmedEmailLink",href:e.unconfirmedLink,underline:!1},{default:a(()=>[e.confirmed?T("",!0):(l(),_(v,{key:0,class:"narrow_content accountUnconfirmedAlertBar",title:"Unconfirmed",description:"Please confirm you email address to access the full site.",type:"error",closable:!1,"show-icon":""}))]),_:1},8,["href"])),[[$,e.loading,void 0,{fullscreen:!0,lock:!0}]]),s("div",j,[e.edit?(l(),m("div",N,[t(d,{label:"Name",ref:"name",val:e.user.details.name.valueOf()},null,8,["val"]),t(d,{label:"Email",ref:"email",val:e.user.details.email.valueOf()},null,8,["val"]),t(d,{label:"Bio",type:"textarea",ref:"bio",val:e.user.details.bio.valueOf()},null,8,["val"]),s("div",M,[t(o,{class:"myAccountSave",type:"primary",onClick:e.save},{default:a(()=>[H]),_:1},8,["onClick"]),t(o,{class:"myAccountCancel",type:"default",ref:"cancel",onClick:e.toggleEdit},{default:a(()=>[W]),_:1},8,["onClick"])]),s("div",q,[t(o,{class:"myAccountDelete",type:"danger",onClick:e.deleteAccount},{default:a(()=>[F]),_:1},8,["onClick"])])])):(l(),m("div",O,[t(C,{user:e.user},null,8,["user"]),s("div",R,[s("div",S,[t(o,{class:"myAccountLogout",type:"danger",onClick:e.logout},{default:a(()=>[P]),_:1},8,["onClick"]),t(o,{class:"myAccountEdit",tabindex:"0",type:"default",ref:"edit",onClick:e.toggleEdit},{default:a(()=>[G]),_:1},8,["onClick"])])])]))])])}const Y=U({components:{CEditItem:k,CViewUser:w},data(){return{user:new B,edit:!1,confirmed:!0,loading:!1,unconfirmedLink:r.unconfirmed_Email,loadingBar:V()}},methods:{async deleteAccount(){this.$data.loadingBar.start(),await u.genDELETE("v2/user/"+this.$data.user.ID,h.stringify(this.$data.user.details))?(localStorage.clear(),this.$notify(g.notifConfig("Deleted","Your account is now deleted.","info")),this.$data.loadingBar.finish(),await f.genRedirectTo(r.Landing)):(this.$data.loadingBar.error(),this.$message({type:"error",message:"Account deletion attempt failed."}))},async save(){this.$data.loadingBar.start();const e=new b({id:this.$data.user.ID,name:i.getVal(this,"name"),email:i.getVal(this,"email"),bio:i.getVal(this,"bio"),confirmed:this.$data.user.details.confirmed});await u.genPOST("v2/user/"+this.$data.user.ID,h.stringify(e))?(this.toggleEdit(),this.$data.loadingBar.finish(),this.$message({message:"Profile updated successfully!",type:"success"})):(this.$data.loadingBar.error(),this.$alert("Save was unsuccessful. Please try again later.","Fail",{confirmButtonText:"OK"}))},async logout(){await u.genGET("logout"),localStorage.clear(),await f.genRedirectTo(r.Landing)},toggleEdit(){this.$data.edit=!this.$data.edit}},async beforeMount(){this.$data.loading=!0,this.$data.user=await g.genCurrentUser(),this.$data.user.ID===-1&&await f.genRedirectTo(r.Landing),this.$data.confirmed=this.$data.user.details.confirmed.valueOf()},mounted(){this.$data.edit&&i.get(i.get(this,"name"),"input").focus(),this.$data.loading=!1}});var oe=E(Y,[["render",K]]);export{oe as default};
