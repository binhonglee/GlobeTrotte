var ut=Object.defineProperty;var ct=(e,t,i)=>t in e?ut(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var T=(e,t,i)=>ct(e,typeof t!="symbol"?t+"":t,i);import{a as pt,P as ge,D as ye}from"./DataProps-DCopCXR4.js";import{d as M,u as C,v as ft,x as be,y as we,z as mt,A as Me,C as vt,D as z,E as ht,I as gt,J as B,K as yt,L as bt,M as wt,O as Ct,X as Ce,P as $e,Q as Ie,S as $t,T as x,U as It,V as _e,c as k,b as m,o as I,n as Ve,l as _t,B as ue,H as q,a as o,F as Be,g as Ue,r as v,f as w,q as Ae,i as ce,h as O,W as xe,_ as pe,m as Dt,t as Tt,j as Le,Y as Nt,R as Pt,e as kt}from"./index-CVwEz7sZ.js";import{N as Ee,u as Ot}from"./Input-B0b2FwEY.js";import{D as Rt,T as fe,P as De,a as St}from"./TripObj-B2zgwhZc.js";import{C as Mt,N as Vt,a as Te,D as le,E as L}from"./CEditItem-CkORRj5K.js";import{N as K,a as Ne}from"./NaiveUtils-CaBEIltk.js";import{C as Bt,P as Ut,F as At,a as xt,p as Pe}from"./UserUtil-BfIc5bHd.js";import{N as Lt}from"./Select-BH-AmpZh.js";const Et=M({name:"Add",render(){return C("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},C("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),Ft=M({name:"Remove",render(){return C("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},C("line",{x1:"400",y1:"256",x2:"112",y2:"256",style:`
        fill: none;
        stroke: currentColor;
        stroke-linecap: round;
        stroke-linejoin: round;
        stroke-width: 32px;
      `}))}}),Ht=ft([be("input-number-suffix",`
 display: inline-block;
 margin-right: 10px;
 `),be("input-number-prefix",`
 display: inline-block;
 margin-left: 10px;
 `)]);function Wt(e){return e==null||typeof e=="string"&&e.trim()===""?null:Number(e)}function zt(e){return e.includes(".")&&(/^(-)?\d+.*(\.|0)$/.test(e)||/^-?\d*$/.test(e))||e==="-"||e==="-0"}function oe(e){return e==null?!0:!Number.isNaN(e)}function ke(e,t){return typeof e!="number"?"":t===void 0?String(e):e.toFixed(t)}function de(e){if(e===null)return null;if(typeof e=="number")return e;{const t=Number(e);return Number.isNaN(t)?null:t}}const Oe=800,Re=100,Gt=Object.assign(Object.assign({},Me.props),{autofocus:Boolean,loading:{type:Boolean,default:void 0},placeholder:String,defaultValue:{type:Number,default:null},value:Number,step:{type:[Number,String],default:1},min:[Number,String],max:[Number,String],size:String,disabled:{type:Boolean,default:void 0},validator:Function,bordered:{type:Boolean,default:void 0},showButton:{type:Boolean,default:!0},buttonPlacement:{type:String,default:"right"},inputProps:Object,readonly:Boolean,clearable:Boolean,keyboard:{type:Object,default:{}},updateValueOnInput:{type:Boolean,default:!0},round:{type:Boolean,default:void 0},parse:Function,format:Function,precision:Number,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onChange:[Function,Array]}),jt=M({name:"InputNumber",props:Gt,slots:Object,setup(e){const{mergedBorderedRef:t,mergedClsPrefixRef:i,mergedRtlRef:a}=mt(e),l=Me("InputNumber","-input-number",Ht,$t,e,i),{localeRef:d}=Ot("InputNumber"),y=vt(e),{mergedSizeRef:$,mergedDisabledRef:u,mergedStatusRef:b}=y,h=z(null),_=z(null),D=z(null),g=z(e.defaultValue),p=ht(e,"value"),c=gt(p,g),V=z(""),Y=n=>{const s=String(n).split(".")[1];return s?s.length:0},je=n=>{const s=[e.min,e.max,e.step,n].map(r=>r===void 0?0:Y(r));return Math.max(...s)},Je=B(()=>{const{placeholder:n}=e;return n!==void 0?n:d.value.placeholder}),G=B(()=>{const n=de(e.step);return n!==null?n===0?1:Math.abs(n):1}),me=B(()=>{const n=de(e.min);return n!==null?n:null}),ve=B(()=>{const n=de(e.max);return n!==null?n:null}),U=()=>{const{value:n}=c;if(oe(n)){const{format:s,precision:r}=e;s?V.value=s(n):n===null||r===void 0||Y(n)>r?V.value=ke(n,void 0):V.value=ke(n,r)}else V.value=String(n)};U();const E=n=>{const{value:s}=c;if(n===s){U();return}const{"onUpdate:value":r,onUpdateValue:f,onChange:P}=e,{nTriggerFormInput:R,nTriggerFormChange:A}=y;P&&x(P,n),f&&x(f,n),r&&x(r,n),g.value=n,R(),A()},N=({offset:n,doUpdateIfValid:s,fixPrecision:r,isInputing:f})=>{const{value:P}=V;if(f&&zt(P))return!1;const R=(e.parse||Wt)(P);if(R===null)return s&&E(null),null;if(oe(R)){const A=Y(R),{precision:W}=e;if(W!==void 0&&W<A&&!r)return!1;let S=Number.parseFloat((R+n).toFixed(W??je(R)));if(oe(S)){const{value:ae}=ve,{value:re}=me;if(ae!==null&&S>ae){if(!s||f)return!1;S=ae}if(re!==null&&S<re){if(!s||f)return!1;S=re}return e.validator&&!e.validator(S)?!1:(s&&E(S),S)}}return!1},Ke=B(()=>N({offset:0,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})===!1),Z=B(()=>{const{value:n}=c;if(e.validator&&n===null)return!1;const{value:s}=G;return N({offset:-s,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})!==!1}),ee=B(()=>{const{value:n}=c;if(e.validator&&n===null)return!1;const{value:s}=G;return N({offset:+s,doUpdateIfValid:!1,isInputing:!1,fixPrecision:!1})!==!1});function qe(n){const{onFocus:s}=e,{nTriggerFormFocus:r}=y;s&&x(s,n),r()}function Xe(n){var s,r;if(n.target===((s=h.value)===null||s===void 0?void 0:s.wrapperElRef))return;const f=N({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0});if(f!==!1){const A=(r=h.value)===null||r===void 0?void 0:r.inputElRef;A&&(A.value=String(f||"")),c.value===f&&U()}else U();const{onBlur:P}=e,{nTriggerFormBlur:R}=y;P&&x(P,n),R(),It(()=>{U()})}function Qe(n){const{onClear:s}=e;s&&x(s,n)}function te(){const{value:n}=ee;if(!n){se();return}const{value:s}=c;if(s===null)e.validator||E(he());else{const{value:r}=G;N({offset:r,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}function ne(){const{value:n}=Z;if(!n){ie();return}const{value:s}=c;if(s===null)e.validator||E(he());else{const{value:r}=G;N({offset:-r,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})}}const Ye=qe,Ze=Xe;function he(){if(e.validator)return null;const{value:n}=me,{value:s}=ve;return n!==null?Math.max(0,n):s!==null?Math.min(0,s):0}function et(n){Qe(n),E(null)}function tt(n){var s,r,f;!((s=D.value)===null||s===void 0)&&s.$el.contains(n.target)&&n.preventDefault(),!((r=_.value)===null||r===void 0)&&r.$el.contains(n.target)&&n.preventDefault(),(f=h.value)===null||f===void 0||f.activate()}let F=null,H=null,j=null;function ie(){j&&(window.clearTimeout(j),j=null),F&&(window.clearInterval(F),F=null)}let J=null;function se(){J&&(window.clearTimeout(J),J=null),H&&(window.clearInterval(H),H=null)}function nt(){ie(),j=window.setTimeout(()=>{F=window.setInterval(()=>{ne()},Re)},Oe),_e("mouseup",document,ie,{once:!0})}function it(){se(),J=window.setTimeout(()=>{H=window.setInterval(()=>{te()},Re)},Oe),_e("mouseup",document,se,{once:!0})}const st=()=>{H||te()},at=()=>{F||ne()};function rt(n){var s,r;if(n.key==="Enter"){if(n.target===((s=h.value)===null||s===void 0?void 0:s.wrapperElRef))return;N({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&((r=h.value)===null||r===void 0||r.deactivate())}else if(n.key==="ArrowUp"){if(!ee.value||e.keyboard.ArrowUp===!1)return;n.preventDefault(),N({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&te()}else if(n.key==="ArrowDown"){if(!Z.value||e.keyboard.ArrowDown===!1)return;n.preventDefault(),N({offset:0,doUpdateIfValid:!0,isInputing:!1,fixPrecision:!0})!==!1&&ne()}}function lt(n){V.value=n,e.updateValueOnInput&&!e.format&&!e.parse&&e.precision===void 0&&N({offset:0,doUpdateIfValid:!0,isInputing:!0,fixPrecision:!1})}yt(c,()=>{U()});const ot={focus:()=>{var n;return(n=h.value)===null||n===void 0?void 0:n.focus()},blur:()=>{var n;return(n=h.value)===null||n===void 0?void 0:n.blur()},select:()=>{var n;return(n=h.value)===null||n===void 0?void 0:n.select()}},dt=bt("InputNumber",a,i);return Object.assign(Object.assign({},ot),{rtlEnabled:dt,inputInstRef:h,minusButtonInstRef:_,addButtonInstRef:D,mergedClsPrefix:i,mergedBordered:t,uncontrolledValue:g,mergedValue:c,mergedPlaceholder:Je,displayedValueInvalid:Ke,mergedSize:$,mergedDisabled:u,displayedValue:V,addable:ee,minusable:Z,mergedStatus:b,handleFocus:Ye,handleBlur:Ze,handleClear:et,handleMouseDown:tt,handleAddClick:st,handleMinusClick:at,handleAddMousedown:it,handleMinusMousedown:nt,handleKeyDown:rt,handleUpdateDisplayedValue:lt,mergedTheme:l,inputThemeOverrides:{paddingSmall:"0 8px 0 10px",paddingMedium:"0 8px 0 12px",paddingLarge:"0 8px 0 14px"},buttonThemeOverrides:wt(()=>{const{self:{iconColorDisabled:n}}=l.value,[s,r,f,P]=Ct(n);return{textColorTextDisabled:`rgb(${s}, ${r}, ${f})`,opacityDisabled:`${P}`}})})},render(){const{mergedClsPrefix:e,$slots:t}=this,i=()=>C(Ce,{text:!0,disabled:!this.minusable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleMinusClick,onMousedown:this.handleMinusMousedown,ref:"minusButtonInstRef"},{icon:()=>$e(t["minus-icon"],()=>[C(Ie,{clsPrefix:e},{default:()=>C(Ft,null)})])}),a=()=>C(Ce,{text:!0,disabled:!this.addable||this.mergedDisabled||this.readonly,focusable:!1,theme:this.mergedTheme.peers.Button,themeOverrides:this.mergedTheme.peerOverrides.Button,builtinThemeOverrides:this.buttonThemeOverrides,onClick:this.handleAddClick,onMousedown:this.handleAddMousedown,ref:"addButtonInstRef"},{icon:()=>$e(t["add-icon"],()=>[C(Ie,{clsPrefix:e},{default:()=>C(Et,null)})])});return C("div",{class:[`${e}-input-number`,this.rtlEnabled&&`${e}-input-number--rtl`]},C(Ee,{ref:"inputInstRef",autofocus:this.autofocus,status:this.mergedStatus,bordered:this.mergedBordered,loading:this.loading,value:this.displayedValue,onUpdateValue:this.handleUpdateDisplayedValue,theme:this.mergedTheme.peers.Input,themeOverrides:this.mergedTheme.peerOverrides.Input,builtinThemeOverrides:this.inputThemeOverrides,size:this.mergedSize,placeholder:this.mergedPlaceholder,disabled:this.mergedDisabled,readonly:this.readonly,round:this.round,textDecoration:this.displayedValueInvalid?"line-through":void 0,onFocus:this.handleFocus,onBlur:this.handleBlur,onKeydown:this.handleKeyDown,onMousedown:this.handleMouseDown,onClear:this.handleClear,clearable:this.clearable,inputProps:this.inputProps,internalLoadingBeforeSuffix:!0},{prefix:()=>{var l;return this.showButton&&this.buttonPlacement==="both"?[i(),we(t.prefix,d=>d?C("span",{class:`${e}-input-number-prefix`},d):null)]:(l=t.prefix)===null||l===void 0?void 0:l.call(t)},suffix:()=>{var l;return this.showButton?[we(t.suffix,d=>d?C("span",{class:`${e}-input-number-suffix`},d):null),this.buttonPlacement==="right"?i():null,a()]:(l=t.suffix)===null||l===void 0?void 0:l.call(t)}}))}}),Jt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Fe=M({name:"Add",render:function(t,i){return I(),k("svg",Jt,i[0]||(i[0]=[m("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 112v288"},null,-1),m("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M400 256H112"},null,-1)]))}}),Kt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},He=M({name:"CloseOutline",render:function(t,i){return I(),k("svg",Kt,i[0]||(i[0]=[m("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 368L144 144"},null,-1),m("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M368 144L144 368"},null,-1)]))}});var X=(e=>(e[e.URLInvalid=0]="URLInvalid",e[e.URLNotFound=1]="URLNotFound",e[e.URLProcessingFailed=2]="URLProcessingFailed",e[e.None=3]="None",e))(X||{});class qt{constructor(t){T(this,"URL","");T(this,"title","");T(this,"description","");T(this,"siteName","");T(this,"error",X.None);t&&(this.URL=t.url!==void 0&&t.url!==null?t.url:"",this.title=t.title!==void 0&&t.title!==null?t.title:"",this.description=t.description!==void 0&&t.description!==null?t.description:"",this.siteName=t.site_name!==void 0&&t.site_name!==null?t.site_name:"",this.error=t.error!==void 0&&t.error!==null?t.error:X.None)}toJsonKey(t){switch(t){case"URL":return"url";case"title":return"title";case"description":return"description";case"siteName":return"site_name";case"error":return"error";default:return t}}}const Xt=M({name:"CEditPlaces",components:{Add:Fe,CloseOutline:He,NButton:ue,NDivider:_t,NIcon:Ve,NInput:Ee,NInputNumber:jt},model:{props:{propPlaces:Array()},emits:["update:propPlaces"]},props:{propPlaces:{type:Array,default:()=>[],validator:function(e){return Array.isArray(e)?(e.forEach(t=>{if(!(t instanceof ge))return!1}),!0):!1}}},data:()=>({parsing:[]}),beforeMount(){this.$props.propPlaces.map(()=>this.$data.parsing.push(!1))},methods:{pushPlace(){this.$props.propPlaces.push(new ge)},removePlace(e){this.$props.propPlaces.splice(e,1)},setTravelTime(e){const t=new pt;t.toPlaceIndex=e,this.$props.propPlaces[e].travelTime=t},async parse(e){this.$data.parsing[e]=!0;const t=JSON.stringify(this.$props.propPlaces[e].place.URL.valueOf().trim()),i=await q.genPOST("parseURL",t);if(i===null){this.$data.parsing[e]=!1;return}const a=new qt(i);if(a.error!==X.None){this.$data.parsing[e]=!1;return}this.$props.propPlaces[e].place.URL=a.URL.valueOf(),this.$props.propPlaces[e].place.label=a.title.valueOf(),this.$props.propPlaces[e].place.description=a.description.valueOf(),this.$data.parsing[e]=!1}}}),Qt={class:"edit_places"},Yt={class:"places"},Zt={key:0,class:"editTravelTime"},en={key:0,class:"travelTimeInput"};function tn(e,t,i,a,l,d){const y=v("n-divider"),$=v("n-input-number"),u=v("n-button"),b=v("n-input"),h=v("close-outline"),_=v("n-icon"),D=v("add");return I(),k("div",Qt,[m("ul",Yt,[(I(!0),k(Be,null,Ue(e.propPlaces,(g,p)=>(I(),k("li",{class:"place",key:p},[p>0?(I(),k("div",Zt,[o(y,{class:"editPlaceDivider"}),g.travelTime!==void 0?(I(),k("div",en,[t[1]||(t[1]=m("div",{class:"travelTimeLabel"},"Travel time",-1)),o($,{placeholder:"Travel time (in minutes)",type:"text",min:0,value:g.travelTime.timeInMinutes,"onUpdate:value":c=>g.travelTime.timeInMinutes=c},{suffix:w(()=>t[0]||(t[0]=[O("minutes")])),_:2},1032,["value","onUpdate:value"])])):(I(),ce(u,{key:1,class:"setTravelTime",type:"default",onClick:c=>e.setTravelTime(p)},{default:w(()=>t[2]||(t[2]=[O("Set travel time")])),_:2},1032,["onClick"])),o(y,{class:"editPlaceDivider"})])):Ae("",!0),m("div",{class:xe(["editPlace","place"+p])},[o(b,{class:"inputPlaceLink",value:g.place.URL,"onUpdate:value":c=>g.place.URL=c,type:"text",disabled:e.parsing[p],placeholder:"Link"+(p!==0?"":" (eg. Google Map link)")},null,8,["value","onUpdate:value","disabled","placeholder"]),o(u,{class:"inputPlaceLinkParse",type:"default",disabled:g.place.URL.length===0||e.parsing[p],loading:e.parsing[p],onClick:c=>e.parse(p)},{default:w(()=>t[3]||(t[3]=[O("Parse")])),_:2},1032,["disabled","loading","onClick"]),o(b,{class:"inputPlaceLabel",value:g.place.label,"onUpdate:value":c=>g.place.label=c,type:"text",disabled:e.parsing[p],placeholder:"Place Name"+(p!==0?"":" (eg. Golden Gate Bridge)")},null,8,["value","onUpdate:value","disabled","placeholder"]),t[5]||(t[5]=m("br",null,null,-1)),o(b,{class:"inputPlaceDesc",value:g.place.description,"onUpdate:value":c=>g.place.description=c,type:"textarea",disabled:e.parsing[p],placeholder:p!==0?"Description":"Elaborate more about why you include this place in the trip!",rows:3},null,8,["value","onUpdate:value","disabled","placeholder"]),o(u,{class:"removePlace wide_button",type:"error",secondary:"",onClick:c=>e.removePlace(p)},{default:w(()=>[o(_,null,{default:w(()=>[o(h)]),_:1}),t[4]||(t[4]=O("Delete this place"))]),_:2},1032,["onClick"])],2)]))),128))]),o(y,{class:"editPlaceDivider"}),o(u,{class:"addPlace wide_button",onClick:e.pushPlace},{default:w(()=>[o(_,null,{default:w(()=>[o(D)]),_:1}),t[6]||(t[6]=O("Add another place"))]),_:1},8,["onClick"])])}const We=pe(Xt,[["render",tn],["__scopeId","data-v-6ef07bd7"]]),nn=M({components:{Add:Fe,CEditPlaces:We,CloseOutline:He,NButton:ue,NCard:Dt,NIcon:Ve},props:{givenDays:{type:Array,required:!0}},data:()=>({days:[]}),beforeMount(){this.$data.days=this.$props.givenDays.slice(0).map(e=>new ye(e))},methods:{pushDay(){const e=new ye(new Rt({places:[{}]}));e.dayOf=this.$data.days.length+1,this.$data.days.push(e)},removeDay(e){this.$data.days.splice(e,1);const t={};for(const l of this.$data.days)t[l.dayOf]=l;const i=this.$data.days.length;this.$data.days=[];let a=0;for(let l=0;l<i;l++){let d=t[l+a];for(;d==null&&l+a<i+5;)a++,d=t[l+a];d.dayOf=l+1,this.$data.days.push(d)}}}}),sn={class:"edit_days narrow_content"},an={class:"editDayCardContent"},rn={class:"editDayTitle"};function ln(e,t,i,a,l,d){const y=v("close-outline"),$=v("n-icon"),u=v("n-button"),b=v("CEditPlaces"),h=v("n-card"),_=v("add");return I(),k("div",sn,[(I(!0),k(Be,null,Ue(e.days,(D,g)=>(I(),ce(h,{class:xe(["editDay","day"+D.dayOf]),key:D.dayOf,hoverable:"","content-style":"padding: 0"},{default:w(()=>[m("div",an,[m("div",rn,[m("b",null,"Day "+Tt(D.dayOf),1),o(u,{class:"removeDay right_button",secondary:"",type:"error",onClick:p=>e.removeDay(g)},{default:w(()=>[o($,null,{default:w(()=>[o(y)]),_:1}),t[1]||(t[1]=O("Delete this day"))]),_:2},1032,["onClick"])]),o(b,{class:"editPlaces",ref_for:!0,ref:"places"+g,propPlaces:D.propPlaces,"onUpdate:propPlaces":p=>D.propPlaces=p},null,8,["propPlaces","onUpdate:propPlaces"])])]),_:2},1032,["class"]))),128)),o(u,{class:"addDay right_button",onClick:t[0]||(t[0]=D=>e.pushDay())},{default:w(()=>[o($,null,{default:w(()=>[o(_)]),_:1}),t[2]||(t[2]=O("Add another day"))]),_:1})])}const on=pe(nn,[["render",ln],["__scopeId","data-v-964eaa4e"]]);class dn{constructor(t,i){T(this,"type");T(this,"label");T(this,"value");this.type=t,this.label=this.getLabel(),this.value=i}static getAllTypes(){return["name","description"]}getLabel(){switch(this.type){case"name":return"Name";case"description":return"Description";default:return"unknown_type"}}}class Q extends xt{static fromJSON(t){return new Q(t)}getObjImpl(t){return new fe(JSON.parse(t))}}class Se extends At{}class ze extends Bt{constructor(){super(...arguments);T(this,"storage","trip");T(this,"storeCount",10)}async genFetch(i){const a=await Ge(i);return Ut.isPWA()?a.ID!==-1?(this.storeObj(Se,Q,a.ID.toString(),Le.WingsStructUtil.stringify(a,!0)),a):null:a}static genObj(i){return new ze().genObjImpl(Se,Q,i)}}async function Ge(e){const t=await q.genGET("v2/trip/"+e);return new fe(t)}const un=3,cn=M({components:{NButton:ue,NSelect:Lt,NSwitch:Nt,CEditDays:on,CEditItem:Mt,CEditPlaces:We},props:{trip:{type:fe,required:!0},isNew:{type:Boolean,required:!0}},emits:{save(e){return e.ID!==-1},cancel(){return!0}},data:()=>({cities:[],cityLoading:!1,parsedCities:[],parsedCitiesMap:new Map,possibleCities:[],private:!1,saving:!1,deleting:!1}),computed:{descriptionMaxCharCount(){return le},descriptionRowMinCount(){return un}},async beforeMount(){K.init(),this.update(),await this.searchCity("")},mounted(){L.get(L.get(this,"name"),"input").focus()},methods:{cancel(){L.get(this,"days").$data.days=(this.$props.trip.details.days??[]).slice(0),this.$emit("cancel")},save(){const e=new St;if(this.$data.cities.length<1){this.showAlert("Cities cannot be empty");return}this.$data.saving=!0;const t=[];for(const $ of this.$data.cities){const u=this.$data.parsedCitiesMap.get($);if(u!==void 0)t.push(u);else{const b=new De;b.ID=+$,t.push(b)}}e.cities=t;const i=L.getVal(this,"name"),a=Pe(L.getVal(this,"description"));if(!this.checkValidNameDescription(i,a)){this.$data.saving=!1;return}e.name=i,e.description=a,e.days=[];const d=L.get(this,"days");let y=0;for(const $ in d.days){const u=d.days[$].toDay(),b=this.filterPlaces(u.places);b.length>0?(u.places=b,u.dayOf=u.dayOf-y,e.days.push(u)):y++}e.private=this.$data.private,e.ID=this.$props.trip.ID,this.$emit("save",e),this.$data.saving=!1},filterPlaces(e){const t=[];for(const i of e)i.label=i.label.trim(),i.URL=i.URL.trim(),i.label!==""&&(i.description=Pe(i.description.valueOf()),t.push(i));return t},confirmDelete(){K.dialogWarning({title:"Delete trip",content:"Are you sure you want to delete this trip? THIS PROCESS IS IRREVERSIBLE.",positiveText:"Confirm",negativeText:"Cancel",onPositiveClick:async()=>{await this.del()},onNegativeClick:async()=>{}})},async del(){this.$data.deleting=!0;let e=!!await q.genDELETE("v2/trip/"+this.$props.trip.ID,Le.WingsStructUtil.stringify(this.$props.trip));e||(e=(await Ge(this.$props.trip.ID.toString())).ID===-1),this.$data.deleting=!1,K.notifyTrigger("Trip Deletion",e?"Trip is successfully deleted!":"Trip deletion attempt failed.",e?Ne.SUCCESS:Ne.ERROR),e&&Pt.genRedirectTo(kt.Landing)},tripToItem(e){return new dn(e,this.$props.trip[e])},update(){const e=[];for(const t of this.$props.trip.details.cities)e.push(t.ID.toString());this.$data.cities=e;for(const t of this.$props.trip.details.cities)this.$data.parsedCitiesMap.set(t.ID.toString(),t),this.$data.parsedCities.push(t);this.$data.private=this.$props.trip.details.private.valueOf()},checkValidNameDescription(e,t){return!e||e.length<Vt?(this.showAlert("Trip name is too short."),!1):e.length>Te?(this.showAlert(`Trip name cannot be longer than ${Te}.`),!1):!t||t.length>le?(this.showAlert(`Trip description cannot be longer than ${le}.`),!1):!0},showAlert(e){K.dialogError({title:"Error",content:e,positiveText:"OK"})},async searchCity(e){this.$data.possibleCities=[];const t=[];for(const l of this.$data.parsedCities)this.$data.possibleCities.push({label:l.display.valueOf()+", "+l.iso2.valueOf(),value:l.ID.toString()}),t.push(l.ID.valueOf());this.$data.cityLoading=!0;const i=JSON.stringify(e),a=await q.genPOST("cities",i);if(a===null){this.$data.cityLoading=!1;return}for(const l of a){const d=new De(l);this.$data.parsedCitiesMap.set(d.ID.toString(),d),t.includes(d.ID.valueOf())||this.$data.possibleCities.push({label:d.display.valueOf()+", "+d.iso2.valueOf(),value:d.ID.toString()})}this.$data.cityLoading=!1},onSelect(e){for(const t of e){let i=!0;for(const a of this.$data.parsedCities)a.ID.toString()===t&&(i=!1);if(i){const a=this.$data.parsedCitiesMap.get(t);a!==void 0&&this.$data.parsedCities.push(a)}}}}}),pn={class:"edit_trip"},fn={class:"edit_form"},mn={class:"narrow_content"},vn={class:"editTripPrivacy"},hn={class:"editInput"},gn={class:"editCity"},yn={class:"confirmationButtons narrow_content"};function bn(e,t,i,a,l,d){const y=v("CEditItem"),$=v("n-switch"),u=v("n-select"),b=v("CEditDays"),h=v("n-button");return I(),k("div",pn,[m("form",fn,[m("div",mn,[o(y,{className:"editTripName",label:"Name",ref:"name",val:e.trip.details.name.valueOf()},null,8,["val"]),o(y,{className:"editTripDescription",label:"Description",ref:"description",type:"textarea",val:e.trip.details.description.valueOf(),"val-max-count":e.descriptionMaxCharCount,"row-min-count":e.descriptionRowMinCount},null,8,["val","val-max-count","row-min-count"]),m("div",vn,[t[2]||(t[2]=m("span",{class:"editLabel"},"Private:",-1)),m("div",hn,[o($,{class:"editPrivacyToggle",value:e.private,"onUpdate:value":t[0]||(t[0]=_=>e.private=_)},null,8,["value"])])]),m("div",gn,[t[3]||(t[3]=m("span",{class:"editLabel"},"Cities:",-1)),o(u,{class:"editInput",value:e.cities,"onUpdate:value":t[1]||(t[1]=_=>e.cities=_),options:e.possibleCities,loading:e.cityLoading,filterable:"",multiple:"",placeholder:"",onSearch:e.searchCity,onUpdateValue:e.onSelect},null,8,["value","options","loading","onSearch","onUpdateValue"])])]),o(b,{ref:"days",givenDays:e.trip.details.days},null,8,["givenDays"]),m("div",yn,[o(h,{class:"saveEditTrip left_col",type:"info",onClick:e.save,loading:e.saving},{default:w(()=>t[4]||(t[4]=[O("Save")])),_:1},8,["onClick","loading"]),o(h,{class:"cancelEditTrip right_col",type:"default",onClick:e.cancel},{default:w(()=>t[5]||(t[5]=[O("Cancel")])),_:1},8,["onClick"]),e.isNew?Ae("",!0):(I(),ce(h,{key:0,class:"deleteTrip right_col",onClick:e.confirmDelete,type:"error",loading:e.deleting},{default:w(()=>t[6]||(t[6]=[O("Delete")])),_:1},8,["onClick","loading"]))])])])}const kn=pe(cn,[["render",bn]]);export{kn as C,ze as T};
